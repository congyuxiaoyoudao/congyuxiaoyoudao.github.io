<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Assignment 5. GAMES202 Homework 2 | The Only Problem's Blog</title><meta name=keywords content="GAMES202"><meta name=description content="
(âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡

0x00 To begin with
è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

 éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾
 GAMES202 ä½œä¸š 2

For referenceğŸ‘‡ï¼š

ğŸ“ºB ç«™è§†é¢‘ï¼š







  
  GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“


ğŸ“¦ä»£ç ä»“åº“ï¼š







  
  congyuxiaoyoudao/GAMES202_Homework at working


ğŸ“ƒ







  
  The rendering equation | ACM SIGGRAPH Computer Graphics


ğŸ“ƒ







  
  Precomputed radiance transfer for real-time rendering in dynamic, low-frequency lighting environments | ACM Transactions on Graphics




master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…

0x01 å‰ç½®å‡†å¤‡ Warm Up
æ¸²æŸ“æ–¹ç¨‹ Render Equation
James T. Kajiyaï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªæå‡º Kajiya-Kay å¤´å‘ç€è‰²æ¨¡å‹çš„ Kajiyaï¼‰åœ¨ 1986 å¹´æå‡ºäº†æ¸²æŸ“æ–¹ç¨‹ï¼ˆThe Render Equationï¼‰ï¼ŒåŸè®ºæ–‡é‡Œé•¿è¿™æ ·ï¼š
$$
I(x,x')=g(x,x')\left[ \epsilon(x,x')+\int_{S}\rho(x,x',x'')I(x',x'')dx'' \right]
$$
å½“ç„¶ç°åœ¨çœ‹å¾—æ›´èˆ’æœçš„å½¢å¼é•¿è¿™æ ·ï¼š"><meta name=author content="The Only Problem"><link rel=canonical href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-2/><link crossorigin=anonymous href=/assets/css/stylesheet.452758010f0b7fc9ad7fa528ffdfdd8eb9e830816fb8c8119f16f39583297db8.css integrity="sha256-RSdYAQ8Lf8mtf6Uo/9/djrnoMIFvuMgRnxbzlYMpfbg=" rel="preload stylesheet" as=style><link rel=icon href=https://congyuxiaoyoudao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://congyuxiaoyoudao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://congyuxiaoyoudao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://congyuxiaoyoudao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://congyuxiaoyoudao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity=sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity=sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk crossorigin=anonymous onload='window.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\$$",right:"\\\\$$",display:!1},{left:"\\$$",right:"\\\\$$",display:!0}]})})'></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css><meta property="og:url" content="https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-2/"><meta property="og:site_name" content="The Only Problem's Blog"><meta property="og:title" content="Assignment 5. GAMES202 Homework 2"><meta property="og:description" content=" (âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡
0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾ GAMES202 ä½œä¸š 2 For referenceğŸ‘‡ï¼š
ğŸ“ºB ç«™è§†é¢‘ï¼š GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ ğŸ“¦ä»£ç ä»“åº“ï¼š congyuxiaoyoudao/GAMES202_Homework at working ğŸ“ƒ The rendering equation | ACM SIGGRAPH Computer Graphics ğŸ“ƒ Precomputed radiance transfer for real-time rendering in dynamic, low-frequency lighting environments | ACM Transactions on Graphics master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…
0x01 å‰ç½®å‡†å¤‡ Warm Up æ¸²æŸ“æ–¹ç¨‹ Render Equation James T. Kajiyaï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªæå‡º Kajiya-Kay å¤´å‘ç€è‰²æ¨¡å‹çš„ Kajiyaï¼‰åœ¨ 1986 å¹´æå‡ºäº†æ¸²æŸ“æ–¹ç¨‹ï¼ˆThe Render Equationï¼‰ï¼ŒåŸè®ºæ–‡é‡Œé•¿è¿™æ ·ï¼š
$$ I(x,x')=g(x,x')\left[ \epsilon(x,x')+\int_{S}\rho(x,x',x'')I(x',x'')dx'' \right] $$ å½“ç„¶ç°åœ¨çœ‹å¾—æ›´èˆ’æœçš„å½¢å¼é•¿è¿™æ ·ï¼š"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-19T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-19T00:00:00+00:00"><meta property="article:tag" content="GAMES202"><meta name=twitter:card content="summary"><meta name=twitter:title content="Assignment 5. GAMES202 Homework 2"><meta name=twitter:description content="
(âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡

0x00 To begin with
è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

 éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾
 GAMES202 ä½œä¸š 2

For referenceğŸ‘‡ï¼š

ğŸ“ºB ç«™è§†é¢‘ï¼š







  
  GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“


ğŸ“¦ä»£ç ä»“åº“ï¼š







  
  congyuxiaoyoudao/GAMES202_Homework at working


ğŸ“ƒ







  
  The rendering equation | ACM SIGGRAPH Computer Graphics


ğŸ“ƒ







  
  Precomputed radiance transfer for real-time rendering in dynamic, low-frequency lighting environments | ACM Transactions on Graphics




master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…

0x01 å‰ç½®å‡†å¤‡ Warm Up
æ¸²æŸ“æ–¹ç¨‹ Render Equation
James T. Kajiyaï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªæå‡º Kajiya-Kay å¤´å‘ç€è‰²æ¨¡å‹çš„ Kajiyaï¼‰åœ¨ 1986 å¹´æå‡ºäº†æ¸²æŸ“æ–¹ç¨‹ï¼ˆThe Render Equationï¼‰ï¼ŒåŸè®ºæ–‡é‡Œé•¿è¿™æ ·ï¼š
$$
I(x,x')=g(x,x')\left[ \epsilon(x,x')+\int_{S}\rho(x,x',x'')I(x',x'')dx'' \right]
$$
å½“ç„¶ç°åœ¨çœ‹å¾—æ›´èˆ’æœçš„å½¢å¼é•¿è¿™æ ·ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://congyuxiaoyoudao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Assignments","item":"https://congyuxiaoyoudao.github.io/posts/assignments/"},{"@type":"ListItem","position":3,"name":"Assignment 5. GAMES202 Homework 2","item":"https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Assignment 5. GAMES202 Homework 2","name":"Assignment 5. GAMES202 Homework 2","description":" (âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡\n0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\néƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾ GAMES202 ä½œä¸š 2 For referenceğŸ‘‡ï¼š\nğŸ“ºB ç«™è§†é¢‘ï¼š GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ ğŸ“¦ä»£ç ä»“åº“ï¼š congyuxiaoyoudao/GAMES202_Homework at working ğŸ“ƒ The rendering equation | ACM SIGGRAPH Computer Graphics ğŸ“ƒ Precomputed radiance transfer for real-time rendering in dynamic, low-frequency lighting environments | ACM Transactions on Graphics master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…\n0x01 å‰ç½®å‡†å¤‡ Warm Up æ¸²æŸ“æ–¹ç¨‹ Render Equation James T. Kajiyaï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªæå‡º Kajiya-Kay å¤´å‘ç€è‰²æ¨¡å‹çš„ Kajiyaï¼‰åœ¨ 1986 å¹´æå‡ºäº†æ¸²æŸ“æ–¹ç¨‹ï¼ˆThe Render Equationï¼‰ï¼ŒåŸè®ºæ–‡é‡Œé•¿è¿™æ ·ï¼š\n$$ I(x,x')=g(x,x')\\left[ \\epsilon(x,x')+\\int_{S}\\rho(x,x',x'')I(x',x'')dx'' \\right] $$ å½“ç„¶ç°åœ¨çœ‹å¾—æ›´èˆ’æœçš„å½¢å¼é•¿è¿™æ ·ï¼š\n","keywords":["GAMES202"],"articleBody":" (âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡\n0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\néƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾ GAMES202 ä½œä¸š 2 For referenceğŸ‘‡ï¼š\nğŸ“ºB ç«™è§†é¢‘ï¼š GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ ğŸ“¦ä»£ç ä»“åº“ï¼š congyuxiaoyoudao/GAMES202_Homework at working ğŸ“ƒ The rendering equation | ACM SIGGRAPH Computer Graphics ğŸ“ƒ Precomputed radiance transfer for real-time rendering in dynamic, low-frequency lighting environments | ACM Transactions on Graphics master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…\n0x01 å‰ç½®å‡†å¤‡ Warm Up æ¸²æŸ“æ–¹ç¨‹ Render Equation James T. Kajiyaï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªæå‡º Kajiya-Kay å¤´å‘ç€è‰²æ¨¡å‹çš„ Kajiyaï¼‰åœ¨ 1986 å¹´æå‡ºäº†æ¸²æŸ“æ–¹ç¨‹ï¼ˆThe Render Equationï¼‰ï¼ŒåŸè®ºæ–‡é‡Œé•¿è¿™æ ·ï¼š\n$$ I(x,x')=g(x,x')\\left[ \\epsilon(x,x')+\\int_{S}\\rho(x,x',x'')I(x',x'')dx'' \\right] $$ å½“ç„¶ç°åœ¨çœ‹å¾—æ›´èˆ’æœçš„å½¢å¼é•¿è¿™æ ·ï¼š\n$$ L_{o}(p,\\omega_{o})=L_{e}(p,\\omega_{o})+\\int_{\\Omega^+}L_{i}(p,\\omega_{i})f_{r}(p,\\omega_{i},\\omega_{o})\\cos\\theta_{i}\\space d\\omega_{i} $$ å…¶ä¸­ï¼š\n$L_{o}(p,\\omega_{o})$ï¼šè¦æ±‚å‡ºå°„æ–¹å‘çš„è¾å°„ç‡ï¼ˆRadienceï¼‰ $L_{e}(p,\\omega_{o})$ï¼šè‡ªå‘å…‰é¡¹ $\\Omega^+$ï¼šç§¯åˆ†åŸŸï¼Œä»…å¯¹è¡¨é¢æ­£åŠçƒç§¯åˆ† $L_{i}(p,\\omega_{i})$ï¼šLightingï¼ŒæŸä¸€å…¥å°„æ–¹å‘çš„è¾å°„ç‡ $f_{r}(p,\\omega_{i},\\omega_{o})$ï¼šBRDFï¼Œæè¿°æŸä¸€å…¥å°„æ–¹å‘çš„å…‰çº¿åœ¨å‡ºå°„æ–¹å‘çš„è´¡çŒ® $\\cos \\theta_{i}$ï¼šè¡¨é¢æ³•å‘ä¸æŸä¸€å…¥å°„æ–¹å‘å½¢æˆçš„å¤¹è§’ä½™å¼¦ æ‰€ä»¥æ¸²æŸ“æ–¹ç¨‹å…¶å®å°±æè¿°äº†åœ¨å½“å‰ Shading Point ä¸Šï¼Œç»™å®šå…¥å°„å…‰ä¸å‡ºå°„æ–¹å‘ï¼ˆè§‚å¯Ÿæ–¹å‘ï¼‰ï¼Œåœ¨å‡ºå°„æ–¹å‘ä¸Šèƒ½å¤Ÿæ¥æ”¶åˆ°çš„ Radianceï¼Œä»»ä½•åœ¨è¡¨é¢ä¸Šè¿›è¡Œçš„å…‰çº¿ä¼ æ’­çš„ Shading éƒ½éœ€è¦è§£è¿™ä¸ªæ–¹ç¨‹ã€‚\nSplit Sum å¯¹äºç¯å¢ƒå…‰ï¼Œé€šå¸¸ä½¿ç”¨ CubeMap æˆ–è€…ç­‰è·æŸ±å½¢æŠ•å½±å°†å›¾åƒæŠ•å°„åˆ°æ— é™è¿œçš„çƒé¢ä¸Šï¼Œè¦è·å¾—ç¯å¢ƒå…‰çš„ Shadingï¼ˆç›®å‰æš‚ä¸è€ƒè™‘ Shadowingï¼‰ï¼Œå°±éœ€è¦æ±‚è§£æ¸²æŸ“æ–¹ç¨‹ï¼Œæ ¸å¿ƒæ˜¯å¯¹äº Lighting éƒ¨åˆ†çš„æ±‚è§£ã€‚\nå…ˆæŠ›å¼€æ¸²æŸ“æ–¹ç¨‹ï¼Œæƒ³è±¡ä¸€ä¸‹å½“è¡¨é¢æ˜¯ç†æƒ³é•œé¢çš„æƒ…å†µï¼šå¯¹äºæŸä¸ª Shading Pointï¼Œå…¶åå°„è¡Œä¸ºæ˜¯é•œé¢åå°„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ±‚å‡ºå°„æ–¹å‘å¯¹åº”çš„å…¥å°„æ–¹å‘ï¼Œæ ¹æ®è¿™ä¸ªæ–¹å‘æŸ¥è¯¢ç¯å¢ƒå…‰çš„é¢œè‰²ã€‚\næ›´ General ä¸€ç‚¹ï¼Œå½“è¡¨é¢æ¯”è¾ƒç²—ç³™çš„æƒ…å†µï¼Œèƒ½å¤Ÿåå°„åˆ°å‡ºå°„æ–¹å‘çš„å…¥å°„è§’åœ¨é•œåå°„æ–¹å‘ä¸Šä¼šåœ¨æŸä¸ªè§’åº¦ $\\phi$ èŒƒå›´å†…æŠ–åŠ¨åˆ†å¸ƒï¼Œæœ€ç»ˆåå°„åˆ°å‡ºå°„æ–¹å‘çš„ Lighting å—åˆ°è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰é‡‡æ ·ç‚¹é¢œè‰²çš„å½±å“ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç±»æ¯”äºå¯¹åŸå§‹çš„ç¯å¢ƒè´´å›¾è¿›è¡Œæ»¤æ³¢ï¼Œä¸”ç²—ç³™åº¦è¶Šå¤§ï¼Œæ»¤æ³¢æ ¸è¶Šå¤§ï¼Œè¿™æ ·å°±å¯ä»¥ä»ä½¿ç”¨é•œåå°„æ–¹å‘æŸ¥è¯¢æ»¤æ³¢åçš„å›¾åƒã€‚è¿™äº›æ»¤æ³¢åçš„å›¾åƒå½“ç„¶å¯ä»¥é¢„è®¡ç®—ï¼Œå½¢æˆä¸€ä¸ªæ¨¡ç³Šå±‚çº§ï¼Œç„¶åæ¸²æŸ“æ—¶æ ¹æ®ä¸åŒç²—ç³™åº¦ä½¿ç”¨ä¸åŒå›¾åƒã€‚\nä½†æ˜¯ç›®å‰ Lighting é¡¹åœ¨ç§¯åˆ†å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦å¯¹æ•´ä¸ªåŠçƒé¢ä¸Šçš„å…¥å°„æ–¹å‘éƒ½è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿˜æ˜¯æ¯”è¾ƒ Costy çš„ï¼Œæœ‰æ²¡æœ‰åŠæ³•æŠŠ Lighting ä»ç§¯åˆ†é‡Œç‹¬ç«‹å‡ºæ¥ï¼Ÿä¸‹é¢æœ‰ä¸€ç§è¿‘ä¼¼æ–¹æ³•ï¼š\n$$ \\int_{\\Omega}f(x)g(x)dx\\approx \\frac{\\int_{\\Omega_{G}}f(x)dx}{\\int_{\\Omega_{G}}dx} \\cdot \\int_{\\Omega}g(x)dx $$ è¿™ä¸ªè¿‘ä¼¼åœ¨ $g(x)$ è´¡çŒ®æ¯”è¾ƒå°æˆ–è€…æ¯”è¾ƒå¹³æ»‘ï¼ˆä½é¢‘ï¼‰æ—¶æ˜¯ç›¸å¯¹å‡†ç¡®çš„ã€‚æ¼«åå°„ BRDF å°±å¾ˆå¥½åœ°æ»¡è¶³è¿™ä¸ªæ€§è´¨ï¼Œæ‰€ä»¥å¯ä»¥å¯¹æ¸²æŸ“æ–¹ç¨‹åº”ç”¨è¿™ä¸ªè¿‘ä¼¼ï¼š\n$$ L_{o}(p,\\omega_{o})\\approx\\frac{\\int_{\\Omega_{f_{r}}}L_{i}(p,\\omega_{i})d\\omega_{i}}{\\int_{\\Omega_{f_{r}}}d\\omega_{i}}\\cdot \\int_{\\Omega^+}f_{r}(p,\\omega_{i},\\omega_{o})\\cos \\theta_{i} \\space d\\omega_{i} $$ ä¹˜å·å·¦è¾¹çš„éƒ¨åˆ†ä»£è¡¨ Lighting åœ¨ BRDF èŒƒå›´å†…çš„å¹³å‡ Radienceï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¯¹å‡ºå°„æ–¹å‘æœ‰è´¡çŒ®çš„å…¥å°„æ–¹å‘èŒƒå›´å†…åœ¨ç¯å¢ƒè´´å›¾ä¸Šé‡‡æ ·é¢œè‰²çš„å¹³å‡å€¼ã€‚é€šè¿‡å¯¹ç¯å¢ƒè´´å›¾çš„é¢„æ»¤æ³¢ï¼Œå¯ä»¥é€šè¿‡ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°è¿™ä¸ªå€¼ã€‚\nçƒè°å‡½æ•° Spherical Harmonics çƒè°å‡½æ•° ç»´åŸºç™¾ç§‘ä¸Šçƒè°å‡½æ•°æ˜¯ä¸‹é¢è¿™ä¸ªå¼å­åœ¨ $m,l$ ä¸åŒå–å€¼æ—¶çš„è§£ï¼š\n$$ Y^m_{l}(\\theta, \\phi)=(-1)^m\\sqrt{ \\frac{2l+1}{4\\pi}\\frac{(l-|m|)!}{(l+|m|)!} }P^m_{l}(\\cos \\theta)e^{im\\phi} $$ å®æ•°å½¢å¼ä¸‹å¯è§†åŒ–å‡ºæ¥æ˜¯é•¿è¿™æ ·çš„ï¼š\nçœ‹ä¸Šå»æ˜¯ä¸æ˜¯å¾ˆåƒç‰©ç†/é‡å­åŒ–å­¦é‡Œé¢çš„ç”µå­äº‘å•¥çš„ï¼ˆè¿™ä¿©è¿˜çœŸæœ‰å…³ç³»ï¼‰ï¼Œä½†åœ¨å›¾å½¢å­¦é‡Œé¢ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç†è§£å…¶ç‰©ç†æ„ä¹‰ï¼Œå¯ä»¥ç®€å•å°†å…¶ç†è§£ä¸ºä¸€ç»„å®šä¹‰åœ¨çƒé¢ä¸Šçš„ä¸¤ä¸¤æ­£äº¤çš„åŸºå‡½æ•°ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚…é‡Œå¶å˜æ¢çš„æ€æƒ³å»æ‹Ÿåˆä»»ä½•çš„çƒé¢å‡½æ•°ã€‚\nåŸºå‡½æ•°ï¼ˆBasis Functionï¼‰ï¼šä¸€ç»„ä¸¤ä¸¤ä¹‹é—´ç›¸äº’ç‹¬ç«‹çš„å‡½æ•°ï¼Œå³åœ¨å½¼æ­¤ä¹‹ä¸Šçš„æŠ•å½±ä¸º 0ï¼Œå¯ä»¥ç±»æ¯”çº¿æ€§ä»£æ•°çš„åŸºå‘é‡ã€‚ä¸€ç»„åŸºå‡½æ•°å¼ æˆçš„ç©ºé—´æ˜¯å…¶ç»è¿‡çº¿æ€§ç»„åˆèƒ½å¤Ÿè¡¨ç¤ºçš„æ‰€æœ‰å‡½æ•°çš„é›†åˆ\n$$ \\mathcal{F} = \\left\\{ f(x) = \\sum_{i=1}^n c_{i}B_{i}(x) \\,\\middle|\\, c_{i} \\in \\mathbb{R} \\right\\} $$ å¯ä»¥é€šè¿‡å°†åŸå‡½æ•°æŠ•å½±åˆ°æŸä¸ªåŸºå‡½æ•°ä¸Šè·å–è¯¥åŸºå‡½æ•°å‰çš„ç³»æ•° $c_{i}$ï¼š\n$$ c_{i}=\\int_{\\Omega}f(x)B_{i}(x)\\,dx $$ å®é™…ä½¿ç”¨æ—¶éœ€è¦æŠŠç§¯åˆ†ç¦»æ•£åŒ–ä¸ºä¸€ç³»åˆ—æ±‚å’Œçš„å½¢å¼ï¼Œç»™å®šä¸€ä¸ªå‡½æ•° $f(\\omega_{i})$ï¼Œå¯ä»¥é€šè¿‡æŠ•å½±æ±‚å¾—å…¶åœ¨ $Y^m_{l}(\\omega_{i})$ ä¸Šçš„ç³»æ•°ï¼š\n$$ c^m_{l}\\approx\\sum_{i=1}^Nf(\\omega_{i})\\cdot Y^m_{l}(\\omega_{i})\\cdot \\omega_{i} $$ ç„¶åå°±å¯ä»¥ç”¨ç±»ä¼¼æ³°å‹’å±•å¼€çš„æ ·å­ç”¨åŸºå‡½æ•°è¡¨ç¤ºåŸå‡½æ•°ï¼š\n$$ \\begin{aligned} f(x)=\u0026\\sum^{\\infty}_{l=0}\\sum^l_{m=-l}c^m_{l}\\cdot Y^m_{l}(\\omega_{i}) \\\\ =\u0026 \\, c^0_{0}Y^0_{0}(\\omega_{i})+c^1_{-1}Y^1_{-1}(\\omega_{i})+c^1_{0}Y^1_{0}(\\omega_{i})+\\,\\dots \\end{aligned} $$ å¯¹äºä½é¢‘çš„å‡½æ•°ï¼Œåªå–å‰å‡ é¡¹è¿›è¡Œè¿‘ä¼¼ï¼Œå°±èƒ½è¾¾åˆ° Adequate çš„æ•ˆæœã€‚å¦‚æœ BRDF æ˜¯ç²—ç³™çš„ï¼Œå°±ç›¸å½“äºä¸€ä¸ªä½é€šæ»¤æ³¢å™¨ï¼Œå…¶å’Œ Lighting çš„ä¹˜ç§¯çš„ç§¯åˆ†ä»ç„¶æ˜¯ä½é¢‘çš„ã€‚\nPRTï¼ˆPrecomputerd Radience Transferï¼‰ çƒè°å‡½æ•°ç”¨ä¸€ç»„åŸºå‡½æ•°æ‹Ÿåˆæ¸²æŸ“æ–¹ç¨‹ä¸­çš„ Lighting é¡¹ï¼Œè§£å†³äº† Shading çš„é—®é¢˜ï¼Œå¦‚æœéœ€è¦ Shadowingï¼Œå°±éœ€è¦åŠ å…¥å¯è§æ€§é¡¹ $V(p,\\omega_{i})$ï¼Œæ¸²æŸ“æ–¹ç¨‹å˜ä¸ºï¼š\n$$ L_{o}(p,\\omega_{o})=\\int_{\\Omega} \\underbrace {L_{i}(p,\\omega_{i})}_{Lighting} \\, \\underbrace {f_{r}(p,\\omega_{i},\\omega_{o})}_{BRDF} \\, \\underbrace {V(p,\\omega_{i})}_{Visibility} \\, \\max(0,\\cos \\theta_{i})\\,d\\omega_{i} $$ æš´åŠ›ç®—æ³•å°±æ˜¯æœå„ä¸ªæ–¹å‘åˆ†åˆ«å¯¹ Lightingï¼ŒBRDF å’Œ Visibility è®¡ç®—ï¼Œç„¶åå†é€é¡¹ç›¸ä¹˜ï¼Œå¼€é”€å¤ªå¤§ã€‚Sloan åœ¨ 2002 å¹´æå‡ºäº†PRTï¼ˆPrecomputed Radience Transferï¼‰ï¼Œå°†ç§¯åˆ†å†…éƒ¨åˆ†ä¸º Lighting å’Œ Light Transportï¼ˆå…‰çº¿ä¼ è¾“ï¼‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n$$ L_{o}(p,\\omega_{o})=\\int_{\\Omega} \\underbrace {L_{i}(p,\\omega_{i})}_{Lighting} \\, \\underbrace {f_{r}(p,\\omega_{i},\\omega_{o}) \\, V(p,\\omega_{i}) \\, \\max(0,\\cos \\theta_{i})}_{Light \\,Transport} \\, d\\omega_{i} $$ å‡è®¾ BRDF é¡¹æ˜¯ Diffuse çš„ï¼ŒBRDF é¡¹æ˜¯ä¸€ä¸ªå®šå€¼ $\\frac{\\rho}{\\pi}$ï¼Œå°† Lighting è¡¨ç¤ºä¸ºç³»æ•°å’ŒåŸºå‡½æ•°çš„å½¢å¼ï¼Œç„¶åäº¤æ¢ç§¯åˆ†ä¸æ±‚å’Œçš„ä½ç½®ï¼Œå°±å¯ä»¥å°†ç§¯åˆ†å†…éƒ¨å†æ¬¡è¡¨ç¤ºä¸ºåœ¨åŸºå‡½æ•°ä¸Šçš„æŠ•å½±ï¼š\n$$ \\begin{aligned} L(p,\\omega_{o})=\u0026 \\frac{\\rho}{\\pi} \\int_{\\Omega}\\sum l_{i}B_{i}(\\omega_{i})V(p,\\omega_{i})\\max(0,\\cos \\theta_{i}) \\, d\\omega_{i} \\\\ \\approx\u0026 \\frac{\\rho}{\\pi} \\sum l_{i} \\underbrace{ \\int_{\\Omega}B_{i}(\\omega_{i})V(p,\\omega_{i})\\max(0,\\cos \\theta_{i}) }_{Precomputed} \\, d\\omega_{i} \\\\ \\approx\u0026 \\frac{\\rho}{\\pi} \\sum l_{i}T_{i} \\end{aligned} $$ æ³¨æ„è¿™é‡Œæ˜¯å¯¹ $\\omega_{i}$ è¿›è¡Œç§¯åˆ†ï¼Œå¯¹æ¯ä¸€ä¸ªåŸºå‡½æ•°ä¸Šçš„æŠ•å½±è¿›è¡Œæ±‚å’Œ\nå…¶ä¸­ $l_{i}$ æ˜¯ Lighting é¡¹åœ¨åŸºå‡½æ•°ä¸ŠæŠ•å½±çš„ä¸€ç»„ç³»æ•°ï¼Œ$T_{i}$ æ˜¯ Light Transport é¡¹åœ¨åŸºå‡½æ•°ä¸ŠæŠ•å½±çš„ç³»æ•°ã€‚è¿™æ ·å°±æŠŠå¤šä¸ªå‡½æ•°ä¹˜ç§¯çš„ç§¯åˆ†è½¬å˜ä¸ºä¸€ä¸ªç®€å•çš„ç‚¹ä¹˜ã€‚\nç„¶è€Œè¿™äº›é¢„è®¡ç®—éœ€è¦ä¸€äº›å‰æï¼š\nVisibility æ˜¯å›ºå®šçš„ï¼Œå³è¦æ±‚åœºæ™¯ä¸­çš„ç‰©ä½“ä¸èƒ½åŠ¨ Lighting æ˜¯â€œå›ºå®šâ€çš„ï¼ŒLighting çš„æˆåˆ†ä¸èƒ½åŠ¨æ€å˜åŒ–ï¼Œä½† Lighting å¯ä»¥æ—‹è½¬ï¼ˆç›¸å½“äºå¯¹åŸºå‡½æ•°å¼ æˆçš„çº¿æ€§ç©ºé—´è¿›è¡Œæ—‹è½¬ï¼‰ å¾ˆåˆç†ï¼Œå°±åƒçƒ˜ç„™çš„å…‰ç…§ä¿¡æ¯æ˜¯é™æ€çš„ä¸€æ ·ã€‚\n0x02 é¢„è®¡ç®—çƒè°ç³»æ•° Precompute SH Coef å…‰ç…§é¡¹ç³»æ•° Lighting è¦ç®— SH ç³»æ•°ï¼Œå°±è¦æŠŠç¯å¢ƒå…‰ç…§æŠ•å½±åˆ°çƒè°å‡½æ•°ä¸Šï¼Œçƒè°å‡½æ•°å¯ä»¥è°ƒç”¨ sh::EvalSH è·å–ï¼ŒLighting é¡¹å¯ä»¥é€šè¿‡é¢„å­˜çš„ images æ•°ç»„è·å–ï¼Œå‰©ä¸‹ä¸€ä¸ªç«‹ä½“è§’ $d\\omega_{i}$ï¼š\n$$ d\\omega_{i}=\\sin \\theta \\, d\\theta \\, d\\phi $$ å…¶ä¸­ $\\theta$ æ˜¯æè§’ï¼Œ$\\phi$ æ˜¯æ–¹ä½è§’ã€‚å¯¹äºæ¯ä¸€ä¸ªç¯å¢ƒè´´å›¾ä¸Šçš„åƒç´ ï¼Œéœ€è¦è®¡ç®—å…¶æŠ•å½±åˆ°å•ä½çƒé¢çš„é¢ç§¯ï¼Œæ¡†æ¶ç»™äº† CalcArea è¿™ä¸ªå‡½æ•°è®¡ç®—è¿™ä¸ªé¢ç§¯ã€‚\nå…ˆæŠŠ texel ä» $[0,res-1]$ æ˜ å°„åˆ°ä»¥ CubeMap å½“å‰é¢ä¸­å¿ƒä¸ºåŸç‚¹çš„ $\\left[ \\frac{1}{res}-1,1-\\frac{1}{res} \\right]$ åæ ‡èŒƒå›´å†…ã€‚ç„¶åé€šè¿‡å››ä¸ªè§’ç‚¹çš„å·®å€¼è®¡ç®—é¢ç§¯ï¼Œæ¯ä¸ªç‚¹æ‰€å¯¹åº”çš„é¢ç§¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…¬å¼æ±‚è§£ï¼š\n$$ A(x,y)=\\arctan\\left( \\frac{xy}{\\sqrt{ x^2+y^2+1 }} \\right) $$ æ‰€ä»¥åœ¨ PrecomputeCubemapSH ä¸­ï¼Œåªéœ€è¦ä¸ºæ¯ä¸ª SH åŸºå‡½æ•°ä¸Šç´¯åŠ æ¯ä¸ª texel çš„è´¡çŒ®ï¼Œå°±å¯ä»¥å¾—åˆ° Lighting é¡¹çš„çƒè°ç³»æ•°ã€‚\næ— é˜´å½±ä¼ è¾“é¡¹ç³»æ•° UnShadowed ä¼ è¾“é¡¹çƒè°ç³»æ•°çš„è®¡ç®—åœ¨ preprocess å‡½æ•°ä¸­ï¼Œassignmet sheet é‡Œç»™çš„è®¡ç®—ä¼ è¾“é¡¹ä¼ªä»£ç æ¯”è¾ƒé•¿ï¼Œä½†æ¡†æ¶é‡Œä¸»è¦å…³æ³¨åˆ° shFunc è¿™ä¸ª lambda è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼è¿”å›éœ€è¦æŠ•å½±çš„å‡½æ•°åœ¨ç»™å®šæ–¹å‘ä¸Šçš„å‡½æ•°å€¼ï¼Œåç»­ä¼šä¼ å…¥ sh::ProjectFunction è¿›è¡Œè®¡ç®—ã€‚\nå¯¹äºæ— é˜´å½±çš„æƒ…å†µï¼Œè¦æŠ•å½±çš„å‡½æ•°å°±æ˜¯ç®€å•çš„ cos é¡¹ï¼š\n$$ M_{DU}=\\max(N_{x}\\cdot \\omega_{i},0) $$ è¿™é‡Œ H åæ¥æˆ‘æ”¾ if å¤–é¢äº†ï¼Œå…å¾—ä¸‹é¢å†å†™ä¸€é\næœ‰é˜´å½±ä¼ è¾“é¡¹ç³»æ•° Shadowed $$ M_{DU}=V(\\omega_{i})\\max(N_{x}\\cdot \\omega_{i},0) $$ è¦æŠ•å½±çš„å‡½æ•°å†ä¹˜ä¸Šä¸€ä¸ª Visibility é¡¹å³å¯ï¼š\nå¦‚æœæƒ³çœ‹è¿™æ­¥çš„ç»“æœï¼Œå°±æŠŠ prt.xml é‡Œæ”¹æˆ shadowedï¼Œç„¶åè¿è¡Œä¸‹ nori.exeã€‚\n1","wordCount":"2396","inLanguage":"zh","datePublished":"2025-04-19T00:00:00Z","dateModified":"2025-04-19T00:00:00Z","author":{"@type":"Person","name":"The Only Problem"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-2/"},"publisher":{"@type":"Organization","name":"The Only Problem's Blog","logo":{"@type":"ImageObject","url":"https://congyuxiaoyoudao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://congyuxiaoyoudao.github.io/ accesskey=h title="The Only Problem's Blog (Alt + H)">The Only Problem's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://congyuxiaoyoudao.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://congyuxiaoyoudao.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/>Posts</a>&nbsp;Â»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/assignments/>Assignments</a></div><h1 class="post-title entry-hint-parent">Assignment 5. GAMES202 Homework 2</h1><div class=post-meta><span title='2025-04-19 00:00:00 +0000 UTC'>å››æœˆ 19, 2025</span>&nbsp;Â·&nbsp;12 åˆ†é’Ÿ&nbsp;Â·&nbsp;The Only Problem</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#0x00-to-begin-with aria-label="0x00 To begin with">0x00 To begin with</a></li><li><a href=#0x01-%e5%89%8d%e7%bd%ae%e5%87%86%e5%a4%87-warm-up aria-label="0x01 å‰ç½®å‡†å¤‡ Warm Up">0x01 å‰ç½®å‡†å¤‡ Warm Up</a><ul><li><a href=#%e6%b8%b2%e6%9f%93%e6%96%b9%e7%a8%8b-render-equation aria-label="æ¸²æŸ“æ–¹ç¨‹ Render Equation">æ¸²æŸ“æ–¹ç¨‹ Render Equation</a></li><li><a href=#split-sum aria-label="Split Sum">Split Sum</a></li><li><a href=#%e7%90%83%e8%b0%90%e5%87%bd%e6%95%b0-spherical-harmonics aria-label="çƒè°å‡½æ•° Spherical Harmonics">çƒè°å‡½æ•° Spherical Harmonics</a></li><li><a href=#prtprecomputerd-radience-transfer aria-label="PRTï¼ˆPrecomputerd Radience Transferï¼‰">PRTï¼ˆPrecomputerd Radience Transferï¼‰</a></li></ul></li><li><a href=#0x02-%e9%a2%84%e8%ae%a1%e7%ae%97%e7%90%83%e8%b0%90%e7%b3%bb%e6%95%b0-precompute-sh-coef aria-label="0x02 é¢„è®¡ç®—çƒè°ç³»æ•° Precompute SH Coef">0x02 é¢„è®¡ç®—çƒè°ç³»æ•° Precompute SH Coef</a><ul><li><a href=#%e5%85%89%e7%85%a7%e9%a1%b9%e7%b3%bb%e6%95%b0-lighting aria-label="å…‰ç…§é¡¹ç³»æ•° Lighting">å…‰ç…§é¡¹ç³»æ•° Lighting</a></li><li><a href=#%e6%97%a0%e9%98%b4%e5%bd%b1%e4%bc%a0%e8%be%93%e9%a1%b9%e7%b3%bb%e6%95%b0-unshadowed aria-label="æ— é˜´å½±ä¼ è¾“é¡¹ç³»æ•° UnShadowed">æ— é˜´å½±ä¼ è¾“é¡¹ç³»æ•° UnShadowed</a></li><li><a href=#%e6%9c%89%e9%98%b4%e5%bd%b1%e4%bc%a0%e8%be%93%e9%a1%b9%e7%b3%bb%e6%95%b0-shadowed aria-label="æœ‰é˜´å½±ä¼ è¾“é¡¹ç³»æ•° Shadowed">æœ‰é˜´å½±ä¼ è¾“é¡¹ç³»æ•° Shadowed</a></li><li><a href=#%e5%8f%8d%e5%b0%84%e4%bc%a0%e8%be%93%e9%a1%b9%e7%b3%bb%e6%95%b0-inter-reflection aria-label="åå°„ä¼ è¾“é¡¹ç³»æ•° Inter-reflection">åå°„ä¼ è¾“é¡¹ç³»æ•° Inter-reflection</a></li></ul></li><li><a href=#0x03-%e5%ae%9e%e6%97%b6%e7%90%83%e8%b0%90%e5%85%89%e7%85%a7-realtime-sh-lighting aria-label="0x03 å®æ—¶çƒè°å…‰ç…§ Realtime SH Lighting">0x03 å®æ—¶çƒè°å…‰ç…§ Realtime SH Lighting</a><ul><li><a href=#%e6%96%b0%e5%bb%ba-prt-%e6%9d%90%e8%b4%a8-new-prt-material aria-label="æ–°å»º PRT æè´¨ New PRT Material">æ–°å»º PRT æè´¨ New PRT Material</a></li><li><a href=#%e7%bc%96%e5%86%99%e7%9d%80%e8%89%b2%e5%99%a8-write-shader aria-label="ç¼–å†™ç€è‰²å™¨ Write Shader">ç¼–å†™ç€è‰²å™¨ Write Shader</a></li><li><a href=#%e7%bb%93%e6%9e%9c-outcome aria-label="ç»“æœ Outcome">ç»“æœ Outcome</a></li></ul></li><li><a href=#0x04-%e7%90%83%e8%b0%90%e6%97%8b%e8%bd%ac-sh-rotation aria-label="0x04 çƒè°æ—‹è½¬ SH Rotation">0x04 çƒè°æ—‹è½¬ SH Rotation</a></li></ul></div></details></div><div class=post-content><blockquote><p>(âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡</p></blockquote><hr><h2 id=0x00-to-begin-with>0x00 To begin with<a hidden class=anchor aria-hidden=true href=#0x00-to-begin-with>#</a></h2><p>è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><input checked disabled type=checkbox> éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾</li><li><input checked disabled type=checkbox> GAMES202 ä½œä¸š 2</li></ul><p><strong>For reference</strong>ğŸ‘‡ï¼š</p><ul><li>ğŸ“ºB ç«™è§†é¢‘ï¼š
<a href="https://www.bilibili.com/video/BV1YK4y1T7yY/?spm_id_from=333.337.top_right_bar_window_custom_collection.content.click&amp;vd_source=b6584cebba3a7a1a34d2f60d63bdc868">GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“</a></li><li>ğŸ“¦ä»£ç ä»“åº“ï¼š
<a href=https://github.com/congyuxiaoyoudao/GAMES202_Homework/tree/working>congyuxiaoyoudao/GAMES202_Homework at working</a></li><li>ğŸ“ƒ
<a href=https://dl.acm.org/doi/10.1145/15886.15902>The rendering equation | ACM SIGGRAPH Computer Graphics</a></li><li>ğŸ“ƒ
<a href=https://dl.acm.org/doi/10.1145/566654.566612>Precomputed radiance transfer for real-time rendering in dynamic, low-frequency lighting environments | ACM Transactions on Graphics</a></li></ul><blockquote><p>master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…</p></blockquote><hr><h2 id=0x01-å‰ç½®å‡†å¤‡-warm-up>0x01 å‰ç½®å‡†å¤‡ Warm Up<a hidden class=anchor aria-hidden=true href=#0x01-å‰ç½®å‡†å¤‡-warm-up>#</a></h2><h3 id=æ¸²æŸ“æ–¹ç¨‹-render-equation>æ¸²æŸ“æ–¹ç¨‹ Render Equation<a hidden class=anchor aria-hidden=true href=#æ¸²æŸ“æ–¹ç¨‹-render-equation>#</a></h3><p>James T. Kajiyaï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªæå‡º Kajiya-Kay å¤´å‘ç€è‰²æ¨¡å‹çš„ Kajiyaï¼‰åœ¨ 1986 å¹´æå‡ºäº†æ¸²æŸ“æ–¹ç¨‹ï¼ˆThe Render Equationï¼‰ï¼ŒåŸè®ºæ–‡é‡Œé•¿è¿™æ ·ï¼š</p><div>$$
I(x,x')=g(x,x')\left[ \epsilon(x,x')+\int_{S}\rho(x,x',x'')I(x',x'')dx'' \right]
$$</div><p>å½“ç„¶ç°åœ¨çœ‹å¾—æ›´èˆ’æœçš„å½¢å¼é•¿è¿™æ ·ï¼š</p><div>$$
L_{o}(p,\omega_{o})=L_{e}(p,\omega_{o})+\int_{\Omega^+}L_{i}(p,\omega_{i})f_{r}(p,\omega_{i},\omega_{o})\cos\theta_{i}\space d\omega_{i}
$$</div><p>å…¶ä¸­ï¼š</p><ul><li>$L_{o}(p,\omega_{o})$ï¼šè¦æ±‚å‡ºå°„æ–¹å‘çš„è¾å°„ç‡ï¼ˆRadienceï¼‰</li><li>$L_{e}(p,\omega_{o})$ï¼šè‡ªå‘å…‰é¡¹</li><li>$\Omega^+$ï¼šç§¯åˆ†åŸŸï¼Œä»…å¯¹è¡¨é¢æ­£åŠçƒç§¯åˆ†</li><li>$L_{i}(p,\omega_{i})$ï¼šLightingï¼ŒæŸä¸€å…¥å°„æ–¹å‘çš„è¾å°„ç‡</li><li>$f_{r}(p,\omega_{i},\omega_{o})$ï¼šBRDFï¼Œæè¿°æŸä¸€å…¥å°„æ–¹å‘çš„å…‰çº¿åœ¨å‡ºå°„æ–¹å‘çš„è´¡çŒ®</li><li>$\cos \theta_{i}$ï¼šè¡¨é¢æ³•å‘ä¸æŸä¸€å…¥å°„æ–¹å‘å½¢æˆçš„å¤¹è§’ä½™å¼¦</li></ul><p>æ‰€ä»¥æ¸²æŸ“æ–¹ç¨‹å…¶å®å°±æè¿°äº†åœ¨å½“å‰ Shading Point ä¸Šï¼Œç»™å®šå…¥å°„å…‰ä¸å‡ºå°„æ–¹å‘ï¼ˆè§‚å¯Ÿæ–¹å‘ï¼‰ï¼Œåœ¨å‡ºå°„æ–¹å‘ä¸Šèƒ½å¤Ÿæ¥æ”¶åˆ°çš„ Radianceï¼Œä»»ä½•åœ¨è¡¨é¢ä¸Šè¿›è¡Œçš„å…‰çº¿ä¼ æ’­çš„ Shading éƒ½éœ€è¦è§£è¿™ä¸ªæ–¹ç¨‹ã€‚</p><h3 id=split-sum>Split Sum<a hidden class=anchor aria-hidden=true href=#split-sum>#</a></h3><p>å¯¹äºç¯å¢ƒå…‰ï¼Œé€šå¸¸ä½¿ç”¨ CubeMap æˆ–è€…ç­‰è·æŸ±å½¢æŠ•å½±å°†å›¾åƒæŠ•å°„åˆ°æ— é™è¿œçš„çƒé¢ä¸Šï¼Œè¦è·å¾—ç¯å¢ƒå…‰çš„ Shadingï¼ˆç›®å‰æš‚ä¸è€ƒè™‘ Shadowingï¼‰ï¼Œå°±éœ€è¦æ±‚è§£æ¸²æŸ“æ–¹ç¨‹ï¼Œæ ¸å¿ƒæ˜¯å¯¹äº Lighting éƒ¨åˆ†çš„æ±‚è§£ã€‚</p><p>å…ˆæŠ›å¼€æ¸²æŸ“æ–¹ç¨‹ï¼Œæƒ³è±¡ä¸€ä¸‹å½“è¡¨é¢æ˜¯ç†æƒ³é•œé¢çš„æƒ…å†µï¼šå¯¹äºæŸä¸ª Shading Pointï¼Œå…¶åå°„è¡Œä¸ºæ˜¯é•œé¢åå°„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ±‚å‡ºå°„æ–¹å‘å¯¹åº”çš„å…¥å°„æ–¹å‘ï¼Œæ ¹æ®è¿™ä¸ªæ–¹å‘æŸ¥è¯¢ç¯å¢ƒå…‰çš„é¢œè‰²ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504192355458.png#center></p><p>æ›´ General ä¸€ç‚¹ï¼Œå½“è¡¨é¢æ¯”è¾ƒç²—ç³™çš„æƒ…å†µï¼Œèƒ½å¤Ÿåå°„åˆ°å‡ºå°„æ–¹å‘çš„å…¥å°„è§’åœ¨é•œåå°„æ–¹å‘ä¸Šä¼šåœ¨æŸä¸ªè§’åº¦ $\phi$ èŒƒå›´å†…æŠ–åŠ¨åˆ†å¸ƒï¼Œæœ€ç»ˆåå°„åˆ°å‡ºå°„æ–¹å‘çš„ Lighting å—åˆ°è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰é‡‡æ ·ç‚¹é¢œè‰²çš„å½±å“ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç±»æ¯”äºå¯¹åŸå§‹çš„ç¯å¢ƒè´´å›¾è¿›è¡Œæ»¤æ³¢ï¼Œä¸”ç²—ç³™åº¦è¶Šå¤§ï¼Œæ»¤æ³¢æ ¸è¶Šå¤§ï¼Œè¿™æ ·å°±å¯ä»¥ä»ä½¿ç”¨é•œåå°„æ–¹å‘æŸ¥è¯¢æ»¤æ³¢åçš„å›¾åƒã€‚è¿™äº›æ»¤æ³¢åçš„å›¾åƒå½“ç„¶å¯ä»¥é¢„è®¡ç®—ï¼Œå½¢æˆä¸€ä¸ªæ¨¡ç³Šå±‚çº§ï¼Œç„¶åæ¸²æŸ“æ—¶æ ¹æ®ä¸åŒç²—ç³™åº¦ä½¿ç”¨ä¸åŒå›¾åƒã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504200006951.png#center></p><p>ä½†æ˜¯ç›®å‰ Lighting é¡¹åœ¨ç§¯åˆ†å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦å¯¹æ•´ä¸ªåŠçƒé¢ä¸Šçš„å…¥å°„æ–¹å‘éƒ½è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿˜æ˜¯æ¯”è¾ƒ Costy çš„ï¼Œæœ‰æ²¡æœ‰åŠæ³•æŠŠ Lighting ä»ç§¯åˆ†é‡Œç‹¬ç«‹å‡ºæ¥ï¼Ÿä¸‹é¢æœ‰ä¸€ç§è¿‘ä¼¼æ–¹æ³•ï¼š</p><div>$$
\int_{\Omega}f(x)g(x)dx\approx \frac{\int_{\Omega_{G}}f(x)dx}{\int_{\Omega_{G}}dx} \cdot \int_{\Omega}g(x)dx
$$</div><p>è¿™ä¸ªè¿‘ä¼¼åœ¨ $g(x)$ è´¡çŒ®æ¯”è¾ƒå°æˆ–è€…æ¯”è¾ƒå¹³æ»‘ï¼ˆä½é¢‘ï¼‰æ—¶æ˜¯ç›¸å¯¹å‡†ç¡®çš„ã€‚æ¼«åå°„ BRDF å°±å¾ˆå¥½åœ°æ»¡è¶³è¿™ä¸ªæ€§è´¨ï¼Œæ‰€ä»¥å¯ä»¥å¯¹æ¸²æŸ“æ–¹ç¨‹åº”ç”¨è¿™ä¸ªè¿‘ä¼¼ï¼š</p><div>$$
L_{o}(p,\omega_{o})\approx\frac{\int_{\Omega_{f_{r}}}L_{i}(p,\omega_{i})d\omega_{i}}{\int_{\Omega_{f_{r}}}d\omega_{i}}\cdot \int_{\Omega^+}f_{r}(p,\omega_{i},\omega_{o})\cos \theta_{i} \space d\omega_{i}
$$</div><p>ä¹˜å·å·¦è¾¹çš„éƒ¨åˆ†ä»£è¡¨ Lighting åœ¨ BRDF èŒƒå›´å†…çš„å¹³å‡ Radienceï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¯¹å‡ºå°„æ–¹å‘æœ‰è´¡çŒ®çš„å…¥å°„æ–¹å‘èŒƒå›´å†…åœ¨ç¯å¢ƒè´´å›¾ä¸Šé‡‡æ ·é¢œè‰²çš„å¹³å‡å€¼ã€‚é€šè¿‡å¯¹ç¯å¢ƒè´´å›¾çš„é¢„æ»¤æ³¢ï¼Œå¯ä»¥é€šè¿‡ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°è¿™ä¸ªå€¼ã€‚</p><h3 id=çƒè°å‡½æ•°-spherical-harmonics>çƒè°å‡½æ•° Spherical Harmonics<a hidden class=anchor aria-hidden=true href=#çƒè°å‡½æ•°-spherical-harmonics>#</a></h3><p><a href=https://zh.wikipedia.org/wiki/%E7%90%83%E8%B0%90%E5%87%BD%E6%95%B0>çƒè°å‡½æ•°</a></p><p>ç»´åŸºç™¾ç§‘ä¸Šçƒè°å‡½æ•°æ˜¯ä¸‹é¢è¿™ä¸ªå¼å­åœ¨ $m,l$ ä¸åŒå–å€¼æ—¶çš„è§£ï¼š</p><div>$$
Y^m_{l}(\theta, \phi)=(-1)^m\sqrt{ \frac{2l+1}{4\pi}\frac{(l-|m|)!}{(l+|m|)!} }P^m_{l}(\cos \theta)e^{im\phi}
$$</div><p>å®æ•°å½¢å¼ä¸‹å¯è§†åŒ–å‡ºæ¥æ˜¯é•¿è¿™æ ·çš„ï¼š</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504201716498.png#center></p><p>çœ‹ä¸Šå»æ˜¯ä¸æ˜¯å¾ˆåƒç‰©ç†/é‡å­åŒ–å­¦é‡Œé¢çš„ç”µå­äº‘å•¥çš„ï¼ˆè¿™ä¿©è¿˜çœŸæœ‰å…³ç³»ï¼‰ï¼Œä½†åœ¨å›¾å½¢å­¦é‡Œé¢ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç†è§£å…¶ç‰©ç†æ„ä¹‰ï¼Œå¯ä»¥ç®€å•å°†å…¶ç†è§£ä¸ºä¸€ç»„å®šä¹‰åœ¨çƒé¢ä¸Šçš„ä¸¤ä¸¤æ­£äº¤çš„åŸºå‡½æ•°ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚…é‡Œå¶å˜æ¢çš„æ€æƒ³å»æ‹Ÿåˆä»»ä½•çš„çƒé¢å‡½æ•°ã€‚</p><blockquote><p>åŸºå‡½æ•°ï¼ˆBasis Functionï¼‰ï¼šä¸€ç»„ä¸¤ä¸¤ä¹‹é—´ç›¸äº’ç‹¬ç«‹çš„å‡½æ•°ï¼Œå³åœ¨å½¼æ­¤ä¹‹ä¸Šçš„æŠ•å½±ä¸º 0ï¼Œå¯ä»¥ç±»æ¯”çº¿æ€§ä»£æ•°çš„åŸºå‘é‡ã€‚ä¸€ç»„åŸºå‡½æ•°å¼ æˆçš„ç©ºé—´æ˜¯å…¶ç»è¿‡çº¿æ€§ç»„åˆèƒ½å¤Ÿè¡¨ç¤ºçš„æ‰€æœ‰å‡½æ•°çš„é›†åˆ</p></blockquote><div>$$
\mathcal{F} = \left\{ f(x) = \sum_{i=1}^n c_{i}B_{i}(x) \,\middle|\, c_{i} \in \mathbb{R} \right\}
$$</div><p>å¯ä»¥é€šè¿‡å°†åŸå‡½æ•°æŠ•å½±åˆ°æŸä¸ªåŸºå‡½æ•°ä¸Šè·å–è¯¥åŸºå‡½æ•°å‰çš„ç³»æ•° $c_{i}$ï¼š</p><div>$$
c_{i}=\int_{\Omega}f(x)B_{i}(x)\,dx
$$</div><p>å®é™…ä½¿ç”¨æ—¶éœ€è¦æŠŠç§¯åˆ†ç¦»æ•£åŒ–ä¸ºä¸€ç³»åˆ—æ±‚å’Œçš„å½¢å¼ï¼Œç»™å®šä¸€ä¸ªå‡½æ•° $f(\omega_{i})$ï¼Œå¯ä»¥é€šè¿‡æŠ•å½±æ±‚å¾—å…¶åœ¨ $Y^m_{l}(\omega_{i})$ ä¸Šçš„ç³»æ•°ï¼š</p><div>$$
c^m_{l}\approx\sum_{i=1}^Nf(\omega_{i})\cdot Y^m_{l}(\omega_{i})\cdot \omega_{i}
$$</div><p>ç„¶åå°±å¯ä»¥ç”¨ç±»ä¼¼æ³°å‹’å±•å¼€çš„æ ·å­ç”¨åŸºå‡½æ•°è¡¨ç¤ºåŸå‡½æ•°ï¼š</p><div>$$
\begin{aligned}
f(x)=&\sum^{\infty}_{l=0}\sum^l_{m=-l}c^m_{l}\cdot Y^m_{l}(\omega_{i}) \\
=& \, c^0_{0}Y^0_{0}(\omega_{i})+c^1_{-1}Y^1_{-1}(\omega_{i})+c^1_{0}Y^1_{0}(\omega_{i})+\,\dots
\end{aligned}
$$</div><p>å¯¹äºä½é¢‘çš„å‡½æ•°ï¼Œåªå–å‰å‡ é¡¹è¿›è¡Œè¿‘ä¼¼ï¼Œå°±èƒ½è¾¾åˆ° Adequate çš„æ•ˆæœã€‚å¦‚æœ BRDF æ˜¯ç²—ç³™çš„ï¼Œå°±ç›¸å½“äºä¸€ä¸ªä½é€šæ»¤æ³¢å™¨ï¼Œå…¶å’Œ Lighting çš„ä¹˜ç§¯çš„ç§¯åˆ†ä»ç„¶æ˜¯ä½é¢‘çš„ã€‚</p><h3 id=prtprecomputerd-radience-transfer>PRTï¼ˆPrecomputerd Radience Transferï¼‰<a hidden class=anchor aria-hidden=true href=#prtprecomputerd-radience-transfer>#</a></h3><p>çƒè°å‡½æ•°ç”¨ä¸€ç»„åŸºå‡½æ•°æ‹Ÿåˆæ¸²æŸ“æ–¹ç¨‹ä¸­çš„ Lighting é¡¹ï¼Œè§£å†³äº† Shading çš„é—®é¢˜ï¼Œå¦‚æœéœ€è¦ Shadowingï¼Œå°±éœ€è¦åŠ å…¥å¯è§æ€§é¡¹ $V(p,\omega_{i})$ï¼Œæ¸²æŸ“æ–¹ç¨‹å˜ä¸ºï¼š</p><div>$$
L_{o}(p,\omega_{o})=\int_{\Omega}
\underbrace {L_{i}(p,\omega_{i})}_{Lighting} \,
\underbrace {f_{r}(p,\omega_{i},\omega_{o})}_{BRDF} \,
\underbrace {V(p,\omega_{i})}_{Visibility} \,
\max(0,\cos \theta_{i})\,d\omega_{i}
$$</div><p>æš´åŠ›ç®—æ³•å°±æ˜¯æœå„ä¸ªæ–¹å‘åˆ†åˆ«å¯¹ Lightingï¼ŒBRDF å’Œ Visibility è®¡ç®—ï¼Œç„¶åå†é€é¡¹ç›¸ä¹˜ï¼Œå¼€é”€å¤ªå¤§ã€‚Sloan åœ¨ 2002 å¹´æå‡ºäº†PRTï¼ˆPrecomputed Radience Transferï¼‰ï¼Œå°†ç§¯åˆ†å†…éƒ¨åˆ†ä¸º Lighting å’Œ Light Transportï¼ˆå…‰çº¿ä¼ è¾“ï¼‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><div>$$
L_{o}(p,\omega_{o})=\int_{\Omega}
\underbrace {L_{i}(p,\omega_{i})}_{Lighting} \,
\underbrace {f_{r}(p,\omega_{i},\omega_{o}) \,
V(p,\omega_{i}) \,
\max(0,\cos \theta_{i})}_{Light \,Transport} \,
d\omega_{i}
$$</div><p>å‡è®¾ BRDF é¡¹æ˜¯ Diffuse çš„ï¼ŒBRDF é¡¹æ˜¯ä¸€ä¸ªå®šå€¼ $\frac{\rho}{\pi}$ï¼Œå°† Lighting è¡¨ç¤ºä¸ºç³»æ•°å’ŒåŸºå‡½æ•°çš„å½¢å¼ï¼Œç„¶åäº¤æ¢ç§¯åˆ†ä¸æ±‚å’Œçš„ä½ç½®ï¼Œå°±å¯ä»¥å°†ç§¯åˆ†å†…éƒ¨å†æ¬¡è¡¨ç¤ºä¸ºåœ¨åŸºå‡½æ•°ä¸Šçš„æŠ•å½±ï¼š</p><div>$$
\begin{aligned}
L(p,\omega_{o})=& \frac{\rho}{\pi} \int_{\Omega}\sum l_{i}B_{i}(\omega_{i})V(p,\omega_{i})\max(0,\cos \theta_{i}) \, d\omega_{i} \\
\approx& \frac{\rho}{\pi} \sum l_{i}
\underbrace{ \int_{\Omega}B_{i}(\omega_{i})V(p,\omega_{i})\max(0,\cos \theta_{i}) }_{Precomputed}
\, d\omega_{i} \\
\approx& \frac{\rho}{\pi} \sum l_{i}T_{i}
\end{aligned}
$$</div><blockquote><p>æ³¨æ„è¿™é‡Œæ˜¯å¯¹ $\omega_{i}$ è¿›è¡Œç§¯åˆ†ï¼Œå¯¹æ¯ä¸€ä¸ªåŸºå‡½æ•°ä¸Šçš„æŠ•å½±è¿›è¡Œæ±‚å’Œ</p></blockquote><p>å…¶ä¸­ $l_{i}$ æ˜¯ Lighting é¡¹åœ¨åŸºå‡½æ•°ä¸ŠæŠ•å½±çš„ä¸€ç»„ç³»æ•°ï¼Œ$T_{i}$ æ˜¯ Light Transport é¡¹åœ¨åŸºå‡½æ•°ä¸ŠæŠ•å½±çš„ç³»æ•°ã€‚è¿™æ ·å°±æŠŠå¤šä¸ªå‡½æ•°ä¹˜ç§¯çš„ç§¯åˆ†è½¬å˜ä¸ºä¸€ä¸ªç®€å•çš„ç‚¹ä¹˜ã€‚</p><p>ç„¶è€Œè¿™äº›é¢„è®¡ç®—éœ€è¦ä¸€äº›å‰æï¼š</p><ul><li>Visibility æ˜¯å›ºå®šçš„ï¼Œå³è¦æ±‚åœºæ™¯ä¸­çš„ç‰©ä½“ä¸èƒ½åŠ¨</li><li>Lighting æ˜¯â€œå›ºå®šâ€çš„ï¼ŒLighting çš„æˆåˆ†ä¸èƒ½åŠ¨æ€å˜åŒ–ï¼Œä½† Lighting å¯ä»¥æ—‹è½¬ï¼ˆç›¸å½“äºå¯¹åŸºå‡½æ•°å¼ æˆçš„çº¿æ€§ç©ºé—´è¿›è¡Œæ—‹è½¬ï¼‰</li></ul><p>å¾ˆåˆç†ï¼Œå°±åƒçƒ˜ç„™çš„å…‰ç…§ä¿¡æ¯æ˜¯é™æ€çš„ä¸€æ ·ã€‚</p><hr><h2 id=0x02-é¢„è®¡ç®—çƒè°ç³»æ•°-precompute-sh-coef>0x02 é¢„è®¡ç®—çƒè°ç³»æ•° Precompute SH Coef<a hidden class=anchor aria-hidden=true href=#0x02-é¢„è®¡ç®—çƒè°ç³»æ•°-precompute-sh-coef>#</a></h2><h3 id=å…‰ç…§é¡¹ç³»æ•°-lighting>å…‰ç…§é¡¹ç³»æ•° Lighting<a hidden class=anchor aria-hidden=true href=#å…‰ç…§é¡¹ç³»æ•°-lighting>#</a></h3><p>è¦ç®— SH ç³»æ•°ï¼Œå°±è¦æŠŠç¯å¢ƒå…‰ç…§æŠ•å½±åˆ°çƒè°å‡½æ•°ä¸Šï¼Œçƒè°å‡½æ•°å¯ä»¥è°ƒç”¨ <code>sh::EvalSH</code> è·å–ï¼ŒLighting é¡¹å¯ä»¥é€šè¿‡é¢„å­˜çš„ <code>images</code> æ•°ç»„è·å–ï¼Œå‰©ä¸‹ä¸€ä¸ªç«‹ä½“è§’ $d\omega_{i}$ï¼š</p><div>$$
d\omega_{i}=\sin \theta \, d\theta \, d\phi
$$</div><p>å…¶ä¸­ $\theta$ æ˜¯æè§’ï¼Œ$\phi$ æ˜¯æ–¹ä½è§’ã€‚å¯¹äºæ¯ä¸€ä¸ªç¯å¢ƒè´´å›¾ä¸Šçš„åƒç´ ï¼Œéœ€è¦è®¡ç®—å…¶æŠ•å½±åˆ°å•ä½çƒé¢çš„é¢ç§¯ï¼Œæ¡†æ¶ç»™äº† <code>CalcArea</code> è¿™ä¸ªå‡½æ•°è®¡ç®—è¿™ä¸ªé¢ç§¯ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504202247143.png#center></p><p>å…ˆæŠŠ texel ä» $[0,res-1]$ æ˜ å°„åˆ°ä»¥ CubeMap å½“å‰é¢ä¸­å¿ƒä¸ºåŸç‚¹çš„ $\left[ \frac{1}{res}-1,1-\frac{1}{res} \right]$ åæ ‡èŒƒå›´å†…ã€‚ç„¶åé€šè¿‡å››ä¸ªè§’ç‚¹çš„å·®å€¼è®¡ç®—é¢ç§¯ï¼Œæ¯ä¸ªç‚¹æ‰€å¯¹åº”çš„é¢ç§¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…¬å¼æ±‚è§£ï¼š</p><div>$$
A(x,y)=\arctan\left( \frac{xy}{\sqrt{ x^2+y^2+1 }} \right)
$$</div><p>æ‰€ä»¥åœ¨ <code>PrecomputeCubemapSH</code> ä¸­ï¼Œåªéœ€è¦ä¸ºæ¯ä¸ª SH åŸºå‡½æ•°ä¸Šç´¯åŠ æ¯ä¸ª texel çš„è´¡çŒ®ï¼Œå°±å¯ä»¥å¾—åˆ° Lighting é¡¹çš„çƒè°ç³»æ•°ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504202312530.png#center></p><h3 id=æ— é˜´å½±ä¼ è¾“é¡¹ç³»æ•°-unshadowed>æ— é˜´å½±ä¼ è¾“é¡¹ç³»æ•° UnShadowed<a hidden class=anchor aria-hidden=true href=#æ— é˜´å½±ä¼ è¾“é¡¹ç³»æ•°-unshadowed>#</a></h3><p>ä¼ è¾“é¡¹çƒè°ç³»æ•°çš„è®¡ç®—åœ¨ <code>preprocess</code> å‡½æ•°ä¸­ï¼Œassignmet sheet é‡Œç»™çš„è®¡ç®—ä¼ è¾“é¡¹ä¼ªä»£ç æ¯”è¾ƒé•¿ï¼Œä½†æ¡†æ¶é‡Œä¸»è¦å…³æ³¨åˆ° <code>shFunc</code> è¿™ä¸ª lambda è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼è¿”å›éœ€è¦æŠ•å½±çš„å‡½æ•°åœ¨ç»™å®šæ–¹å‘ä¸Šçš„å‡½æ•°å€¼ï¼Œåç»­ä¼šä¼ å…¥ <code>sh::ProjectFunction</code> è¿›è¡Œè®¡ç®—ã€‚</p><p>å¯¹äºæ— é˜´å½±çš„æƒ…å†µï¼Œè¦æŠ•å½±çš„å‡½æ•°å°±æ˜¯ç®€å•çš„ cos é¡¹ï¼š</p><div>$$
M_{DU}=\max(N_{x}\cdot \omega_{i},0)
$$</div><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504202329397.png#center></p><blockquote><p>è¿™é‡Œ H åæ¥æˆ‘æ”¾ if å¤–é¢äº†ï¼Œå…å¾—ä¸‹é¢å†å†™ä¸€é</p></blockquote><h3 id=æœ‰é˜´å½±ä¼ è¾“é¡¹ç³»æ•°-shadowed>æœ‰é˜´å½±ä¼ è¾“é¡¹ç³»æ•° Shadowed<a hidden class=anchor aria-hidden=true href=#æœ‰é˜´å½±ä¼ è¾“é¡¹ç³»æ•°-shadowed>#</a></h3><div>$$
M_{DU}=V(\omega_{i})\max(N_{x}\cdot \omega_{i},0)
$$</div><p>è¦æŠ•å½±çš„å‡½æ•°å†ä¹˜ä¸Šä¸€ä¸ª Visibility é¡¹å³å¯ï¼š</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504232209586.png#center></p><p>å¦‚æœæƒ³çœ‹è¿™æ­¥çš„ç»“æœï¼Œå°±æŠŠ prt.xml é‡Œæ”¹æˆ shadowedï¼Œç„¶åè¿è¡Œä¸‹ nori.exeã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=ln>1</span><span class=cl><span class=nt>&lt;string</span> <span class=na>name=</span><span class=s>&#34;type&#34;</span> <span class=na>value=</span><span class=s>&#34;shadowed&#34;</span> <span class=nt>/&gt;</span>
</span></span></code></pre></div><blockquote><p>è®°å¾—æ”¹å®Œä»£ç  build ä¸€ä¸‹ï¼Œä¸ç„¶ .exe è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„ç»“æœ</p></blockquote><h3 id=åå°„ä¼ è¾“é¡¹ç³»æ•°-inter-reflection>åå°„ä¼ è¾“é¡¹ç³»æ•° Inter-reflection<a hidden class=anchor aria-hidden=true href=#åå°„ä¼ è¾“é¡¹ç³»æ•°-inter-reflection>#</a></h3><p>å¯¹äºå…·æœ‰ç›¸äº’åå°„çš„ä¼ è¾“é¡¹ï¼Œå…¶æ–¹ç¨‹å˜ä¸ºï¼š</p><div>$$
L_{DI}=L_{DS}+\frac{\rho}{\pi}\int_{S}\hat{L}(x',\omega_{i})(1-V(\omega_{i}))\max(N_{x}\cdot \omega_{i},0)\,d\omega_{i}
$$</div><p>æˆ‘ä»¬å·²ç»è®¡ç®—äº†æ¯ä¸ªé¡¶ç‚¹çš„ç›´æ¥å¯è§å…‰æºçš„ Lightningï¼ˆ$L_{DS}$ï¼‰ï¼Œè¿˜éœ€è¦è®¡ç®—é—´æ¥å…‰çš„ Lightingï¼Œå…¶ä¸­ï¼š</p><ul><li>$\hat{L}(x&rsquo;,\omega_{i})$ï¼šä» $\omega_{i}$ åˆ°ç‚¹ $x&rsquo;$ çš„ Radiance</li><li>$1-V(\omega_{i})$ï¼šè¢«é®æŒ¡çš„éƒ¨åˆ†</li></ul><p>æ‰€ä»¥è¿™ä¸ªå¼å­å¯¹æ¯ä¸ªé¡¶ç‚¹è®¡ç®—æ¥è‡ªç›´æ¥å¯è§å…‰æºçš„ Lightingï¼Œç„¶åéå†æ‰€æœ‰å¯èƒ½çš„ $\omega_{i}$ è®¡ç®—é—´æ¥å…‰çš„ Lightingï¼Œå¯¹äºæ¯ä¸ªäº¤ç‚¹è¿”å›é‡å¿ƒåæ ‡æ’å€¼åçš„çƒè°ç³»æ•°ï¼Œç„¶åä»¥å½“å‰äº¤ç‚¹ä¸ºåŸç‚¹ï¼Œè¿­ä»£è®¡ç®—ä¼ è¾“é¡¹ç³»æ•°ã€‚</p><p>å› ä¸ºè§‰å¾— lambda æœ‰ç‚¹å¥½ç©ï¼Œå°±æ‹¿ lambda å†™äº†ä¸€ä¸ªé€’å½’ï¼Œå…¶å®ä¹Ÿå¯ä»¥å¦å¤–å°è£…ä¸€ä¸ªå‡½æ•°ï¼Œå›¾ç‰‡å¤ªé•¿ä¸å¥½æˆªï¼Œç›´æ¥æ”¾ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl> <span class=k>if</span> <span class=p>(</span><span class=n>m_Type</span> <span class=o>==</span> <span class=n>Type</span><span class=o>::</span><span class=n>Interreflection</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>            <span class=c1>// for each vertex cast a ray to the scene
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>            <span class=c1>// if occluded return interpolated sh coef
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>            <span class=c1>// then recursively call this function
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>            <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>mesh</span><span class=o>-&gt;</span><span class=n>getVertexCount</span><span class=p>();</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>                <span class=k>const</span> <span class=n>Point3f</span> <span class=o>&amp;</span><span class=n>v</span> <span class=o>=</span> <span class=n>mesh</span><span class=o>-&gt;</span><span class=n>getVertexPositions</span><span class=p>().</span><span class=n>col</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>                <span class=k>const</span> <span class=n>Normal3f</span> <span class=o>&amp;</span><span class=n>n</span> <span class=o>=</span> <span class=n>mesh</span><span class=o>-&gt;</span><span class=n>getVertexNormals</span><span class=p>().</span><span class=n>col</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>                <span class=c1>// iterate lambda
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>                <span class=c1>// need to pass pos, normal, scene, original coeff and current bounce
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>                <span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>Eigen</span><span class=o>::</span><span class=n>MatrixXf</span><span class=o>*</span><span class=p>,</span> <span class=k>const</span> <span class=n>Point3f</span><span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>Normal3f</span><span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>Scene</span><span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>iterateSHFunc</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                <span class=n>iterateSHFunc</span> <span class=o>=</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>Eigen</span><span class=o>::</span><span class=n>MatrixXf</span><span class=o>*</span> <span class=n>TransportSHCoeffs</span><span class=p>,</span> <span class=k>const</span> <span class=n>Point3f</span> <span class=o>&amp;</span><span class=n>pos</span><span class=p>,</span> <span class=k>const</span> <span class=n>Normal3f</span> <span class=o>&amp;</span><span class=n>normal</span><span class=p>,</span> <span class=k>const</span> <span class=n>Scene</span><span class=o>*</span> <span class=n>s</span><span class=p>,</span> <span class=kt>int</span> <span class=n>bounce</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>                    <span class=c1>// Step 1: allocate and assign 0 to coeffs
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>                    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span> <span class=n>coeffs</span><span class=p>(</span><span class=k>new</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                    <span class=n>coeffs</span><span class=o>-&gt;</span><span class=n>assign</span><span class=p>(</span><span class=n>SHCoeffLength</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                
</span></span><span class=line><span class=ln>20</span><span class=cl>                    <span class=c1>// Step 2: judge by bounce to terminate
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1></span>                    <span class=k>if</span> <span class=p>(</span><span class=n>bounce</span> <span class=o>&gt;</span> <span class=n>m_Bounce</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                        <span class=k>return</span> <span class=n>coeffs</span><span class=p>;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>                
</span></span><span class=line><span class=ln>24</span><span class=cl>                    <span class=c1>// Step 3: generate sample_side^2 uniformly and stratified samples over the sphere
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>                    <span class=k>const</span> <span class=kt>int</span> <span class=n>sample_side</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>floor</span><span class=p>(</span><span class=n>sqrt</span><span class=p>(</span><span class=n>m_SampleCount</span><span class=p>)));</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>                    <span class=n>std</span><span class=o>::</span><span class=n>random_device</span> <span class=n>rd</span><span class=p>;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>                    <span class=n>std</span><span class=o>::</span><span class=n>mt19937</span> <span class=n>gen</span><span class=p>(</span><span class=n>rd</span><span class=p>());</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>                    <span class=n>std</span><span class=o>::</span><span class=n>uniform_real_distribution</span><span class=o>&lt;&gt;</span> <span class=n>rng</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>t</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>t</span> <span class=o>&lt;</span> <span class=n>sample_side</span><span class=p>;</span> <span class=n>t</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>p</span> <span class=o>&lt;</span> <span class=n>sample_side</span><span class=p>;</span> <span class=n>p</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>                        <span class=p>{</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>                            <span class=kt>double</span> <span class=n>alpha</span> <span class=o>=</span> <span class=p>(</span><span class=n>t</span> <span class=o>+</span> <span class=n>rng</span><span class=p>(</span><span class=n>gen</span><span class=p>))</span> <span class=o>/</span> <span class=n>sample_side</span><span class=p>;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>                            <span class=kt>double</span> <span class=n>beta</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=n>rng</span><span class=p>(</span><span class=n>gen</span><span class=p>))</span> <span class=o>/</span> <span class=n>sample_side</span><span class=p>;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>                            <span class=kt>double</span> <span class=n>phi</span> <span class=o>=</span> <span class=mf>2.0</span> <span class=o>*</span> <span class=n>M_PI</span> <span class=o>*</span> <span class=n>beta</span><span class=p>;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>                            <span class=kt>double</span> <span class=n>theta</span> <span class=o>=</span> <span class=n>acos</span><span class=p>(</span><span class=mf>2.0</span> <span class=o>*</span> <span class=n>alpha</span> <span class=o>-</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>                
</span></span><span class=line><span class=ln>38</span><span class=cl>                            <span class=c1>// Step 4: for each wi cast a ray to the scene
</span></span></span><span class=line><span class=ln>39</span><span class=cl><span class=c1></span>                            <span class=n>Eigen</span><span class=o>::</span><span class=n>Array3d</span> <span class=n>d</span> <span class=o>=</span> <span class=n>sh</span><span class=o>::</span><span class=n>ToVector</span><span class=p>(</span><span class=n>phi</span><span class=p>,</span> <span class=n>theta</span><span class=p>);</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>                            <span class=k>const</span> <span class=k>auto</span> <span class=n>wi</span> <span class=o>=</span> <span class=n>Vector3f</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>x</span><span class=p>(),</span> <span class=n>d</span><span class=p>.</span><span class=n>y</span><span class=p>(),</span> <span class=n>d</span><span class=p>.</span><span class=n>z</span><span class=p>());</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>                            <span class=kt>float</span> <span class=n>H</span> <span class=o>=</span> <span class=n>wi</span><span class=p>.</span><span class=n>dot</span><span class=p>(</span><span class=n>normal</span><span class=p>);</span> 
</span></span><span class=line><span class=ln>42</span><span class=cl>                
</span></span><span class=line><span class=ln>43</span><span class=cl>                            <span class=n>Ray3f</span> <span class=n>ray</span> <span class=o>=</span> <span class=n>Ray3f</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>wi</span><span class=p>);</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>                            <span class=n>Intersection</span> <span class=n>its</span><span class=p>;</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>                            <span class=k>if</span><span class=p>(</span><span class=n>H</span> <span class=o>&gt;</span> <span class=mf>0.0</span> <span class=o>&amp;&amp;</span> <span class=n>s</span><span class=o>-&gt;</span><span class=n>rayIntersect</span><span class=p>(</span><span class=n>ray</span><span class=p>,</span> <span class=n>its</span><span class=p>))</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>                                <span class=c1>// Step 5: if occluded, get the intersected point and its normal
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1></span>                                <span class=n>Point3f</span> <span class=n>intersectPos</span> <span class=o>=</span> <span class=n>its</span><span class=p>.</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>                                <span class=n>Vector3f</span> <span class=n>baryCoord</span> <span class=o>=</span> <span class=n>its</span><span class=p>.</span><span class=n>bary</span><span class=p>;</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>                                <span class=n>Point3f</span> <span class=n>idx</span> <span class=o>=</span> <span class=n>its</span><span class=p>.</span><span class=n>tri_index</span><span class=p>;</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>                                <span class=n>MatrixXf</span> <span class=n>normals</span> <span class=o>=</span> <span class=n>mesh</span><span class=o>-&gt;</span><span class=n>getVertexNormals</span><span class=p>();</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>                                <span class=n>Normal3f</span> <span class=n>intersectNormal</span> <span class=o>=</span> <span class=n>Normal3f</span><span class=p>(</span><span class=n>normals</span><span class=p>.</span><span class=n>col</span><span class=p>(</span><span class=n>idx</span><span class=p>.</span><span class=n>x</span><span class=p>()).</span><span class=n>normalized</span><span class=p>()</span> <span class=o>*</span> <span class=n>baryCoord</span><span class=p>.</span><span class=n>x</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>                                                                        <span class=n>normals</span><span class=p>.</span><span class=n>col</span><span class=p>(</span><span class=n>idx</span><span class=p>.</span><span class=n>y</span><span class=p>()).</span><span class=n>normalized</span><span class=p>()</span> <span class=o>*</span> <span class=n>baryCoord</span><span class=p>.</span><span class=n>y</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>                                                                        <span class=n>normals</span><span class=p>.</span><span class=n>col</span><span class=p>(</span><span class=n>idx</span><span class=p>.</span><span class=n>z</span><span class=p>()).</span><span class=n>normalized</span><span class=p>()</span> <span class=o>*</span> <span class=n>baryCoord</span><span class=p>.</span><span class=n>z</span><span class=p>()).</span><span class=n>normalized</span><span class=p>();</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>                                <span class=k>auto</span> <span class=n>nextBounceCoeffs</span> <span class=o>=</span> <span class=n>iterateSHFunc</span><span class=p>(</span><span class=n>TransportSHCoeffs</span><span class=p>,</span> <span class=n>intersectPos</span><span class=p>,</span> <span class=n>intersectNormal</span><span class=p>,</span> <span class=n>scene</span><span class=p>,</span> <span class=n>bounce</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>                
</span></span><span class=line><span class=ln>57</span><span class=cl>                                <span class=c1>// Step 6: accumulate the coeffs
</span></span></span><span class=line><span class=ln>58</span><span class=cl><span class=c1></span>                                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>SHCoeffLength</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>                                <span class=p>{</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>                                    <span class=k>auto</span> <span class=n>interpolateSH</span> <span class=o>=</span> <span class=p>(</span><span class=n>TransportSHCoeffs</span><span class=o>-&gt;</span><span class=n>col</span><span class=p>(</span><span class=n>idx</span><span class=p>.</span><span class=n>x</span><span class=p>()).</span><span class=n>coeffRef</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>*</span> <span class=n>baryCoord</span><span class=p>.</span><span class=n>x</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>                                                                <span class=n>TransportSHCoeffs</span><span class=o>-&gt;</span><span class=n>col</span><span class=p>(</span><span class=n>idx</span><span class=p>.</span><span class=n>y</span><span class=p>()).</span><span class=n>coeffRef</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>*</span> <span class=n>baryCoord</span><span class=p>.</span><span class=n>y</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>                                                                <span class=n>TransportSHCoeffs</span><span class=o>-&gt;</span><span class=n>col</span><span class=p>(</span><span class=n>idx</span><span class=p>.</span><span class=n>z</span><span class=p>()).</span><span class=n>coeffRef</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>*</span> <span class=n>baryCoord</span><span class=p>.</span><span class=n>z</span><span class=p>());</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>                
</span></span><span class=line><span class=ln>64</span><span class=cl>                                    <span class=p>(</span><span class=o>*</span><span class=n>coeffs</span><span class=p>)[</span><span class=n>k</span><span class=p>]</span> <span class=o>+=</span> <span class=p>(</span><span class=n>interpolateSH</span> <span class=o>+</span> <span class=p>(</span><span class=o>*</span><span class=n>nextBounceCoeffs</span><span class=p>)[</span><span class=n>k</span><span class=p>])</span> <span class=o>*</span> <span class=n>H</span><span class=p>;</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>69</span><span class=cl>                    <span class=c1>// Step 7: return the coeffs
</span></span></span><span class=line><span class=ln>70</span><span class=cl><span class=c1></span>                    <span class=kt>double</span> <span class=n>weight</span> <span class=o>=</span> <span class=p>(</span><span class=n>sample_side</span> <span class=o>*</span> <span class=n>sample_side</span><span class=p>);</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>                    <span class=k>for</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>c</span> <span class=o>&lt;</span> <span class=n>coeffs</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span> <span class=n>c</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>72</span><span class=cl>                        <span class=p>(</span><span class=o>*</span><span class=n>coeffs</span><span class=p>)[</span><span class=n>c</span><span class=p>]</span> <span class=o>/=</span> <span class=n>weight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>73</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>74</span><span class=cl>                
</span></span><span class=line><span class=ln>75</span><span class=cl>                    <span class=k>return</span> <span class=n>coeffs</span><span class=p>;</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>                <span class=p>};</span>
</span></span><span class=line><span class=ln>77</span><span class=cl>                
</span></span><span class=line><span class=ln>78</span><span class=cl>                <span class=c1>// Step 8: call the iterateSHFunc
</span></span></span><span class=line><span class=ln>79</span><span class=cl><span class=c1></span>                <span class=k>auto</span> <span class=n>interreflectCoeffs</span> <span class=o>=</span> <span class=n>iterateSHFunc</span><span class=p>(</span><span class=o>&amp;</span><span class=n>m_TransportSHCoeffs</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>scene</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>80</span><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>SHCoeffLength</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>81</span><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=ln>82</span><span class=cl>                    <span class=n>m_TransportSHCoeffs</span><span class=p>.</span><span class=n>col</span><span class=p>(</span><span class=n>i</span><span class=p>).</span><span class=n>coeffRef</span><span class=p>(</span><span class=n>j</span><span class=p>)</span> <span class=o>+=</span> <span class=p>(</span><span class=o>*</span><span class=n>interreflectCoeffs</span><span class=p>)[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=ln>83</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>84</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>85</span><span class=cl>        <span class=p>}</span>
</span></span></code></pre></div><blockquote><p>è¿™é‡Œä½¿ç”¨ <code>std::function</code> åŒ…è£…äº†ä¸€ä¸‹è¿™ä¸ª lambdaï¼Œä¸ç„¶å…¶å†…éƒ¨ä¸èƒ½è°ƒç”¨è‡ªå·±ï¼›ç”Ÿæˆé‡‡æ ·ç‚¹çš„è¿‡ç¨‹å¯ä»¥ç…§ç€ <code>sh::ProjectFunction</code> é‡Œé¢æŠ„</p></blockquote><p>åœ¨è°ƒç”¨æ—¶å¯ä»¥ä¿®æ”¹ <code>m_Bounce</code> çš„å€¼æ§åˆ¶å…‰çº¿åå¼¹æ¬¡æ•°ï¼ˆlambda è¿­ä»£æ¬¡æ•°ï¼‰ï¼Œæˆ‘è¿™é‡Œä»ç„¶æ˜¯é»˜è®¤å€¼ 1ï¼Œä¹‹å‰æ”¹äº†ä¸€æ¬¡ 2 ç»™æˆ‘è·‘äº†ä¸€ä¸ªå¤šå°æ—¶ï¼Œ(à¹‘â•¹â—¡â•¹à¹‘)ã€‚</p><hr><h2 id=0x03-å®æ—¶çƒè°å…‰ç…§-realtime-sh-lighting>0x03 å®æ—¶çƒè°å…‰ç…§ Realtime SH Lighting<a hidden class=anchor aria-hidden=true href=#0x03-å®æ—¶çƒè°å…‰ç…§-realtime-sh-lighting>#</a></h2><p>è¿è¡Œ nori.exe åï¼Œè®¡ç®—å¾—åˆ°çš„çƒè°ç³»æ•°å°†ä¿å­˜åœ¨ prt/scenes/cubemap/ å¯¹åº”ç¯å¢ƒè´´å›¾æ–‡ä»¶å¤¹ä¸‹ï¼Œéœ€è¦æ‰‹å·¥å…ˆæŠŠ light.txt å’Œ transport.txt æ”¾åˆ° homework2/assets/cubemap/ å¯¹åº”çš„ç¯å¢ƒè´´å›¾æ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>engine.js ä¸­çš„ç¬¬ 88-114 è¡Œå·²ç»å¸®æˆ‘ä»¬å®Œæˆäº†è§£æè¿™äº›æ–‡ä»¶çš„å·¥ä½œï¼Œæœ€ç»ˆ Lighting å’Œ Transport é¡¹çš„çƒè°ç³»æ•°è¢«ä¿å­˜åœ¨ precomputeL å’Œ precomputeLT ä¸¤ä¸ªæ•°ç»„ä¸­ï¼Œè¿™ä¸¤ä¸ªæ•°ç»„åŒ…å«åœ¨ <code>envmap</code> ä¸­æ‰€æœ‰ç¯å¢ƒçº¹ç†çš„çƒè°ç³»æ•°ï¼Œå…¶å½¢çŠ¶ä¸ºï¼š</p><div>$$
\begin{aligned}
precomputeL =& EnvMapNum*3*(SHOrder+1)^{2} \\
precomputeLT =& EnvMapNum*VertexCount*(SHOrder+1)^{2}
\end{aligned}
$$</div><p>å¯ä»¥é€šè¿‡ <code>guiParams.envmapId</code> è·å–å½“å‰ GUI ä¸­æ¿€æ´»çš„ç¯å¢ƒçº¹ç†ç´¢å¼•ï¼Œä»¥ä»ä»¥ä¸Šæ•°ç»„ä¸­è·å–å¯¹åº”çš„çƒè°ç³»æ•°ã€‚</p><h3 id=æ–°å»º-prt-æè´¨-new-prt-material>æ–°å»º PRT æè´¨ New PRT Material<a hidden class=anchor aria-hidden=true href=#æ–°å»º-prt-æè´¨-new-prt-material>#</a></h3><p>åœ¨ src/material/ ä¸‹æ–°å»ºPRTMaterial.jsï¼Œç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„æè´¨ï¼Œä¼ çš„ç»Ÿä¸€å˜é‡ä»…ä¸ºé¢„è®¡ç®—å…‰ç…§é¡¹çš„å„åˆ†é‡ï¼ˆRGBï¼‰ï¼Œattributeï¼ˆ<code>aPrecomputeLT</code>ï¼‰æŒ‰ç…§ assignment sheet é‡Œçš„è¦æ±‚ä¼ å…¥ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=kr>class</span> <span class=nx>PRTMaterial</span> <span class=kr>extends</span> <span class=nx>Material</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>        <span class=kr>super</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>            <span class=c1>// PRT
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>            <span class=s1>&#39;uPrecomputeL[0]&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;precomputeL&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=kc>null</span> <span class=p>},</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=s1>&#39;uPrecomputeL[1]&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;precomputeL&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=kc>null</span> <span class=p>},</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>            <span class=s1>&#39;uPrecomputeL[2]&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;precomputeL&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=kc>null</span> <span class=p>},</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=p>},</span> <span class=p>[</span><span class=s1>&#39;aPrecomputeLT&#39;</span><span class=p>],</span> <span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>buildPRTMaterial</span><span class=p>(</span><span class=nx>vertexPath</span><span class=p>,</span> <span class=nx>fragmentPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=kd>let</span> <span class=nx>vertexShader</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getShaderString</span><span class=p>(</span><span class=nx>vertexPath</span><span class=p>);</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=kd>let</span> <span class=nx>fragmentShader</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getShaderString</span><span class=p>(</span><span class=nx>fragmentPath</span><span class=p>);</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>PRTMaterial</span><span class=p>(</span><span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>);</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>åœ¨ Shader ä¸­ï¼Œ<code>uPrecomputeL</code> æ˜¯ä¸€ä¸ªç±»å‹ä¸º mat3 çš„æ•°ç»„ï¼Œç´¢å¼•å¯¹åº” RGB åˆ†é‡çš„çƒè°ç³»æ•°ï¼Œéœ€è¦é€ä¸€ç»‘å®š</p></blockquote><p>utils/tools.js ä¸­æä¾›äº†ç”¨äºå°† precomputeL åˆ†è§£ä¸ºä¸‰ä¸ª mat3 ç±»å‹çš„æ•°ç»„çš„å‡½æ•° <code>getMat3ValueFromRGB</code>ï¼Œæ¯å¸§çš„ render ä¸­éœ€è¦å¯¹å…¶è¿›è¡Œç»‘å®šï¼ŒWebGLRenderer.js ä¸­ï¼š</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504232252839.png#center></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>1</span><span class=cl><span class=kd>let</span> <span class=nx>precomputeL_RGBMat3</span> <span class=o>=</span> <span class=nx>getMat3ValueFromRGB</span><span class=p>(</span><span class=nx>precomputeL</span><span class=p>[</span><span class=nx>guiParams</span><span class=p>.</span><span class=nx>envmapId</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=mi>3</span> <span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>k</span> <span class=o>==</span> <span class=sb>`uPrecomputeL[</span><span class=si>${</span><span class=nx>j</span><span class=si>}</span><span class=sb>]`</span><span class=p>){</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>		<span class=nx>gl</span><span class=p>.</span><span class=nx>uniformMatrix3fv</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>meshes</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>shader</span><span class=p>.</span><span class=nx>program</span><span class=p>.</span><span class=nx>uniforms</span><span class=p>[</span><span class=nx>k</span><span class=p>],</span><span class=kc>false</span><span class=p>,</span><span class=nx>precomputeL_RGBMat3</span><span class=p>[</span><span class=nx>j</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ä¹‹åå¯ä»¥å…ˆåœ¨ index.html ä¸­å¼•å…¥ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=ln>1</span><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;src/materials/PRTMaterial.js&#34;</span> <span class=na>defer</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>ç„¶ååœ¨ loadOBJ.js ä¸­å¢åŠ  PRT æè´¨çš„ caseï¼š</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504232228474.png#center></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>1</span><span class=cl><span class=k>case</span> <span class=s1>&#39;PRTMaterial&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>	<span class=nx>material</span> <span class=o>=</span> <span class=nx>buildPRTMaterial</span><span class=p>(</span><span class=s2>&#34;./src/shaders/PRTShader/PRTVertex.glsl&#34;</span><span class=p>,</span> <span class=s2>&#34;./src/shaders/PRTShader/PRTFragment.glsl&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>	<span class=k>break</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=ç¼–å†™ç€è‰²å™¨-write-shader>ç¼–å†™ç€è‰²å™¨ Write Shader<a hidden class=anchor aria-hidden=true href=#ç¼–å†™ç€è‰²å™¨-write-shader>#</a></h3><p>åœ¨ shaders/PRTShader/ ä¸‹æ–°å»º PRT çš„é¡¶ç‚¹å’Œç‰‡å…ƒç€è‰²å™¨æ–‡ä»¶ï¼Œä½œä¸šä¸­éœ€è¦æˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å®Œæˆå¯¹ Lighting å’Œ Transport çš„çƒè°ç³»æ•°çš„ç‚¹ä¹˜ï¼Œç»“æœ <code>vColor</code> ç»æ’å€¼åä¼ è‡³ç‰‡å…ƒç€è‰²å™¨ï¼Œç›´æ¥è¾“å‡ºã€‚</p><p>æ‰€ä»¥ç‰‡å…ƒç€è‰²å™¨å¾ˆç®€å•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// prtFragment.glsl</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp>#ifdef GL_ES</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>precision</span> <span class=k>mediump</span> <span class=k>float</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=cp>#endif</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vColor</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=k>void</span> <span class=n>main</span><span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>   <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>vColor</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>é¡¶ç‚¹ç€è‰²å™¨ä¸­éœ€è¦å®Œæˆå¯¹ <code>vColor</code> çš„è®¡ç®—ï¼Œçœ‹ä¸€ä¸‹ä¼ è¿‡æ¥çš„ <code>uPrecomputeL[3]</code> å’Œ <code>aPrecomputeLT</code> é•¿ä»€ä¹ˆæ ·å­ï¼š</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504232317208.png#center>
emmï¼Œéƒ½æ˜¯ mat3 æ²¡åŠæ³•ç®€å•ç‚¹ä¹˜ï¼Œé‚£å°±å†™ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå®ƒä»¬éƒ½åˆ†æˆä¸‰ä¸ª vec3ï¼Œç„¶åç‚¹ä¹˜æ±‚å’Œå³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// prtVertex.glsl</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=k>attribute</span> <span class=k>vec3</span> <span class=n>aVertexPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>attribute</span> <span class=k>vec3</span> <span class=n>aNormalPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=k>attribute</span> <span class=n>mat3</span> <span class=n>aPrecomputeLT</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>uModelMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>uViewMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>uProjectionMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>uniform</span> <span class=n>mat3</span> <span class=n>uPrecomputeL</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vNormal</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vColor</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=k>float</span> <span class=n>LoT</span> <span class=p>(</span><span class=n>mat3</span> <span class=n>L</span><span class=p>,</span> <span class=n>mat3</span> <span class=n>LT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=k>vec3</span> <span class=n>L0</span> <span class=o>=</span> <span class=n>L</span><span class=p>[</span><span class=mo>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=k>vec3</span> <span class=n>L1</span> <span class=o>=</span> <span class=n>L</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=k>vec3</span> <span class=n>L2</span> <span class=o>=</span> <span class=n>L</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=k>vec3</span> <span class=n>LT0</span> <span class=o>=</span> <span class=n>LT</span><span class=p>[</span><span class=mo>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=k>vec3</span> <span class=n>LT1</span> <span class=o>=</span> <span class=n>LT</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=k>vec3</span> <span class=n>LT2</span> <span class=o>=</span> <span class=n>LT</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=k>return</span> <span class=n>dot</span><span class=p>(</span><span class=n>L0</span><span class=p>,</span> <span class=n>LT0</span><span class=p>)</span> <span class=o>+</span> <span class=n>dot</span><span class=p>(</span><span class=n>L1</span><span class=p>,</span> <span class=n>LT1</span><span class=p>)</span> <span class=o>+</span> <span class=n>dot</span><span class=p>(</span><span class=n>L2</span><span class=p>,</span> <span class=n>LT2</span><span class=p>);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=k>void</span> <span class=n>main</span><span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=n>vNormal</span> <span class=o>=</span> <span class=p>(</span><span class=n>uModelMatrix</span> <span class=o>*</span> <span class=k>vec4</span><span class=p>(</span><span class=n>aNormalPosition</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>)).</span><span class=n>xyz</span><span class=p>;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=n>gl_Position</span> <span class=o>=</span> <span class=n>uProjectionMatrix</span> <span class=o>*</span> <span class=n>uViewMatrix</span> <span class=o>*</span> <span class=n>uModelMatrix</span> <span class=o>*</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                <span class=k>vec4</span><span class=p>(</span><span class=n>aVertexPosition</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=c1>// rgb color from precomputed light transport</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=k>float</span> <span class=n>r</span> <span class=o>=</span> <span class=n>LoT</span><span class=p>(</span><span class=n>uPrecomputeL</span><span class=p>[</span><span class=mo>0</span><span class=p>],</span><span class=n>aPrecomputeLT</span><span class=p>);</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>  <span class=k>float</span> <span class=n>g</span> <span class=o>=</span> <span class=n>LoT</span><span class=p>(</span><span class=n>uPrecomputeL</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>aPrecomputeLT</span><span class=p>);</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>  <span class=k>float</span> <span class=n>b</span> <span class=o>=</span> <span class=n>LoT</span><span class=p>(</span><span class=n>uPrecomputeL</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=n>aPrecomputeLT</span><span class=p>);</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=n>vColor</span> <span class=o>=</span> <span class=k>vec3</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=ç»“æœ-outcome>ç»“æœ Outcome<a hidden class=anchor aria-hidden=true href=#ç»“æœ-outcome>#</a></h3><p>æœ€ååœ¨ engine.js ä¸­è°ƒç”¨ <code>loadOBJ</code> åŠ è½½ 202 å¨˜ï¼Œé¡ºä¾¿æŠŠè¿˜æœ‰ä¸€å¼ æ²¡åœ¨ GUI ä¸Šçš„ç¯å¢ƒçº¹ç†æ”¾ä¸Šå»ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=kd>var</span> <span class=nx>envmap</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>	<span class=s1>&#39;assets/cubemap/GraceCathedral&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>	<span class=s1>&#39;assets/cubemap/Indoor&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>	<span class=s1>&#39;assets/cubemap/Skybox&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>	<span class=c1>// Begin TOP changes Add envmap CornellBox
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>	<span class=s1>&#39;assets/cubemap/CornellBox&#39;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>	<span class=c1>// End TOP changes
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span><span class=p>];</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>11</span><span class=cl>	<span class=nx>loadOBJ</span><span class=p>(</span><span class=nx>renderer</span><span class=p>,</span> <span class=s1>&#39;assets/mary/&#39;</span><span class=p>,</span> <span class=s1>&#39;mary&#39;</span><span class=p>,</span> <span class=s1>&#39;PRTMaterial&#39;</span><span class=p>,</span> <span class=nx>boxTransform</span><span class=p>);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=kd>function</span> <span class=nx>createGUI</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>	<span class=kr>const</span> <span class=nx>gui</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>dat</span><span class=p>.</span><span class=nx>gui</span><span class=p>.</span><span class=nx>GUI</span><span class=p>();</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>	<span class=kr>const</span> <span class=nx>panelModel</span> <span class=o>=</span> <span class=nx>gui</span><span class=p>.</span><span class=nx>addFolder</span><span class=p>(</span><span class=s1>&#39;Switch Environemtn Map&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>	<span class=c1>// Begin TOP changes Add envmap CornellBox case in UI
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>	<span class=nx>panelModel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>guiParams</span><span class=p>,</span> <span class=s1>&#39;envmapId&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=s1>&#39;GraceGathedral&#39;</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Indoor&#39;</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;Skybox&#39;</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;CornellBox&#39;</span><span class=o>:</span><span class=mi>3</span><span class=p>}).</span><span class=nx>name</span><span class=p>(</span><span class=s1>&#39;Envmap Name&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>	<span class=c1>// End TOP changes
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>	<span class=nx>panelModel</span><span class=p>.</span><span class=nx>open</span><span class=p>();</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img alt="Inter-reflection m_Bounce = 1" loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504261655957.png#center></p><hr><h2 id=0x04-çƒè°æ—‹è½¬-sh-rotation>0x04 çƒè°æ—‹è½¬ SH Rotation<a hidden class=anchor aria-hidden=true href=#0x04-çƒè°æ—‹è½¬-sh-rotation>#</a></h2><p>çƒè°å‡½æ•°å…·æœ‰ä¸¤ä¸ªå¾ˆå¥½çš„æ€§è´¨ï¼š</p><ul><li>æ—‹è½¬ä¸å˜æ€§ï¼šæ—‹è½¬çƒè°å±•å¼€åçš„å‡½æ•°ï¼Œç›¸å½“äºæ—‹è½¬è¿™äº›çƒè°å‡½æ•°</li><li>ç‹¬ç«‹çš„çº¿æ€§æ—‹è½¬ï¼šå¯¹äºæ¯å±‚çƒè°å‡½æ•°ä¸Šçš„ç³»æ•°ï¼Œå¯ä»¥åˆ†åˆ«è¿›è¡Œæ—‹è½¬ï¼Œå¹¶ä¸”è¯¥æ—‹è½¬æ˜¯çº¿æ€§çš„</li></ul><p>æŠŠçƒè°å‡½æ•°å’ŒåŸºå‘é‡ç±»æ¯”å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼šæ—‹è½¬ä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­çš„å‘é‡ï¼Œç›¸å½“äºæ—‹è½¬åæ ‡åŸºï¼Œåœ¨è¿™ç»„æ–°çš„åæ ‡åŸºä¸‹ï¼Œå…¶ç³»æ•°å’Œæ—‹è½¬å‰å…¶åœ¨åŸåæ ‡ç³»çš„ç³»æ•°ç›¸ç­‰ã€‚é‚£ä¹ˆè¦æ±‚æ—‹è½¬ååœ¨åŸåæ ‡ç³»ä¸‹çš„ç³»æ•°ï¼Œåªéœ€è¦å°†æ–°çš„åæ ‡åŸºä½¿ç”¨åŸæ¥çš„åæ ‡åŸºè¡¨ç¤ºï¼Œç„¶åé‡æ–°æ•´ç†ç³»æ•°å³å¯ã€‚</p><p>å¯¹çƒè°æ¯é˜¶ $l$ï¼Œæœ‰ $2l+1$ ç»´çš„çƒè°ç³»æ•°ç»„æˆçš„å‘é‡ï¼Œå‡è®¾å­˜åœ¨ $2l + 1$ ä¸ªä»»æ„çš„ä¸‰ç»´æ³•å‘ $n$ï¼Œæ—‹è½¬å‡½æ•° $R$ï¼Œèƒ½å¤Ÿè¿”å›è¯¥é˜¶çƒè°æŠ•å½±ç³»æ•°çš„å‡½æ•° $P$ï¼Œéœ€è¦æ±‚å¾—æ—‹è½¬æ•´ä¸ªçƒé¢å‡½æ•°çš„çŸ©é˜µ $M$ï¼Œæœ‰ï¼š</p><div>$$
MP(n_{i})=P(R(n_{i}))\,,\,i \in[-l,l]
$$</div><blockquote><p>LHSï¼šå¯¹æ•´ä¸ªçƒé¢å‡½æ•°è¿›è¡Œæ—‹è½¬ï¼›RHSï¼šå…ˆæ—‹è½¬æ–¹å‘ $n_i$ï¼Œå†ä»£å…¥çƒé¢å‡½æ•°</p></blockquote><p>è®°çŸ©é˜µ $A=[P(n_{-l}),\dots,P(n_{l})]$ï¼Œè‹¥å…¶å¯é€†ï¼Œåˆ™ç­‰å¼ä¸¤è¾¹åŒæ—¶å³ä¹˜ä¸€ä¸ª $A^{-1}$ï¼Œç­‰å¼å˜ä¸ºï¼š</p><div>$$
M=[P(R(n_{-l})),\dots,P(R(n_{l}))]A^{-1}
$$</div><blockquote><p>Lighting é¡¹æœ‰ RGB ä¸‰ä¸ªåˆ†é‡ï¼Œæ‰€ä»¥è¿™é‡Œçš„ $P(R(n_{i}))$ å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸‰ç»´å‘é‡</p></blockquote><p>æ€»ç»“ä¸€ä¸‹æ€è·¯ï¼š</p><ol><li>å¯¹äºç¯å¢ƒçº¹ç†çš„æ—‹è½¬ï¼Œå¯ä»¥è·å–å…¶æ—‹è½¬çŸ©é˜µ $R$ï¼›</li><li>åœ¨æ¯é˜¶ $l$ é€‰å– $2l+1$ ä¸ªå•ä½æ–¹å‘å‘é‡ï¼Œè·å–å…¶åœ¨è¯¥é˜¶ä¸Šçš„çƒè°ç³»æ•°æ„æˆçŸ©é˜µ $A$ï¼›</li><li>å¯¹è¯¥çŸ©é˜µæ±‚é€†å¾—åˆ° $A^{-1}$ï¼›</li><li>ä½¿ç”¨æ—‹è½¬çŸ©é˜µä¾æ¬¡æ—‹è½¬æ¯é˜¶çš„å•ä½æ–¹å‘å‘é‡ï¼Œè·å–è¿™äº›æ—‹è½¬åçš„å‘é‡åœ¨è¯¥é˜¶ä¸Šçš„çƒè°ç³»æ•° $S$ï¼›</li><li>è§£å¾— $M=SA^{-1}$</li></ol><p>ä¸»è¦çš„å®ç°åœ¨ utils/tools.js ä¸­ï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>  1</span><span class=cl><span class=kd>function</span> <span class=nx>getRotationPrecomputeL</span><span class=p>(</span><span class=nx>precompute_L</span><span class=p>,</span> <span class=nx>rotationMatrix</span><span class=p>){</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>
</span></span><span class=line><span class=ln>  3</span><span class=cl>	<span class=c1>// Step 1: Calc each band&#39;s rotation matrix 
</span></span></span><span class=line><span class=ln>  4</span><span class=cl><span class=c1></span>	<span class=c1>// Caution: for each dir the Rotation matrix is a inverse of the rotation matrix 
</span></span></span><span class=line><span class=ln>  5</span><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>r</span> <span class=o>=</span> <span class=nx>mat4Matrix2mathMatrix</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>
</span></span><span class=line><span class=ln>  7</span><span class=cl>    <span class=kd>let</span> <span class=nx>shRotateMatrix3x3</span> <span class=o>=</span> <span class=nx>computeSquareMatrix_3by3</span><span class=p>(</span><span class=nx>r</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>    <span class=kd>let</span> <span class=nx>shRotateMatrix5x5</span> <span class=o>=</span> <span class=nx>computeSquareMatrix_5by5</span><span class=p>(</span><span class=nx>r</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>
</span></span><span class=line><span class=ln> 10</span><span class=cl>	<span class=c1>// Step 2: Initialize rotated L    //      R   G   B
</span></span></span><span class=line><span class=ln> 11</span><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>result</span> <span class=o>=</span> <span class=p>[];</span>                   <span class=c1>// SH0
</span></span></span><span class=line><span class=ln> 12</span><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>9</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span>        <span class=c1>// SH1
</span></span></span><span class=line><span class=ln> 13</span><span class=cl><span class=c1></span>        <span class=nx>result</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>                <span class=c1>// SH2
</span></span></span><span class=line><span class=ln> 14</span><span class=cl><span class=c1></span>    <span class=p>}</span>                                  <span class=c1>// ...
</span></span></span><span class=line><span class=ln> 15</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>	<span class=c1>// Step 3: Calc SH coeffs for RGB component of precompute_L
</span></span></span><span class=line><span class=ln> 17</span><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>        <span class=kd>let</span> <span class=nx>L_SH_R_3</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>([</span><span class=nx>precompute_L</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=nx>i</span><span class=p>],</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=nx>i</span><span class=p>],</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=nx>i</span><span class=p>]],</span> <span class=nx>shRotateMatrix3x3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>        <span class=kd>let</span> <span class=nx>L_SH_R_5</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>([</span><span class=nx>precompute_L</span><span class=p>[</span><span class=mi>4</span><span class=p>][</span><span class=nx>i</span><span class=p>],</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>5</span><span class=p>][</span><span class=nx>i</span><span class=p>],</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>6</span><span class=p>][</span><span class=nx>i</span><span class=p>],</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>7</span><span class=p>][</span><span class=nx>i</span><span class=p>],</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>8</span><span class=p>][</span><span class=nx>i</span><span class=p>]],</span> <span class=nx>shRotateMatrix5x5</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>		
</span></span><span class=line><span class=ln> 21</span><span class=cl>		<span class=kd>let</span> <span class=nx>L_SH_R_3_arr</span> <span class=o>=</span> <span class=nx>L_SH_R_3</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>		<span class=kd>let</span> <span class=nx>L_SH_R_5_arr</span> <span class=o>=</span> <span class=nx>L_SH_R_5</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>
</span></span><span class=line><span class=ln> 24</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>precompute_L</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=nx>i</span><span class=p>];</span> <span class=c1>// Y1^{0} remains the same
</span></span></span><span class=line><span class=ln> 25</span><span class=cl><span class=c1></span>		<span class=nx>result</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_3_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_3_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_3_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>4</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_5_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>5</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_5_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>6</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_5_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>7</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_5_arr</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>        <span class=nx>result</span><span class=p>[</span><span class=mi>8</span><span class=p>][</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>L_SH_R_5_arr</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>
</span></span><span class=line><span class=ln> 35</span><span class=cl>	<span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>
</span></span><span class=line><span class=ln> 38</span><span class=cl><span class=kd>function</span> <span class=nx>computeSquareMatrix_3by3</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>){</span> <span class=c1>// è®¡ç®—æ–¹é˜µSA(-1) 3*3 
</span></span></span><span class=line><span class=ln> 39</span><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=ln> 40</span><span class=cl>	<span class=c1>// 1ã€pick ni - {ni}
</span></span></span><span class=line><span class=ln> 41</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>n1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span> <span class=kd>let</span> <span class=nx>n2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span> <span class=kd>let</span> <span class=nx>n3</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>
</span></span><span class=line><span class=ln> 43</span><span class=cl>	<span class=c1>// 2ã€{P(ni)} - A  A_inverse
</span></span></span><span class=line><span class=ln> 44</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>pSHn1</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n1</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n1</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n1</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHn2</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n2</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n2</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n2</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHn3</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n3</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n3</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n3</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>	
</span></span><span class=line><span class=ln> 48</span><span class=cl>	<span class=kd>let</span> <span class=nx>A</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>matrix</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>1</span><span class=p>]],</span> <span class=c1>// Y1^{-1} 
</span></span></span><span class=line><span class=ln> 50</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>2</span><span class=p>]],</span> <span class=c1>// Y1^{0}
</span></span></span><span class=line><span class=ln> 51</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>3</span><span class=p>]]</span>  <span class=c1>// Y1^{1}
</span></span></span><span class=line><span class=ln> 52</span><span class=cl><span class=c1></span>	<span class=p>]);</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>	<span class=kd>let</span> <span class=nx>A_inverse</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>inv</span><span class=p>(</span><span class=nx>A</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>
</span></span><span class=line><span class=ln> 55</span><span class=cl>	<span class=c1>// 3ã€ç”¨ R æ—‹è½¬ ni - {R(ni)}
</span></span></span><span class=line><span class=ln> 56</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>Rn1</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn2</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n2</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn3</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>
</span></span><span class=line><span class=ln> 60</span><span class=cl>	<span class=c1>// get array from math matrix
</span></span></span><span class=line><span class=ln> 61</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>Rn1_arr</span> <span class=o>=</span> <span class=nx>Rn1</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn2_arr</span> <span class=o>=</span> <span class=nx>Rn2</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn3_arr</span> <span class=o>=</span> <span class=nx>Rn3</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>
</span></span><span class=line><span class=ln> 65</span><span class=cl>	<span class=c1>// 4ã€R(ni) SHæŠ•å½± - S
</span></span></span><span class=line><span class=ln> 66</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>pSHRn1</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn1_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn1_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn1_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHRn2</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn2_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn2_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn2_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHRn3</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn3_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn3_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn3_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>
</span></span><span class=line><span class=ln> 70</span><span class=cl>	<span class=kd>let</span> <span class=nx>S</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>matrix</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>1</span><span class=p>]],</span> <span class=c1>// Y1^{-1}
</span></span></span><span class=line><span class=ln> 72</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>2</span><span class=p>]],</span> <span class=c1>// Y1^{0}
</span></span></span><span class=line><span class=ln> 73</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>3</span><span class=p>]]</span>  <span class=c1>// Y1^{1}
</span></span></span><span class=line><span class=ln> 74</span><span class=cl><span class=c1></span>	<span class=p>]);</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>
</span></span><span class=line><span class=ln> 76</span><span class=cl>	<span class=c1>// 5ã€S*A_inverse
</span></span></span><span class=line><span class=ln> 77</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>SA_inverse</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>S</span><span class=p>,</span> <span class=nx>A_inverse</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>	<span class=k>return</span> <span class=nx>SA_inverse</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>
</span></span><span class=line><span class=ln> 81</span><span class=cl><span class=kd>function</span> <span class=nx>computeSquareMatrix_5by5</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>){</span> <span class=c1>// è®¡ç®—æ–¹é˜µSA(-1) 5*5
</span></span></span><span class=line><span class=ln> 82</span><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=ln> 83</span><span class=cl>	<span class=c1>// 1ã€pick ni - {ni}
</span></span></span><span class=line><span class=ln> 84</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>k</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=nx>math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>	<span class=kd>let</span> <span class=nx>n1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span> <span class=kd>let</span> <span class=nx>n2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span> <span class=kd>let</span> <span class=nx>n3</span> <span class=o>=</span> <span class=p>[</span><span class=nx>k</span><span class=p>,</span> <span class=nx>k</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span> 
</span></span><span class=line><span class=ln> 86</span><span class=cl>	<span class=kd>let</span> <span class=nx>n4</span> <span class=o>=</span> <span class=p>[</span><span class=nx>k</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>k</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span> <span class=kd>let</span> <span class=nx>n5</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>k</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>
</span></span><span class=line><span class=ln> 88</span><span class=cl>	<span class=c1>// 2ã€{P(ni)} - A  A_inverse
</span></span></span><span class=line><span class=ln> 89</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>pSHn1</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n1</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n1</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n1</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHn2</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n2</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n2</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n2</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHn3</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n3</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n3</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n3</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHn4</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n4</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n4</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n4</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHn5</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>n5</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>n5</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>n5</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>
</span></span><span class=line><span class=ln> 95</span><span class=cl>	<span class=kd>let</span> <span class=nx>A</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>matrix</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHn4</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHn5</span><span class=p>[</span><span class=mi>4</span><span class=p>]],</span> <span class=c1>// Y2^{-2} 
</span></span></span><span class=line><span class=ln> 97</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHn4</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHn5</span><span class=p>[</span><span class=mi>5</span><span class=p>]],</span> <span class=c1>// Y2^{-1}
</span></span></span><span class=line><span class=ln> 98</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHn4</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHn5</span><span class=p>[</span><span class=mi>6</span><span class=p>]],</span> <span class=c1>// Y2^{0}
</span></span></span><span class=line><span class=ln> 99</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHn4</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHn5</span><span class=p>[</span><span class=mi>7</span><span class=p>]],</span> <span class=c1>// Y2^{1}
</span></span></span><span class=line><span class=ln>100</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHn1</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHn2</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHn3</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHn4</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHn5</span><span class=p>[</span><span class=mi>8</span><span class=p>]]</span>  <span class=c1>// Y2^{2}
</span></span></span><span class=line><span class=ln>101</span><span class=cl><span class=c1></span>	<span class=p>]);</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>	<span class=kd>let</span> <span class=nx>A_inverse</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>inv</span><span class=p>(</span><span class=nx>A</span><span class=p>);</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>
</span></span><span class=line><span class=ln>104</span><span class=cl>	<span class=c1>// 3ã€ç”¨ R æ—‹è½¬ ni - {R(ni)}
</span></span></span><span class=line><span class=ln>105</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>Rn1</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn2</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n2</span><span class=p>);</span>
</span></span><span class=line><span class=ln>107</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn3</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n3</span><span class=p>);</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn4</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n4</span><span class=p>);</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn5</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>,</span> <span class=nx>n5</span><span class=p>);</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>
</span></span><span class=line><span class=ln>111</span><span class=cl>	<span class=c1>// get array from math matrix
</span></span></span><span class=line><span class=ln>112</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>Rn1_arr</span> <span class=o>=</span> <span class=nx>Rn1</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn2_arr</span> <span class=o>=</span> <span class=nx>Rn2</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn3_arr</span> <span class=o>=</span> <span class=nx>Rn3</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn4_arr</span> <span class=o>=</span> <span class=nx>Rn4</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>	<span class=kd>let</span> <span class=nx>Rn5_arr</span> <span class=o>=</span> <span class=nx>Rn5</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>
</span></span><span class=line><span class=ln>118</span><span class=cl>	<span class=c1>// 4ã€R(ni) SHæŠ•å½± - S
</span></span></span><span class=line><span class=ln>119</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>pSHRn1</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn1_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn1_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn1_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln>120</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHRn2</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn2_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn2_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn2_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln>121</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHRn3</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn3_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn3_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn3_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHRn4</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn4_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn4_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn4_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln>123</span><span class=cl>	<span class=kd>let</span> <span class=nx>pSHRn5</span> <span class=o>=</span> <span class=nx>SHEval</span><span class=p>(</span><span class=nx>Rn5_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>Rn5_arr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>Rn5_arr</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>
</span></span><span class=line><span class=ln>125</span><span class=cl>	<span class=kd>let</span> <span class=nx>S</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>matrix</span><span class=p>([</span>
</span></span><span class=line><span class=ln>126</span><span class=cl>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHRn4</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=nx>pSHRn5</span><span class=p>[</span><span class=mi>4</span><span class=p>]],</span> <span class=c1>// Y2^{-2}
</span></span></span><span class=line><span class=ln>127</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHRn4</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=nx>pSHRn5</span><span class=p>[</span><span class=mi>5</span><span class=p>]],</span> <span class=c1>// Y2^{-1}
</span></span></span><span class=line><span class=ln>128</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHRn4</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=nx>pSHRn5</span><span class=p>[</span><span class=mi>6</span><span class=p>]],</span> <span class=c1>// Y2^{0}
</span></span></span><span class=line><span class=ln>129</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHRn4</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=nx>pSHRn5</span><span class=p>[</span><span class=mi>7</span><span class=p>]],</span> <span class=c1>// Y2^{1}
</span></span></span><span class=line><span class=ln>130</span><span class=cl><span class=c1></span>		<span class=p>[</span><span class=nx>pSHRn1</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHRn2</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHRn3</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHRn4</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=nx>pSHRn5</span><span class=p>[</span><span class=mi>8</span><span class=p>]]</span>  <span class=c1>// Y2^{2}
</span></span></span><span class=line><span class=ln>131</span><span class=cl><span class=c1></span>	<span class=p>]);</span>
</span></span><span class=line><span class=ln>132</span><span class=cl>
</span></span><span class=line><span class=ln>133</span><span class=cl>	<span class=c1>// 5ã€S*A_inverse
</span></span></span><span class=line><span class=ln>134</span><span class=cl><span class=c1></span>	<span class=kd>let</span> <span class=nx>SA_inverse</span> <span class=o>=</span> <span class=nx>math</span><span class=p>.</span><span class=nx>multiply</span><span class=p>(</span><span class=nx>S</span><span class=p>,</span> <span class=nx>A_inverse</span><span class=p>);</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>	<span class=k>return</span> <span class=nx>SA_inverse</span><span class=p>;</span>
</span></span><span class=line><span class=ln>136</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æœ‰ä¸€äº›è¦æ³¨æ„çš„ç‚¹ï¼Œæ—‹è½¬å¤©ç©ºç›’çš„çŸ©é˜µæ˜¯å¦‚ä¸‹ä»£ç ç”Ÿæˆå¹¶ä¼ å…¥ Shader çš„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// WebGLRenderer.js
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>cameraModelMatrix</span> <span class=o>=</span> <span class=nx>mat4</span><span class=p>.</span><span class=nx>create</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nx>mat4</span><span class=p>.</span><span class=nx>fromRotation</span><span class=p>(</span><span class=nx>cameraModelMatrix</span><span class=p>,</span> <span class=nx>timer</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>k</span> <span class=o>==</span> <span class=s1>&#39;uMoveWithCamera&#39;</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// The rotation of the skybox
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>	<span class=nx>gl</span><span class=p>.</span><span class=nx>uniformMatrix4fv</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>		<span class=k>this</span><span class=p>.</span><span class=nx>meshes</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>shader</span><span class=p>.</span><span class=nx>program</span><span class=p>.</span><span class=nx>uniforms</span><span class=p>[</span><span class=nx>k</span><span class=p>],</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>		<span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>		<span class=nx>cameraModelMatrix</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å¯¹æ•´ä¸ªç¯å¢ƒçº¹ç†è¿›è¡Œæ—‹è½¬ï¼Œå¯¹æŸä¸€ä¸ªæ–¹å‘ $n_{i}$ æ¥è¯´ï¼Œæ—‹è½¬åçš„ Lighting ç›¸å½“äºå¯¹è¿™ä¸ªæ–¹å‘åº”ç”¨æ—‹è½¬çŸ©é˜µçš„é€†ï¼Œå³åœ¨åŸå§‹å¤©ç©ºç›’çš„ $R^{-1}n_{i}$ æ–¹å‘çš„ Lighting çš„å€¼ï¼Œæ‰€ä»¥ä¼ å…¥è®¡ç®—çƒè°å‡½æ•°çš„æ—‹è½¬çŸ©é˜µæ˜¯å¤©ç©ºç›’æ—‹è½¬çŸ©é˜µçš„é€†ï¼ˆç”±äºæ—‹è½¬çŸ©é˜µæ˜¯å•ä½é˜µï¼Œæ‰€ä»¥ç­‰ä»·äºè½¬ç½®ï¼‰ã€‚</p><p>tools.js æœ‰ä¸€ä¸ªå‡½æ•° <code>mat4Matrix2mathMatrix</code>ï¼ŒæŒ‰ç…§åå­—åº”è¯¥æ˜¯æŠŠ WebGL çš„çŸ©é˜µæ ¼å¼è½¬æ¢ä¸º math.js çš„çŸ©é˜µæ ¼å¼ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>mat4Matrix2mathMatrix</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl>	<span class=kd>let</span> <span class=nx>mathMatrix</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>		<span class=kd>let</span> <span class=nx>r</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>			<span class=nx>r</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>rotationMatrix</span><span class=p>[</span><span class=nx>i</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>j</span><span class=p>]);</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>		<span class=nx>mathMatrix</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>r</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>	<span class=k>return</span> <span class=nx>math</span><span class=p>.</span><span class=nx>matrix</span><span class=p>(</span><span class=nx>mathMatrix</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>çœ‹èµ·æ¥å¥½åƒæ˜¯æŠŠä¸œè¥¿éƒ½æå‡ºæ¥å†å¡å›å»ï¼Œä¸è¿‡è¿™ä¿©çŸ©é˜µå­˜å‚¨æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼ŒWebGL æ˜¯æŒ‰è¡Œä¼˜å…ˆå­˜å‚¨ï¼Œè€Œ math.js æ˜¯æŒ‰åˆ—ä¼˜å…ˆï¼Œå¦‚æœåšä¸‹æ‰“å°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>1</span><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;WebGL mat4:&#34;</span><span class=p>,</span> <span class=nx>cameraModelMatrix</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;math matrix:&#34;</span><span class=p>,</span> <span class=nx>mat4Matrix2mathMatrix</span><span class=p>(</span><span class=nx>cameraModelMatrix</span><span class=p>));</span>
</span></span></code></pre></div><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504261451794.png#center></p><p>ä¼šå‘ç°è¿™ä¿©çœ‹èµ·æ¥ä¼¼ä¹ä¸€æ ·ï¼Œä½†æ˜¯åœ¨å†…å­˜ä¸­å­˜å‚¨çš„æ–¹å¼æœ‰åŒºåˆ«ã€‚WebGL åœ¨å†…å­˜ä¸­ä»¥<strong>ä¸€ç»´æ•°ç»„</strong>å½¢å¼æ’å¸ƒï¼Œmath.js çš„çŸ©é˜µåœ¨å†…å­˜ä¸­æŒ‰è¡Œä»¥äºŒç»´æ•°ç»„å­˜å‚¨ï¼š</p><div>$$
WebGLMatrix=\begin{bmatrix}
m_{00} & m_{10} & m_{20} &m_{30} \\
m_{01} & m_{11} & m_{21} &m_{31} \\
m_{02} & m_{12} & m_{22} &m_{32} \\
m_{03} & m_{13} & m_{23} &m_{33}
\end{bmatrix},\quad
mathMatrix=\begin{bmatrix}
\left[ m_{00},m_{01},m_{02},m_{03} \right] \\
\left[ m_{10},m_{11},m_{12},m_{13} \right] \\
\left[ m_{20},m_{21},m_{22},m_{23} \right] \\
\left[ m_{30},m_{31},m_{32},m_{33} \right]
\end{bmatrix}
$$</div><p>æ‰€ä»¥ <code>mat4Matrix2mathMatrix</code> è¿™ä¸ªå‡½æ•°å®é™…ä¸Šå°±æ˜¯æŠŠ WebGL çŸ©é˜µè½¬åˆ° math.js çš„çŸ©é˜µï¼Œè¿˜åšäº†ä¸€æ¬¡è½¬ç½®ï¼Œç›¸å½“äºç›´æ¥æ‹¿åˆ°äº†æ—‹è½¬çŸ©é˜µçš„é€†ï¼Œå¯ä»¥åœ¨ <code>getRotationPrecomputeL</code> ä¸­ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°è·å¾—å¤©ç©ºç›’æ—‹è½¬çŸ©é˜µçš„é€†ï¼Œç„¶åå†ä¼ å…¥ <code>computeSquareMatrix_xbyx</code> è®¡ç®—çƒè°ç³»æ•°çš„æ—‹è½¬çŸ©é˜µã€‚å¦å¤–ï¼Œç”±äºè¯¥çŸ©é˜µæ˜¯ math.js å°è£…çš„ matrixï¼Œè°ƒç”¨ <code>math.multiply</code> æ–¹æ³•çš„è¿”å›å€¼è¿˜æ˜¯ matrixï¼ˆå³ä¾¿æ˜¯çŸ©é˜µä¹˜å‘é‡ï¼‰ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨ <code>._data[i]</code> æˆ–è€…å…ˆç”¨ <code>.toArray</code> æ–¹æ³•æ‹¿åˆ°æ•°ç»„ï¼Œå†æŒ‰ä¸‹æ ‡è®¿é—®ã€‚</p><p>æœ€åå°† WebGLRenderer.js ç¬¬ 53 å’Œç¬¬ 63 è¡Œå–æ¶ˆæ³¨é‡Šï¼Œä¸å‡ºæ„å¤–å°±èƒ½çœ‹åˆ°æ¨¡å‹çš„ç€è‰²æ­£ç¡®è·Ÿéšå¤©ç©ºç›’æ—‹è½¬ï¼</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%205.GAMES202HW2/202504261631929.png#center></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://congyuxiaoyoudao.github.io/tags/games202/>GAMES202</a></li></ul><nav class=paginav><a class=prev href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-3/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Assignment 6. GAMES202 Homework 3</span>
</a><a class=next href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-1/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Assignment 4. GAMES202 Homework 1</span></a></nav></footer><div id=tw-comment></div><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="light"?"light":"noborder_dark",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"congyuxiaoyoudao/congyuxiaoyoudao.github.io","data-repo-id":"","data-category":"Announcements","data-category-id":"","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"","data-emit-metadata":"","data-input-position":"","data-theme":getStoredTheme(),"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous"},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#tw-comment").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://congyuxiaoyoudao.github.io/>The Only Problem's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>