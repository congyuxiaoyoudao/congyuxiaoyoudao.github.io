<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Assignment 3. GAMES202 Homework 0 | The Only Problem's Blog</title><meta name=keywords content="GAMES202"><meta name=description content='
开个新坑，之前囫囵吞枣地过了一遍 202，现在忘得差不多了，该捡起来。正好给枯燥的生活增添一点色彩（？），最近比较忙但还是争取一周做一个作业

🚩 0x00 To begin with
这篇文章将会包含以下内容：

 GAMES202 作业 0
 不包含作业框架分析

For reference👇：

📺 B 站视频：







  
  GAMES202-高质量实时渲染


📦 代码仓库：







  
  congyuxiaoyoudao/GAMES202_Homework at working




master 分支上是 202 全部作业汇总，working 分支用于提交代码。需要原始作业可下载 master 分支的包

⚙️ 0x01 Configuration 环境配置
选择使用 VSCode 插件搭建本地服务器，在扩展中搜索 Live Server，安装此插件。

在编辑 Html 代码窗口按 F1（或者右键）选择 Live Server: Open with Live Server，随后会自动打开浏览器，导航至本地服务器端口，一切正常的话是下面这个效果：

可以使用鼠标和右上角的控制面板进行一些简单的交互。
如果遇到模型贴图加载不出来（只有 202 字样），可以选择多刷新几次。或者直接在加载脚本前预加载贴图，可以根治这个问题。
1<link rel="preload" href="assets/mary/MC003_Kozakura_Mari.png" as="image" type="image/png" crossorigin/>

🤔 0x02 Blinn-Phong Shading Model

没什么好说的，CV 工程师
使用 GLSL 编写 Shader
如果使用字符串的方式引入 Shader，就在 InternalShader.js 中加上：'><meta name=author content="The Only Problem"><link rel=canonical href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-0/><link crossorigin=anonymous href=/assets/css/stylesheet.452758010f0b7fc9ad7fa528ffdfdd8eb9e830816fb8c8119f16f39583297db8.css integrity="sha256-RSdYAQ8Lf8mtf6Uo/9/djrnoMIFvuMgRnxbzlYMpfbg=" rel="preload stylesheet" as=style><link rel=icon href=https://congyuxiaoyoudao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://congyuxiaoyoudao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://congyuxiaoyoudao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://congyuxiaoyoudao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://congyuxiaoyoudao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-0/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity=sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity=sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk crossorigin=anonymous onload='window.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\$$",right:"\\\\$$",display:!1},{left:"\\$$",right:"\\\\$$",display:!0}]})})'></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css><meta property="og:url" content="https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-0/"><meta property="og:site_name" content="The Only Problem's Blog"><meta property="og:title" content="Assignment 3. GAMES202 Homework 0"><meta property="og:description" content=' 开个新坑，之前囫囵吞枣地过了一遍 202，现在忘得差不多了，该捡起来。正好给枯燥的生活增添一点色彩（？），最近比较忙但还是争取一周做一个作业
🚩 0x00 To begin with 这篇文章将会包含以下内容：
GAMES202 作业 0 不包含作业框架分析 For reference👇：
📺 B 站视频： GAMES202-高质量实时渲染 📦 代码仓库： congyuxiaoyoudao/GAMES202_Homework at working master 分支上是 202 全部作业汇总，working 分支用于提交代码。需要原始作业可下载 master 分支的包
⚙️ 0x01 Configuration 环境配置 选择使用 VSCode 插件搭建本地服务器，在扩展中搜索 Live Server，安装此插件。
在编辑 Html 代码窗口按 F1（或者右键）选择 Live Server: Open with Live Server，随后会自动打开浏览器，导航至本地服务器端口，一切正常的话是下面这个效果：
可以使用鼠标和右上角的控制面板进行一些简单的交互。
如果遇到模型贴图加载不出来（只有 202 字样），可以选择多刷新几次。或者直接在加载脚本前预加载贴图，可以根治这个问题。
1<link rel="preload" href="assets/mary/MC003_Kozakura_Mari.png" as="image" type="image/png" crossorigin/> 🤔 0x02 Blinn-Phong Shading Model 没什么好说的，CV 工程师
使用 GLSL 编写 Shader 如果使用字符串的方式引入 Shader，就在 InternalShader.js 中加上：'><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-07T00:00:00+00:00"><meta property="article:tag" content="GAMES202"><meta name=twitter:card content="summary"><meta name=twitter:title content="Assignment 3. GAMES202 Homework 0"><meta name=twitter:description content='
开个新坑，之前囫囵吞枣地过了一遍 202，现在忘得差不多了，该捡起来。正好给枯燥的生活增添一点色彩（？），最近比较忙但还是争取一周做一个作业

🚩 0x00 To begin with
这篇文章将会包含以下内容：

 GAMES202 作业 0
 不包含作业框架分析

For reference👇：

📺 B 站视频：







  
  GAMES202-高质量实时渲染


📦 代码仓库：







  
  congyuxiaoyoudao/GAMES202_Homework at working




master 分支上是 202 全部作业汇总，working 分支用于提交代码。需要原始作业可下载 master 分支的包

⚙️ 0x01 Configuration 环境配置
选择使用 VSCode 插件搭建本地服务器，在扩展中搜索 Live Server，安装此插件。

在编辑 Html 代码窗口按 F1（或者右键）选择 Live Server: Open with Live Server，随后会自动打开浏览器，导航至本地服务器端口，一切正常的话是下面这个效果：

可以使用鼠标和右上角的控制面板进行一些简单的交互。
如果遇到模型贴图加载不出来（只有 202 字样），可以选择多刷新几次。或者直接在加载脚本前预加载贴图，可以根治这个问题。
1<link rel="preload" href="assets/mary/MC003_Kozakura_Mari.png" as="image" type="image/png" crossorigin/>

🤔 0x02 Blinn-Phong Shading Model

没什么好说的，CV 工程师
使用 GLSL 编写 Shader
如果使用字符串的方式引入 Shader，就在 InternalShader.js 中加上：'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://congyuxiaoyoudao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Assignments","item":"https://congyuxiaoyoudao.github.io/posts/assignments/"},{"@type":"ListItem","position":3,"name":"Assignment 3. GAMES202 Homework 0","item":"https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Assignment 3. GAMES202 Homework 0","name":"Assignment 3. GAMES202 Homework 0","description":" 开个新坑，之前囫囵吞枣地过了一遍 202，现在忘得差不多了，该捡起来。正好给枯燥的生活增添一点色彩（？），最近比较忙但还是争取一周做一个作业\n🚩 0x00 To begin with 这篇文章将会包含以下内容：\nGAMES202 作业 0 不包含作业框架分析 For reference👇：\n📺 B 站视频： GAMES202-高质量实时渲染 📦 代码仓库： congyuxiaoyoudao/GAMES202_Homework at working master 分支上是 202 全部作业汇总，working 分支用于提交代码。需要原始作业可下载 master 分支的包\n⚙️ 0x01 Configuration 环境配置 选择使用 VSCode 插件搭建本地服务器，在扩展中搜索 Live Server，安装此插件。\n在编辑 Html 代码窗口按 F1（或者右键）选择 Live Server: Open with Live Server，随后会自动打开浏览器，导航至本地服务器端口，一切正常的话是下面这个效果：\n可以使用鼠标和右上角的控制面板进行一些简单的交互。\n如果遇到模型贴图加载不出来（只有 202 字样），可以选择多刷新几次。或者直接在加载脚本前预加载贴图，可以根治这个问题。\n1\u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;assets/mary/MC003_Kozakura_Mari.png\u0026#34; as=\u0026#34;image\u0026#34; type=\u0026#34;image/png\u0026#34; crossorigin/\u0026gt; 🤔 0x02 Blinn-Phong Shading Model 没什么好说的，CV 工程师\n使用 GLSL 编写 Shader 如果使用字符串的方式引入 Shader，就在 InternalShader.js 中加上：\n","keywords":["GAMES202"],"articleBody":" 开个新坑，之前囫囵吞枣地过了一遍 202，现在忘得差不多了，该捡起来。正好给枯燥的生活增添一点色彩（？），最近比较忙但还是争取一周做一个作业\n🚩 0x00 To begin with 这篇文章将会包含以下内容：\nGAMES202 作业 0 不包含作业框架分析 For reference👇：\n📺 B 站视频： GAMES202-高质量实时渲染 📦 代码仓库： congyuxiaoyoudao/GAMES202_Homework at working master 分支上是 202 全部作业汇总，working 分支用于提交代码。需要原始作业可下载 master 分支的包\n⚙️ 0x01 Configuration 环境配置 选择使用 VSCode 插件搭建本地服务器，在扩展中搜索 Live Server，安装此插件。\n在编辑 Html 代码窗口按 F1（或者右键）选择 Live Server: Open with Live Server，随后会自动打开浏览器，导航至本地服务器端口，一切正常的话是下面这个效果：\n可以使用鼠标和右上角的控制面板进行一些简单的交互。\n如果遇到模型贴图加载不出来（只有 202 字样），可以选择多刷新几次。或者直接在加载脚本前预加载贴图，可以根治这个问题。\n1\u003clink rel=\"preload\" href=\"assets/mary/MC003_Kozakura_Mari.png\" as=\"image\" type=\"image/png\" crossorigin/\u003e 🤔 0x02 Blinn-Phong Shading Model 没什么好说的，CV 工程师\n使用 GLSL 编写 Shader 如果使用字符串的方式引入 Shader，就在 InternalShader.js 中加上：\n1// Phong Shader 2 3const PhongVertexShader = ` 4// attribute is vertex input data 5attribute vec3 aVertexPosition; 6attribute vec3 aNormalPosition; 7attribute vec2 aTextureCoord; 8 9// uniform is consistent/global data between VS/PS in a drawcall 10uniform mat4 uModelViewMatrix; 11uniform mat4 uProjectionMatrix; 12 13// varying is data need to be interpolated from VS to PS 14varying highp vec2 vTextureCoord; 15varying highp vec3 vFragPos; 16varying highp vec3 vNormal; 17 18void main(void) { 19 20 vFragPos = aVertexPosition; 21 vNormal = aNormalPosition; 22 // MVP 23 gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aVertexPosition, 1.0); 24 25 vTextureCoord = aTextureCoord; 26} 27`; 28 29const PhongFragmentShader = ` 30#ifdef GL_ES 31precision mediump float; 32#endif 33uniform sampler2D uSampler; 34//binn 35uniform vec3 uKd; 36uniform vec3 uKs; 37uniform vec3 uLightPos; 38uniform vec3 uCameraPos; 39uniform float uLightIntensity; 40uniform int uTextureSample; 41 42varying highp vec2 vTextureCoord; 43varying highp vec3 vFragPos; 44varying highp vec3 vNormal; 45 46void main(void) { 47 vec3 color; 48 if (uTextureSample == 1) { 49\t// Gamma correction 50\tcolor = pow(texture2D(uSampler, vTextureCoord).rgb, vec3(2.2)); 51 } else { 52 // default color 53 color = uKd; 54 } 55 56 vec3 ambient = 0.05 * color; 57 58 // lambertian diffuse 59 vec3 lightDir = normalize(uLightPos- vFragPos); 60 vec3 normal = normalize(vNormal); 61 float diff = max(dot(lightDir, normal), 0.0); 62 float light_atten_coff = uLightIntensity / length(uLightPos- vFragPos); 63 vec3 diffuse = diff * light_atten_coff * color; 64 65 // Phong specular 66 vec3 viewDir = normalize(uCameraPos- vFragPos); 67 float spec = 0.0; 68 vec3 reflectDir = reflect(-lightDir, normal); 69 spec = pow (max(dot(viewDir, reflectDir), 0.0), 35.0); 70 vec3 specular = uKs * light_atten_coff * spec; 71 72 // Compose all components and do gamma reverse 73 gl_FragColor = vec4(pow((ambient + diffuse + specular), vec3(1.0/2.2)), 1.0); 74 75} 76`; 实现 PhongMaterial 类 在 src/materials/ 下新建 PhongMaterial.js，定义继承自 Material 的 PhongMaterial 类，传参，绑定 Shader。\nsuper 调用父类构造\n1class PhongMaterial extends Material { 2/** 3 * Creates an instance of PhongMaterial. 4 * @param {vec3f} color The material color 5 * @param {Texture} colorMap The texture object of the material 6 * @param {vec3f} specular The material specular coefficient 7 * @param {float} intensity The light intensity 8 * @memberof PhongMaterial 9 */ 10 constructor(color, colorMap, specular, intensity) { 11 let textureSample = 0; 12 13 if (colorMap != null) { 14 textureSample = 1; 15 super({ 16 'uTextureSample': { type: '1i', value: textureSample }, 17 'uSampler': { type: 'texture', value: colorMap }, 18 'uKd': { type: '3fv', value: color }, 19 'uKs': { type: '3fv', value: specular }, 20 'uLightIntensity': { type: '1f', value: intensity } 21 }, [], PhongVertexShader, PhongFragmentShader); 22 } else { 23 //console.log(color); 24 super({ 25 'uTextureSample': { type: '1i', value: textureSample }, 26 27 'uKd': { type: '3fv', value: color }, 28 'uKs': { type: '3fv', value: specular }, 29 'uLightIntensity': { type: '1f', value: intensity } 30 }, [], PhongVertexShader, PhongFragmentShader); 31 } 32 33 } 34} 导入 PhongMaterial.js 在 index.html 中，在导入 Material.js 之后导入 PhongMaterial.js。\n1\u003cscript src=\"src/materials/Material.js\" defer\u003e\u003c/script\u003e 2 3\u003cscript src=\"src/materials/PhongMaterial.js\" defer\u003e\u003c/script\u003e 使用 PhongMaterial src/loads/loadOBJ.js 中，删除原本创建默认材质的部分，改为使用 PhongMaterial 创建实例。\n1// // MARK: You can change the myMaterial object to your own Material instance 2 3// let textureSample = 0; 4// let myMaterial; 5// if (colorMap != null) { 6// textureSample = 1; 7// myMaterial = new Material({ 8// 'uSampler': { type: 'texture', value: colorMap }, 9// 'uTextureSample': { type: '1i', value: textureSample }, 10// 'uKd': { type: '3fv', value: mat.color.toArray() } 11// },[],VertexShader, FragmentShader); 12// }else{ 13// myMaterial = new Material({ 14// 'uTextureSample': { type: '1i', value: textureSample }, 15// 'uKd': { type: '3fv', value: mat.color.toArray() } 16// },[],VertexShader, FragmentShader); 17// } 18\t19let myMaterial = new PhongMaterial( mat.color.toArray(), 20\tcolorMap, 21\tmat.specular.toArray(), 22\trenderer.lights[0].entity.mat.intensity) 🍪 Extra：从文件中加载 Shader 为了让这篇显得不那么水，补一下另一个从外部文件加载 Shader 的方法，在 src/shaders/phongShader 中已经给出了这两个着色器文件\n更改 PhongMaterial 类 因为构造函数不支持异步，就把创建 Material 的逻辑放到一个函数中，在这个函数里调用 loadShader.js 中定义的 loadShaderFile 函数加载 shader 文件，等待加载完后再调用构造函数并返回新创建的实例：\n1// Load the shader files from file 2class PhongMaterial extends Material { 3 constructor(uniforms, vertexShader, fragmentShader) { 4 super(uniforms, [], vertexShader, fragmentShader); 5 } 6 7 /** 8 * Creates an instance of PhongMaterial async. 9 * @param {vec3f} color 10 * @param {Texture} colorMap 11 * @param {vec3f} specular 12 * @param {float} intensity 13 * @returns {Promise} 14 */ 15 static async create(color, colorMap, specular, intensity) { 16 const textureSample = colorMap ? 1 : 0; 17 18 const [vertexShader, fragmentShader] = await Promise.all([ 19 loadShaderFile('src/shaders/phongShader/vertex.glsl'), 20 loadShaderFile('src/shaders/phongShader/fragment.glsl') 21 ]); 22 // console.log('Vertex Shader:', vertexShader.slice(0, 100)); 23 // console.log('Fragment Shader:', fragmentShader.slice(0, 100)); 24 const uniforms = { 25 'uTextureSample': { type: '1i', value: textureSample }, 26 'uKd': { type: '3fv', value: color }, 27 'uKs': { type: '3fv', value: specular }, 28 'uLightIntensity': { type: '1f', value: intensity } 29 }; 30 31 if (colorMap) { 32 uniforms['uSampler'] = { type: 'texture', value: colorMap }; 33 } 34 35 return new PhongMaterial(uniforms, vertexShader, fragmentShader); 36 } 37} 更改 loadOBJ.js 用 create 方法创建一个新材质实例，完成后进行渲染。\n1PhongMaterial.create( mat.color.toArray(), 2\tcolorMap, 3\tmat.specular.toArray(), 4\trenderer.lights[0].entity.mat.intensity) 5\t.then((myMaterial) =\u003e { 6\tlet meshRender = new MeshRender(renderer.gl, mesh, myMaterial); 7\trenderer.addMesh(meshRender); 8\t}) 📝 Afterwords 一切正常就是下面的效果。\n","wordCount":"908","inLanguage":"zh","datePublished":"2025-04-07T00:00:00Z","dateModified":"2025-04-07T00:00:00Z","author":{"@type":"Person","name":"The Only Problem"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-0/"},"publisher":{"@type":"Organization","name":"The Only Problem's Blog","logo":{"@type":"ImageObject","url":"https://congyuxiaoyoudao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://congyuxiaoyoudao.github.io/ accesskey=h title="The Only Problem's Blog (Alt + H)">The Only Problem's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://congyuxiaoyoudao.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://congyuxiaoyoudao.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/assignments/>Assignments</a></div><h1 class="post-title entry-hint-parent">Assignment 3. GAMES202 Homework 0</h1><div class=post-meta><span title='2025-04-07 00:00:00 +0000 UTC'>四月 7, 2025</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;The Only Problem</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#-0x00-to-begin-with aria-label="🚩 0x00 To begin with">🚩 0x00 To begin with</a></li><li><a href=#-0x01-configuration-%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae aria-label="⚙️ 0x01 Configuration 环境配置">⚙️ 0x01 Configuration 环境配置</a></li><li><a href=#-0x02-blinn-phong-shading-model aria-label="🤔 0x02 Blinn-Phong Shading Model">🤔 0x02 Blinn-Phong Shading Model</a><ul><li><a href=#%e4%bd%bf%e7%94%a8-glsl-%e7%bc%96%e5%86%99-shader aria-label="使用 GLSL 编写 Shader">使用 GLSL 编写 Shader</a></li><li><a href=#%e5%ae%9e%e7%8e%b0-phongmaterial-%e7%b1%bb aria-label="实现 PhongMaterial 类">实现 PhongMaterial 类</a></li><li><a href=#%e5%af%bc%e5%85%a5-phongmaterialjs aria-label="导入 PhongMaterial.js">导入 PhongMaterial.js</a></li><li><a href=#%e4%bd%bf%e7%94%a8-phongmaterial aria-label="使用 PhongMaterial">使用 PhongMaterial</a></li></ul></li><li><a href=#-extra%e4%bb%8e%e6%96%87%e4%bb%b6%e4%b8%ad%e5%8a%a0%e8%bd%bd-shader aria-label="🍪 Extra：从文件中加载 Shader">🍪 Extra：从文件中加载 Shader</a><ul><li><a href=#%e6%9b%b4%e6%94%b9-phongmaterial-%e7%b1%bb aria-label="更改 PhongMaterial 类">更改 PhongMaterial 类</a></li><li><a href=#%e6%9b%b4%e6%94%b9-loadobjjs aria-label="更改 loadOBJ.js">更改 loadOBJ.js</a></li></ul></li><li><a href=#-afterwords aria-label="📝 Afterwords">📝 Afterwords</a></li></ul></div></details></div><div class=post-content><blockquote><p>开个新坑，之前囫囵吞枣地过了一遍 202，现在忘得差不多了，该捡起来。正好给枯燥的生活增添一点色彩（？），最近比较忙但还是争取一周做一个作业</p></blockquote><hr><h2 id=-0x00-to-begin-with>🚩 0x00 To begin with<a hidden class=anchor aria-hidden=true href=#-0x00-to-begin-with>#</a></h2><p>这篇文章将会包含以下内容：</p><ul><li><input checked disabled type=checkbox> GAMES202 作业 0</li><li><input checked disabled type=checkbox> <strong>不</strong>包含作业框架分析</li></ul><p><strong>For reference</strong>👇：</p><ul><li>📺 B 站视频：
<a href="https://www.bilibili.com/video/BV1YK4y1T7yY/?spm_id_from=333.337.top_right_bar_window_custom_collection.content.click&amp;vd_source=b6584cebba3a7a1a34d2f60d63bdc868">GAMES202-高质量实时渲染</a></li><li>📦 代码仓库：
<a href=https://github.com/congyuxiaoyoudao/GAMES202_Homework/tree/working>congyuxiaoyoudao/GAMES202_Homework at working</a></li></ul><blockquote><p>master 分支上是 202 全部作业汇总，working 分支用于提交代码。需要原始作业可下载 master 分支的包</p></blockquote><hr><h2 id=-0x01-configuration-环境配置>⚙️ 0x01 Configuration 环境配置<a hidden class=anchor aria-hidden=true href=#-0x01-configuration-环境配置>#</a></h2><p>选择使用 VSCode 插件搭建本地服务器，在扩展中搜索 Live Server，安装此插件。</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%203.GAMES202HW0/202504072204421.png#center></p><p>在编辑 Html 代码窗口按 F1（或者右键）选择 <strong>Live Server: Open with Live Server</strong>，随后会自动打开浏览器，导航至本地服务器端口，一切正常的话是下面这个效果：</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%203.GAMES202HW0/202504072210368.png#center></p><p>可以使用鼠标和右上角的控制面板进行一些简单的交互。</p><p>如果遇到模型贴图加载不出来（只有 202 字样），可以选择多刷新几次。或者直接在加载脚本前预加载贴图，可以根治这个问题。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=ln>1</span><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;preload&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;assets/mary/MC003_Kozakura_Mari.png&#34;</span> <span class=na>as</span><span class=o>=</span><span class=s>&#34;image&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/png&#34;</span> <span class=na>crossorigin</span><span class=p>/&gt;</span>
</span></span></code></pre></div><hr><h2 id=-0x02-blinn-phong-shading-model>🤔 0x02 Blinn-Phong Shading Model<a hidden class=anchor aria-hidden=true href=#-0x02-blinn-phong-shading-model>#</a></h2><blockquote><p>没什么好说的，CV 工程师</p></blockquote><h3 id=使用-glsl-编写-shader><strong>使用 GLSL 编写 Shader</strong><a hidden class=anchor aria-hidden=true href=#使用-glsl-编写-shader>#</a></h3><p>如果使用字符串的方式引入 Shader，就在 InternalShader.js 中加上：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// Phong Shader</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>const</span> <span class=n>PhongVertexShader</span> <span class=o>=</span> <span class=err>`</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>// attribute is vertex input data</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>attribute</span> <span class=k>vec3</span> <span class=n>aVertexPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>attribute</span> <span class=k>vec3</span> <span class=n>aNormalPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>attribute</span> <span class=k>vec2</span> <span class=n>aTextureCoord</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>// uniform is consistent/global data between VS/PS in a drawcall</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>uModelViewMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>uProjectionMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1>// varying is data need to be interpolated from VS to PS</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec2</span> <span class=n>vTextureCoord</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vFragPos</span><span class=p>;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vNormal</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=k>void</span> <span class=n>main</span><span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=n>vFragPos</span> <span class=o>=</span> <span class=n>aVertexPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=n>vNormal</span> <span class=o>=</span> <span class=n>aNormalPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=c1>// MVP</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=n>gl_Position</span> <span class=o>=</span> <span class=n>uProjectionMatrix</span> <span class=o>*</span> <span class=n>uModelViewMatrix</span> <span class=o>*</span> <span class=k>vec4</span><span class=p>(</span><span class=n>aVertexPosition</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=n>vTextureCoord</span> <span class=o>=</span> <span class=n>aTextureCoord</span><span class=p>;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=err>`</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=k>const</span> <span class=n>PhongFragmentShader</span> <span class=o>=</span> <span class=err>`</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=cp>#ifdef GL_ES</span>
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=k>precision</span> <span class=k>mediump</span> <span class=k>float</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=cp>#endif</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>uSampler</span><span class=p>;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1>//binn</span>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>uKd</span><span class=p>;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>uKs</span><span class=p>;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>uLightPos</span><span class=p>;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>uCameraPos</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=k>uniform</span> <span class=k>float</span> <span class=n>uLightIntensity</span><span class=p>;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=k>uniform</span> <span class=k>int</span> <span class=n>uTextureSample</span><span class=p>;</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>  
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec2</span> <span class=n>vTextureCoord</span><span class=p>;</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vFragPos</span><span class=p>;</span>
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=k>varying</span> <span class=k>highp</span> <span class=k>vec3</span> <span class=n>vNormal</span><span class=p>;</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>
</span></span><span class=line><span class=ln>46</span><span class=cl><span class=k>void</span> <span class=n>main</span><span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>  <span class=k>vec3</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>uTextureSample</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>	  <span class=c1>// Gamma correction</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>	  <span class=n>color</span> <span class=o>=</span> <span class=n>pow</span><span class=p>(</span><span class=n>texture2D</span><span class=p>(</span><span class=n>uSampler</span><span class=p>,</span> <span class=n>vTextureCoord</span><span class=p>).</span><span class=n>rgb</span><span class=p>,</span> <span class=k>vec3</span><span class=p>(</span><span class=mf>2.2</span><span class=p>));</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>  <span class=c1>// default color</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=n>color</span> <span class=o>=</span> <span class=n>uKd</span><span class=p>;</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>
</span></span><span class=line><span class=ln>56</span><span class=cl>  <span class=k>vec3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=mf>0.05</span> <span class=o>*</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>
</span></span><span class=line><span class=ln>58</span><span class=cl>  <span class=c1>// lambertian diffuse</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>  <span class=k>vec3</span> <span class=n>lightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>uLightPos</span><span class=o>-</span> <span class=n>vFragPos</span><span class=p>);</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>  <span class=k>vec3</span> <span class=n>normal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>vNormal</span><span class=p>);</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=k>float</span> <span class=n>diff</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=n>dot</span><span class=p>(</span><span class=n>lightDir</span><span class=p>,</span> <span class=n>normal</span><span class=p>),</span> <span class=mf>0.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>  <span class=k>float</span> <span class=n>light_atten_coff</span> <span class=o>=</span> <span class=n>uLightIntensity</span> <span class=o>/</span> <span class=n>length</span><span class=p>(</span><span class=n>uLightPos</span><span class=o>-</span> <span class=n>vFragPos</span><span class=p>);</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>  <span class=k>vec3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>diff</span> <span class=o>*</span> <span class=n>light_atten_coff</span> <span class=o>*</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>
</span></span><span class=line><span class=ln>65</span><span class=cl>  <span class=c1>// Phong specular</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>  <span class=k>vec3</span> <span class=n>viewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>uCameraPos</span><span class=o>-</span> <span class=n>vFragPos</span><span class=p>);</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>  <span class=k>float</span> <span class=n>spec</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>  <span class=k>vec3</span> <span class=n>reflectDir</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>lightDir</span><span class=p>,</span> <span class=n>normal</span><span class=p>);</span>
</span></span><span class=line><span class=ln>69</span><span class=cl>  <span class=n>spec</span> <span class=o>=</span> <span class=n>pow</span> <span class=p>(</span><span class=n>max</span><span class=p>(</span><span class=n>dot</span><span class=p>(</span><span class=n>viewDir</span><span class=p>,</span> <span class=n>reflectDir</span><span class=p>),</span> <span class=mf>0.0</span><span class=p>),</span> <span class=mf>35.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>  <span class=k>vec3</span> <span class=n>specular</span> <span class=o>=</span> <span class=n>uKs</span> <span class=o>*</span> <span class=n>light_atten_coff</span> <span class=o>*</span> <span class=n>spec</span><span class=p>;</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>
</span></span><span class=line><span class=ln>72</span><span class=cl>  <span class=c1>// Compose all components and do gamma reverse</span>
</span></span><span class=line><span class=ln>73</span><span class=cl>  <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>pow</span><span class=p>((</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span> <span class=o>+</span> <span class=n>specular</span><span class=p>),</span> <span class=k>vec3</span><span class=p>(</span><span class=mf>1.0</span><span class=o>/</span><span class=mf>2.2</span><span class=p>)),</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>74</span><span class=cl>
</span></span><span class=line><span class=ln>75</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>76</span><span class=cl><span class=err>`</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=实现-phongmaterial-类><strong>实现 PhongMaterial 类</strong><a hidden class=anchor aria-hidden=true href=#实现-phongmaterial-类>#</a></h3><p>在 src/materials/ 下新建 PhongMaterial.js，定义继承自 <code>Material</code> 的 <code>PhongMaterial</code> 类，传参，绑定 Shader。</p><blockquote><p><code>super</code> 调用父类构造</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=kr>class</span> <span class=nx>PhongMaterial</span> <span class=kr>extends</span> <span class=nx>Material</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cm> * Creates an instance of PhongMaterial.
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=cm> * @param {vec3f} color The material color
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=cm> * @param {Texture} colorMap The texture object of the material
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=cm> * @param {vec3f} specular The material specular coefficient
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=cm> * @param {float} intensity The light intensity
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=cm> * @memberof PhongMaterial
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>color</span><span class=p>,</span> <span class=nx>colorMap</span><span class=p>,</span> <span class=nx>specular</span><span class=p>,</span> <span class=nx>intensity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=kd>let</span> <span class=nx>textureSample</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>colorMap</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>            <span class=nx>textureSample</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=kr>super</span><span class=p>({</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=s1>&#39;uTextureSample&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;1i&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>textureSample</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>            <span class=s1>&#39;uSampler&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;texture&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>colorMap</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>            <span class=s1>&#39;uKd&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;3fv&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>color</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>            <span class=s1>&#39;uKs&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;3fv&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>specular</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>            <span class=s1>&#39;uLightIntensity&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;1f&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>intensity</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=p>},</span> <span class=p>[],</span> <span class=nx>PhongVertexShader</span><span class=p>,</span> <span class=nx>PhongFragmentShader</span><span class=p>);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=c1>//console.log(color);
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>        <span class=kr>super</span><span class=p>({</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=s1>&#39;uTextureSample&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;1i&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>textureSample</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=s1>&#39;uKd&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;3fv&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>color</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=s1>&#39;uKs&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;3fv&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>specular</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=s1>&#39;uLightIntensity&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;1f&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>intensity</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=p>},</span> <span class=p>[],</span> <span class=nx>PhongVertexShader</span><span class=p>,</span> <span class=nx>PhongFragmentShader</span><span class=p>);</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=导入-phongmaterialjs><strong>导入 PhongMaterial.js</strong><a hidden class=anchor aria-hidden=true href=#导入-phongmaterialjs>#</a></h3><p>在 index.html 中，在导入 Material.js 之后导入 PhongMaterial.js。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=ln>1</span><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;src/materials/Material.js&#34;</span> <span class=na>defer</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c>&lt;!-- Load phong material **after** Material --&gt;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;src/materials/PhongMaterial.js&#34;</span> <span class=na>defer</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=使用-phongmaterial><strong>使用 PhongMaterial</strong><a hidden class=anchor aria-hidden=true href=#使用-phongmaterial>#</a></h3><p>src/loads/loadOBJ.js 中，删除原本创建默认材质的部分，改为使用 <code>PhongMaterial</code> 创建实例。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// // MARK: You can change the myMaterial object to your own Material instance
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>// let textureSample = 0;
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>// let myMaterial;
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1>// if (colorMap != null) {
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1>// 	textureSample = 1;
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1>// 	myMaterial = new Material({
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>// 		&#39;uSampler&#39;: { type: &#39;texture&#39;, value: colorMap },
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>// 		&#39;uTextureSample&#39;: { type: &#39;1i&#39;, value: textureSample },
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>// 		&#39;uKd&#39;: { type: &#39;3fv&#39;, value: mat.color.toArray() }
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>// 	},[],VertexShader, FragmentShader);
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>// }else{
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1>// 	myMaterial = new Material({
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1>// 		&#39;uTextureSample&#39;: { type: &#39;1i&#39;, value: textureSample },
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1>// 		&#39;uKd&#39;: { type: &#39;3fv&#39;, value: mat.color.toArray() }
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1>// 	},[],VertexShader, FragmentShader);
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>							
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=kd>let</span> <span class=nx>myMaterial</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PhongMaterial</span><span class=p>(</span> <span class=nx>mat</span><span class=p>.</span><span class=nx>color</span><span class=p>.</span><span class=nx>toArray</span><span class=p>(),</span> 
</span></span><span class=line><span class=ln>20</span><span class=cl>									<span class=nx>colorMap</span><span class=p>,</span> 
</span></span><span class=line><span class=ln>21</span><span class=cl>									<span class=nx>mat</span><span class=p>.</span><span class=nx>specular</span><span class=p>.</span><span class=nx>toArray</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>								<span class=nx>renderer</span><span class=p>.</span><span class=nx>lights</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>entity</span><span class=p>.</span><span class=nx>mat</span><span class=p>.</span><span class=nx>intensity</span><span class=p>)</span>
</span></span></code></pre></div><hr><h2 id=-extra从文件中加载-shader>🍪 Extra：从文件中加载 Shader<a hidden class=anchor aria-hidden=true href=#-extra从文件中加载-shader>#</a></h2><blockquote><p>为了让这篇显得不那么水，补一下另一个从外部文件加载 Shader 的方法，在 src/shaders/phongShader 中已经给出了这两个着色器文件</p></blockquote><h3 id=更改-phongmaterial-类><strong>更改 PhongMaterial 类</strong><a hidden class=anchor aria-hidden=true href=#更改-phongmaterial-类>#</a></h3><p>因为构造函数不支持异步，就把创建 Material 的逻辑放到一个函数中，在这个函数里调用 loadShader.js 中定义的 <code>loadShaderFile</code> 函数加载 shader 文件，等待加载完后再调用构造函数并返回新创建的实例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// Load the shader files from file
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>PhongMaterial</span> <span class=kr>extends</span> <span class=nx>Material</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>uniforms</span><span class=p>,</span> <span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>        <span class=kr>super</span><span class=p>(</span><span class=nx>uniforms</span><span class=p>,</span> <span class=p>[],</span> <span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=cm>     * Creates an instance of PhongMaterial async.
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=cm>     * @param {vec3f} color
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=cm>     * @param {Texture} colorMap
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=cm>     * @param {vec3f} specular
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=cm>     * @param {float} intensity
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=cm>     * @returns {Promise&lt;PhongMaterial&gt;}
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=kr>static</span> <span class=kr>async</span> <span class=nx>create</span><span class=p>(</span><span class=nx>color</span><span class=p>,</span> <span class=nx>colorMap</span><span class=p>,</span> <span class=nx>specular</span><span class=p>,</span> <span class=nx>intensity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=kr>const</span> <span class=nx>textureSample</span> <span class=o>=</span> <span class=nx>colorMap</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=kr>const</span> <span class=p>[</span><span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>            <span class=nx>loadShaderFile</span><span class=p>(</span><span class=s1>&#39;src/shaders/phongShader/vertex.glsl&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>            <span class=nx>loadShaderFile</span><span class=p>(</span><span class=s1>&#39;src/shaders/phongShader/fragment.glsl&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=p>]);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=c1>// console.log(&#39;Vertex Shader:&#39;, vertexShader.slice(0, 100));
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>        <span class=c1>// console.log(&#39;Fragment Shader:&#39;, fragmentShader.slice(0, 100));  
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>uniforms</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>            <span class=s1>&#39;uTextureSample&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;1i&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>textureSample</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>            <span class=s1>&#39;uKd&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;3fv&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>color</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>            <span class=s1>&#39;uKs&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;3fv&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>specular</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>            <span class=s1>&#39;uLightIntensity&#39;</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;1f&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>intensity</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>colorMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>            <span class=nx>uniforms</span><span class=p>[</span><span class=s1>&#39;uSampler&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;texture&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>colorMap</span> <span class=p>};</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>PhongMaterial</span><span class=p>(</span><span class=nx>uniforms</span><span class=p>,</span> <span class=nx>vertexShader</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>);</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=更改-loadobjjs><strong>更改 loadOBJ.js</strong><a hidden class=anchor aria-hidden=true href=#更改-loadobjjs>#</a></h3><p>用 <code>create</code> 方法创建一个新材质实例，完成后进行渲染。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>1</span><span class=cl><span class=nx>PhongMaterial</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span> <span class=nx>mat</span><span class=p>.</span><span class=nx>color</span><span class=p>.</span><span class=nx>toArray</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>					  <span class=nx>colorMap</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>					  <span class=nx>mat</span><span class=p>.</span><span class=nx>specular</span><span class=p>.</span><span class=nx>toArray</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>					  <span class=nx>renderer</span><span class=p>.</span><span class=nx>lights</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>entity</span><span class=p>.</span><span class=nx>mat</span><span class=p>.</span><span class=nx>intensity</span><span class=p>)</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>			 <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>myMaterial</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>				<span class=kd>let</span> <span class=nx>meshRender</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MeshRender</span><span class=p>(</span><span class=nx>renderer</span><span class=p>.</span><span class=nx>gl</span><span class=p>,</span> <span class=nx>mesh</span><span class=p>,</span> <span class=nx>myMaterial</span><span class=p>);</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>				<span class=nx>renderer</span><span class=p>.</span><span class=nx>addMesh</span><span class=p>(</span><span class=nx>meshRender</span><span class=p>);</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>			 <span class=p>})</span>
</span></span></code></pre></div><h2 id=-afterwords>📝 <strong>Afterwords</strong><a hidden class=anchor aria-hidden=true href=#-afterwords>#</a></h2><p>一切正常就是下面的效果。</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%203.GAMES202HW0/202504072254052.png#center></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://congyuxiaoyoudao.github.io/tags/games202/>GAMES202</a></li></ul><nav class=paginav><a class=prev href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-1/><span class=title>« 上一页</span><br><span>Assignment 4. GAMES202 Homework 1</span>
</a><a class=next href=https://congyuxiaoyoudao.github.io/posts/assignments/a-review-of-realistic-water-waveform-simulation/><span class=title>下一页 »</span><br><span>Assignment 2. A Review of Realistic Water Waveform Simulation</span></a></nav></footer><div id=tw-comment></div><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="light"?"light":"noborder_dark",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"congyuxiaoyoudao/congyuxiaoyoudao.github.io","data-repo-id":"","data-category":"Announcements","data-category-id":"","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"","data-emit-metadata":"","data-input-position":"","data-theme":getStoredTheme(),"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous"},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#tw-comment").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://congyuxiaoyoudao.github.io/>The Only Problem's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>