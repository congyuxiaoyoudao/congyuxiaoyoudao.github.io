<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Assignment 8. GAMES202 Homework 5 | The Only Problem's Blog</title><meta name=keywords content="GAMES202,RTRT"><meta name=description content="
202 ç³»åˆ—å®Œç»“æ’’èŠ± âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿ï¼

0x00 To begin with
è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

 éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾
 GAMES202 ä½œä¸š 5

For referenceğŸ‘‡ï¼š

ğŸ“ºB ç«™è§†é¢‘ï¼š







  
  GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“


ğŸ“¦ä»£ç ä»“åº“ï¼š







  
  congyuxiaoyoudao/GAMES202_Homework at working










  
  ä½œä¸š5å‘å¸ƒå…¬å‘ŠåŠåœºæ™¯ä¸‹è½½


ğŸ“–







  
  GAMES202-ä½œä¸š5ï¼šå®æ—¶å…‰çº¿è¿½è¸ªé™å™ª




master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…

0x01 é—®é¢˜ä¿®å¤ TroubleShooting
åšä½œä¸šæ—¶é‡åˆ°ä¸€äº›å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸€å¹¶æä¸€ä¸‹ï¼š

è¿è¡Œ build.bat å build ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°å¯æ‰§è¡Œæ–‡ä»¶
ReadFloatImage æ–¹æ³•æŠ¥é”™
mathutil.h ä¸­ uint32_t was not declared in this scope

ç¬¬ä¸€ä¸ªé—®é¢˜çº¯å±å¯¹ Cmake ä¸ç†Ÿç»ƒï¼Œbuild.bat æä¾›çš„å‘½ä»¤åªæ˜¯ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶ï¼Œè¦è¿è¡Œæ„å»ºè¿˜éœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥ç”¨ VS ç­‰ IDE è¿è¡Œï¼‰ï¼š
1cmake --build build
è¿™é‡Œä¸ºäº†ç®€åŒ–è¿è¡Œæ“ä½œï¼Œæ–°å¢äº†ä¸€ä¸ª run.batï¼š
1cmake --build build
2cd build
3Denoise.exe
4cd ..
ç¬¬äºŒä¸ªé—®é¢˜ä¸ºè·¯å¾„é”™è¯¯ï¼Œä¸‹è½½å®Œåœºæ™¯åæˆ‘çš„æ ¹ç›®å½•æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š"><meta name=author content="The Only Problem"><link rel=canonical href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-5/><link crossorigin=anonymous href=/assets/css/stylesheet.452758010f0b7fc9ad7fa528ffdfdd8eb9e830816fb8c8119f16f39583297db8.css integrity="sha256-RSdYAQ8Lf8mtf6Uo/9/djrnoMIFvuMgRnxbzlYMpfbg=" rel="preload stylesheet" as=style><link rel=icon href=https://congyuxiaoyoudao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://congyuxiaoyoudao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://congyuxiaoyoudao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://congyuxiaoyoudao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://congyuxiaoyoudao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity=sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity=sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk crossorigin=anonymous onload='window.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\$$",right:"\\\\$$",display:!1},{left:"\\$$",right:"\\\\$$",display:!0}]})})'></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css><meta property="og:url" content="https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-5/"><meta property="og:site_name" content="The Only Problem's Blog"><meta property="og:title" content="Assignment 8. GAMES202 Homework 5"><meta property="og:description" content=" 202 ç³»åˆ—å®Œç»“æ’’èŠ± âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿ï¼
0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾ GAMES202 ä½œä¸š 5 For referenceğŸ‘‡ï¼š
ğŸ“ºB ç«™è§†é¢‘ï¼š GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ ğŸ“¦ä»£ç ä»“åº“ï¼š congyuxiaoyoudao/GAMES202_Homework at working ä½œä¸š5å‘å¸ƒå…¬å‘ŠåŠåœºæ™¯ä¸‹è½½ ğŸ“– GAMES202-ä½œä¸š5ï¼šå®æ—¶å…‰çº¿è¿½è¸ªé™å™ª master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…
0x01 é—®é¢˜ä¿®å¤ TroubleShooting åšä½œä¸šæ—¶é‡åˆ°ä¸€äº›å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸€å¹¶æä¸€ä¸‹ï¼š
è¿è¡Œ build.bat å build ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°å¯æ‰§è¡Œæ–‡ä»¶ ReadFloatImage æ–¹æ³•æŠ¥é”™ mathutil.h ä¸­ uint32_t was not declared in this scope ç¬¬ä¸€ä¸ªé—®é¢˜çº¯å±å¯¹ Cmake ä¸ç†Ÿç»ƒï¼Œbuild.bat æä¾›çš„å‘½ä»¤åªæ˜¯ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶ï¼Œè¦è¿è¡Œæ„å»ºè¿˜éœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥ç”¨ VS ç­‰ IDE è¿è¡Œï¼‰ï¼š
1cmake --build build è¿™é‡Œä¸ºäº†ç®€åŒ–è¿è¡Œæ“ä½œï¼Œæ–°å¢äº†ä¸€ä¸ª run.batï¼š
1cmake --build build 2cd build 3Denoise.exe 4cd .. ç¬¬äºŒä¸ªé—®é¢˜ä¸ºè·¯å¾„é”™è¯¯ï¼Œä¸‹è½½å®Œåœºæ™¯åæˆ‘çš„æ ¹ç›®å½•æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-16T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-16T00:00:00+00:00"><meta property="article:tag" content="GAMES202"><meta property="article:tag" content="RTRT"><meta name=twitter:card content="summary"><meta name=twitter:title content="Assignment 8. GAMES202 Homework 5"><meta name=twitter:description content="
202 ç³»åˆ—å®Œç»“æ’’èŠ± âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿ï¼

0x00 To begin with
è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

 éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾
 GAMES202 ä½œä¸š 5

For referenceğŸ‘‡ï¼š

ğŸ“ºB ç«™è§†é¢‘ï¼š







  
  GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“


ğŸ“¦ä»£ç ä»“åº“ï¼š







  
  congyuxiaoyoudao/GAMES202_Homework at working










  
  ä½œä¸š5å‘å¸ƒå…¬å‘ŠåŠåœºæ™¯ä¸‹è½½


ğŸ“–







  
  GAMES202-ä½œä¸š5ï¼šå®æ—¶å…‰çº¿è¿½è¸ªé™å™ª




master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…

0x01 é—®é¢˜ä¿®å¤ TroubleShooting
åšä½œä¸šæ—¶é‡åˆ°ä¸€äº›å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸€å¹¶æä¸€ä¸‹ï¼š

è¿è¡Œ build.bat å build ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°å¯æ‰§è¡Œæ–‡ä»¶
ReadFloatImage æ–¹æ³•æŠ¥é”™
mathutil.h ä¸­ uint32_t was not declared in this scope

ç¬¬ä¸€ä¸ªé—®é¢˜çº¯å±å¯¹ Cmake ä¸ç†Ÿç»ƒï¼Œbuild.bat æä¾›çš„å‘½ä»¤åªæ˜¯ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶ï¼Œè¦è¿è¡Œæ„å»ºè¿˜éœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥ç”¨ VS ç­‰ IDE è¿è¡Œï¼‰ï¼š
1cmake --build build
è¿™é‡Œä¸ºäº†ç®€åŒ–è¿è¡Œæ“ä½œï¼Œæ–°å¢äº†ä¸€ä¸ª run.batï¼š
1cmake --build build
2cd build
3Denoise.exe
4cd ..
ç¬¬äºŒä¸ªé—®é¢˜ä¸ºè·¯å¾„é”™è¯¯ï¼Œä¸‹è½½å®Œåœºæ™¯åæˆ‘çš„æ ¹ç›®å½•æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://congyuxiaoyoudao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Assignments","item":"https://congyuxiaoyoudao.github.io/posts/assignments/"},{"@type":"ListItem","position":3,"name":"Assignment 8. GAMES202 Homework 5","item":"https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Assignment 8. GAMES202 Homework 5","name":"Assignment 8. GAMES202 Homework 5","description":" 202 ç³»åˆ—å®Œç»“æ’’èŠ± âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿ï¼\n0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\néƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾ GAMES202 ä½œä¸š 5 For referenceğŸ‘‡ï¼š\nğŸ“ºB ç«™è§†é¢‘ï¼š GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ ğŸ“¦ä»£ç ä»“åº“ï¼š congyuxiaoyoudao/GAMES202_Homework at working ä½œä¸š5å‘å¸ƒå…¬å‘ŠåŠåœºæ™¯ä¸‹è½½ ğŸ“– GAMES202-ä½œä¸š5ï¼šå®æ—¶å…‰çº¿è¿½è¸ªé™å™ª master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…\n0x01 é—®é¢˜ä¿®å¤ TroubleShooting åšä½œä¸šæ—¶é‡åˆ°ä¸€äº›å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸€å¹¶æä¸€ä¸‹ï¼š\nè¿è¡Œ build.bat å build ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°å¯æ‰§è¡Œæ–‡ä»¶ ReadFloatImage æ–¹æ³•æŠ¥é”™ mathutil.h ä¸­ uint32_t was not declared in this scope ç¬¬ä¸€ä¸ªé—®é¢˜çº¯å±å¯¹ Cmake ä¸ç†Ÿç»ƒï¼Œbuild.bat æä¾›çš„å‘½ä»¤åªæ˜¯ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶ï¼Œè¦è¿è¡Œæ„å»ºè¿˜éœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥ç”¨ VS ç­‰ IDE è¿è¡Œï¼‰ï¼š\n1cmake --build build è¿™é‡Œä¸ºäº†ç®€åŒ–è¿è¡Œæ“ä½œï¼Œæ–°å¢äº†ä¸€ä¸ª run.batï¼š\n1cmake --build build 2cd build 3Denoise.exe 4cd .. ç¬¬äºŒä¸ªé—®é¢˜ä¸ºè·¯å¾„é”™è¯¯ï¼Œä¸‹è½½å®Œåœºæ™¯åæˆ‘çš„æ ¹ç›®å½•æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š\n","keywords":["GAMES202","RTRT"],"articleBody":" 202 ç³»åˆ—å®Œç»“æ’’èŠ± âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿ï¼\n0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\néƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾ GAMES202 ä½œä¸š 5 For referenceğŸ‘‡ï¼š\nğŸ“ºB ç«™è§†é¢‘ï¼š GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ ğŸ“¦ä»£ç ä»“åº“ï¼š congyuxiaoyoudao/GAMES202_Homework at working ä½œä¸š5å‘å¸ƒå…¬å‘ŠåŠåœºæ™¯ä¸‹è½½ ğŸ“– GAMES202-ä½œä¸š5ï¼šå®æ—¶å…‰çº¿è¿½è¸ªé™å™ª master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…\n0x01 é—®é¢˜ä¿®å¤ TroubleShooting åšä½œä¸šæ—¶é‡åˆ°ä¸€äº›å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸€å¹¶æä¸€ä¸‹ï¼š\nè¿è¡Œ build.bat å build ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°å¯æ‰§è¡Œæ–‡ä»¶ ReadFloatImage æ–¹æ³•æŠ¥é”™ mathutil.h ä¸­ uint32_t was not declared in this scope ç¬¬ä¸€ä¸ªé—®é¢˜çº¯å±å¯¹ Cmake ä¸ç†Ÿç»ƒï¼Œbuild.bat æä¾›çš„å‘½ä»¤åªæ˜¯ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶ï¼Œè¦è¿è¡Œæ„å»ºè¿˜éœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥ç”¨ VS ç­‰ IDE è¿è¡Œï¼‰ï¼š\n1cmake --build build è¿™é‡Œä¸ºäº†ç®€åŒ–è¿è¡Œæ“ä½œï¼Œæ–°å¢äº†ä¸€ä¸ª run.batï¼š\n1cmake --build build 2cd build 3Denoise.exe 4cd .. ç¬¬äºŒä¸ªé—®é¢˜ä¸ºè·¯å¾„é”™è¯¯ï¼Œä¸‹è½½å®Œåœºæ™¯åæˆ‘çš„æ ¹ç›®å½•æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š\n1assignment5/ 2â”œâ”€â”€ examples/ 3|\tâ””â”€â”€ ... 4â”œâ”€â”€ src/ 5| â”œâ”€â”€ main.cpp 6â”‚ â””â”€â”€ ... 7â””â”€â”€ ... æ‰€ä»¥éœ€è¦åœ¨ main.cpp ä¸­æ›´æ”¹ä¸€ä¸‹è·¯å¾„ï¼ˆæˆ–è€…ç›´æ¥æŠŠ examples æ”¾åˆ° src ä¸‹ï¼‰ï¼š\n1filesystem::path inputDir(\"../examples/box/input\"); 2filesystem::path outputDir(\"../examples/box/output\"); ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œç¼ºå°‘å¤´æ–‡ä»¶ï¼Œåœ¨ mathutil.h ä¸­åŒ…å« å³å¯ã€‚\n0x02 è”åˆåŒè¾¹æ»¤æ³¢ Joint Bilateral Filter å¯¹äºå•å¸§å›¾åƒçš„é™å™ªï¼Œå®é™…ä¸Šå°±æ˜¯ä½é€šæ»¤æ³¢çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å¸¸è§çš„ä½é€šæ»¤æ³¢æ ¸ï¼ˆä¾‹å¦‚é«˜æ–¯æ ¸ï¼‰ä¼šæ— æ¡ä»¶åœ°æŠ¹é™¤è¾“å…¥å›¾åƒä¸­çš„é«˜é¢‘éƒ¨åˆ†ï¼ŒåŒ…æ‹¬å›¾åƒä¸­ä¸åŒç‰©ä½“çš„è¾¹ç•Œã€‚è€Œæˆ‘ä»¬å¸Œæœ›åœ¨é™å™ªçš„è¿‡ç¨‹ä¸­èƒ½å¤Ÿä¿ç•™è¿™äº›è¾¹ç¼˜ï¼Œé¿å… Overblurï¼Œå°±éœ€è¦å¯»æ‰¾åˆ«çš„æ–¹æ³•ã€‚\nåŒè¾¹æ»¤æ³¢æä¾›äº†ä¸€ä¸ªä¸é”™çš„æ€è·¯ï¼šåŒè¾¹æ»¤æ³¢æ ¸çš„æƒé‡ä¸ä»…è€ƒè™‘äº†åƒç´ é—´å‡ ä½•è·ç¦»çš„å·®å¼‚ï¼Œè¿˜è€ƒè™‘äº†å›¾åƒå€¼åŸŸä¸Šçš„å·®å¼‚ï¼š\n$$ w(i, j, k, l) = \\exp\\left( -\\frac{(i - k)^2 + (j - l)^2}{2\\sigma_d^2} - \\frac{\\|I(i, j) - I(k, l)\\|^2}{2\\sigma_r^2} \\right) $$ å½“ä¸¤ä¸ªåƒç´ åœ¨å€¼ï¼ˆé¢œè‰²ã€æ·±åº¦ç­‰ï¼‰ä¸Šå·®å¼‚è¿‡å¤§æ—¶ï¼Œé‡‡æ ·åƒç´ å¯¹ä¸­å¿ƒåƒç´ çš„è´¡çŒ®å°±å‡å°‘ï¼Œè¿™æ ·å°±å¯ä»¥ç»´æŒä½è¾¹ç¼˜ä¿¡æ¯ã€‚\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åŒè¾¹æ»¤æ³¢çš„åŸºç¡€ä¸Šï¼Œä¸ºæ ¸åŠ å…¥æ›´å¤šæ§åˆ¶ä»¥åº”å¯¹å¤šç§å¤æ‚è¾¹ç¼˜æƒ…å†µï¼Œè¿™å°±æ˜¯è”åˆåŒè¾¹æ»¤æ³¢çš„æ€æƒ³ã€‚\nä½¿ç”¨è”åˆåŒè¾¹æ»¤æ³¢å¯¹å•å¸§å›¾åƒè¿›è¡Œé™å™ªï¼Œä½œä¸šä¸­ç»™å‡ºçš„æ ¸ä¸ºï¼š\n$$ J(\\mathbf{i}, \\mathbf{j}) = \\exp\\left( -\\frac{\\|\\mathbf{i} - \\mathbf{j}\\|^2}{2\\sigma_p^2} - \\frac{\\|\\tilde{C}[i] - \\tilde{C}[j]\\|^2}{2\\sigma_c^2} - \\frac{D_{\\text{normal}}(\\mathbf{i}, \\mathbf{j})^2}{2\\sigma_n^2} - \\frac{D_{\\text{plane}}(\\mathbf{i}, \\mathbf{j})^2}{2\\sigma_d^2} \\right) $$ å…¶ä¸­ï¼š\n$\\lVert \\mathbf{i} - \\mathbf{j} \\rVert$ï¼šåƒç´ åæ ‡å·®å€¼ $\\lVert \\tilde{C}[i] - \\tilde{C}[j] \\rVert$ï¼šé¢œè‰²å·®å€¼ $D_{\\text{normal}}(\\mathbf{i}, \\mathbf{j}) = \\arccos\\left( \\text{Normal}[\\mathbf{i}] \\cdot \\text{{Normal}}[\\mathbf{j}] \\right)$ï¼Œæè¿°é¢æœå‘å·®å¼‚ $D_{\\text{plane}}(\\text{i}, \\text{j}) = \\text{Normal}[\\text{i}] \\cdot \\frac{\\text{Position}[\\text{j}] - \\text{Position}[\\text{i}]}{\\lVert \\text{Position}[\\text{j}] - \\text{Position}[\\text{i}] \\rVert}$ï¼Œæè¿°è·ç¦»å·®å¼‚ï¼ˆæ²¿æ³•å‘å˜åŒ–çš„è·ç¦»ï¼‰ ä¸€ç›´æœ‰ç‚¹ç–‘æƒ‘ä¸ºä»€ä¹ˆå¾ˆå¤šä½œä¸šå®ç°éƒ½æ˜¯æŠŠç¬¬ä¸€é¡¹å½“ä½œä¸–ç•Œä½ç½®å·®å¼‚ï¼Œè¯•äº†ä¸€ä¸‹æ•ˆæœä¹Ÿçš„ç¡®å·®ä¸å¤š\nå„ä¸ª $\\sigma$ ä¸ºæ§åˆ¶ä¸åŒé¡¹çš„å¹³æ»‘ç¨‹åº¦çš„æ ‡å‡†å·®ï¼Œ$\\sigma$ è¶Šå¤§è¡¨ç¤ºå¯¹ä¸Šè¿°è·ç¦»å·®å¼‚è¶Šä¸æ•æ„Ÿï¼Œå³æ›´èƒ½å®¹å¿æƒé‡å·®å¼‚ã€‚\nåœ¨ denoise.cpp ä¸­å®Œæˆ Filter å‡½æ•°ï¼ŒæŒ‰ç…§ä¸Šè¿°å…¬å¼å®Œæˆè”åˆåŒè¾¹æ»¤æ³¢é€»è¾‘ï¼š\n1Buffer2D\u003cFloat3\u003e Denoiser::Filter(const FrameInfo \u0026frameInfo) { 2 int height = frameInfo.m_beauty.m_height; 3 int width = frameInfo.m_beauty.m_width; 4 Buffer2D\u003cFloat3\u003e filteredImage = CreateBuffer2D\u003cFloat3\u003e(width, height); 5 int kernelRadius = 16; 6#pragma omp parallel for 7 for (int y = 0; y \u003c height; y++) { 8 for (int x = 0; x \u003c width; x++) { 9 // Joint bilateral filter 10 // get current pixel vals 11 Float3 color = frameInfo.m_beauty(x, y); 12 Float3 normal = frameInfo.m_normal(x, y); 13 Float3 pos = frameInfo.m_position(x, y); 14 15 float weight_sum = 0.f; 16 Float3 color_sum = Float3(0.f); 17 for(int i = -kernelRadius; i \u003c= kernelRadius; i++){ 18 for(int j = -kernelRadius; j \u003c= kernelRadius; j++){ 19 // clamp coordinate 20 int sampleCoord_x = std::min(std::max(0,x+i),width-1); 21 int sampleCoord_y = std::min(std::max(0,y+j),height-1); 22 23 // sample sampled pixel vals 24 Float3 sampledColor = frameInfo.m_beauty(sampleCoord_x,sampleCoord_y); 25 Float3 sampledNormal = frameInfo.m_normal(sampleCoord_x,sampleCoord_y); 26 Float3 sampledPos = frameInfo.m_position(sampleCoord_x,sampleCoord_y); 27 28 // calculate weight 29 float weight = 0.0; 30 float d_coord2 = i*i+j*j; 31 32 float d_color2 = SqrDistance(color,sampledColor); 33 34 float cosTheta = Dot(normal,sampledNormal); 35 float d_normal2 = SafeAcos(cosTheta)*SafeAcos(cosTheta); 36 37 float d_plane = 0.f; 38 float d_pos = Distance(pos, sampledPos); 39 if (d_pos \u003e 0) 40 d_plane = Dot(normal,Normalize(sampledPos-pos)); 41 float d_plane2 = d_plane*d_plane; 42 43 float w_coord = - d_coord2/(2*m_sigmaCoord*m_sigmaCoord); 44 float w_color = - d_color2/(2*m_sigmaColor*m_sigmaColor); 45 float w_normal = - d_normal2/(2*m_sigmaNormal*m_sigmaNormal); 46 float w_plane = - d_plane2/(2*m_sigmaPlane*m_sigmaPlane); 47 48 weight = exp(w_coord+w_color+w_normal+w_plane); 49 // accumulate weight and color buffer 50 weight_sum += weight; 51 color_sum += sampledColor * weight; 52 } 53 } 54 // protect 0 weight 55 if(weight_sum == 0.0f){ 56 filteredImage(x, y) = color; 57 } 58 else{ 59 filteredImage(x, y) = color_sum / weight_sum; 60 } 61 } 62 } 63 return filteredImage; 64} 0x03 åæŠ•å½± Reprojection åæŠ•å½±åˆ©ç”¨å½“å‰å¸§çš„ä¿¡æ¯æ‰¾åˆ°ä¸Šä¸€å¸§çš„å¯¹åº”åƒç´ ä½ç½®ï¼Œé€šè¿‡åæŠ•å½±å¯ä»¥åœ¨æ—¶é—´ä¸Šå¤ç”¨å·²ç»æ»¤æ³¢çš„ä¸Šä¸€å¸§ä¿¡æ¯ã€‚\nå·²çŸ¥å½“å‰å¸§çš„åƒç´ åæ ‡ï¼Œå¯ä»¥åœ¨ GBuffer ä¸Šè·å–ä¸–ç•Œä½ç½®å’Œå„ç±»å˜æ¢çŸ©é˜µï¼Œä½¿ç”¨ä¸‹å¼å³å¯é€šè¿‡åƒç´ ä¸–ç•Œä½ç½®æ‰¾åˆ°ä¸Šä¸€å¸§è¯¥åƒç´ çš„å±å¹•åæ ‡ï¼š\n$$ \\text{Screen}_{i-1} = P_{i-1} V_{i-1} M_{i-1} M_i^{-1} \\, \\text{World}_i $$ æŠ•å½±åˆ°å±å¹•åæ ‡ä¸‹ä¼šå­˜åœ¨ä¸€äº›å±å¹•ç©ºé—´å›ºæœ‰çš„é—®é¢˜ï¼Œå¯¼è‡´åæŠ•å½±åçš„åƒç´ ä¸åˆæ³•ï¼Œè‹¥å¼ºè¡Œå¤ç”¨ä¼šå¯¼è‡´ lagging ï¼Œå¯¹äºè¿™äº›æƒ…å†µæˆ‘ä»¬è¦æ‰‹åŠ¨è¿›è¡Œåˆ¤æ–­ï¼š\nåæŠ•å½±åçš„åƒç´ åœ¨å±å¹•å¤–ï¼Œå³å½“å‰å¸§åƒç´ å¯¹åº”æ–°è¿›å…¥å±å¹•çš„ç‰©ä½“ åæŠ•å½±åçš„åƒç´ å’Œå½“å‰å¸§åƒç´ å¯¹åº”ç‰©ä½“çš„ id ä¸åŒ ç¬¬ä¸€ç§æƒ…å†µå¯ä»¥é€šè¿‡åˆ¤æ–­åæŠ•å½±åçš„åƒç´ åæ ‡æ˜¯å¦åˆæ³•å±å¹•èŒƒå›´å†…ï¼ˆ$[0,w-1],[0,h-1]$ï¼‰ï¼›ç¬¬äºŒç§æƒ…å†µå¯ä»¥é€šè¿‡åˆ¤æ–­ GBuffer Id æ˜¯å¦ç›¸ç­‰ã€‚ä»…å¯¹ä¸Šè¿°åˆ¤æ–­ååˆæ³•çš„åƒç´ è¿›è¡Œæ—¶é—´ç´¯ç§¯ï¼Œæ›´æ–° m_valid å’Œ m_miscã€‚\næŒ‰ç…§ä¸Šè¿°æ€è·¯å®Œæˆ Reprojection å‡½æ•°ï¼š\n1void Denoiser::Reprojection(const FrameInfo \u0026frameInfo) { 2 int height = m_accColor.m_height; 3 int width = m_accColor.m_width; 4 Matrix4x4 preWorldToScreen = 5 m_preFrameInfo.m_matrix[m_preFrameInfo.m_matrix.size() - 1]; 6 Matrix4x4 preWorldToCamera = 7 m_preFrameInfo.m_matrix[m_preFrameInfo.m_matrix.size() - 2]; 8#pragma omp parallel for 9 for (int y = 0; y \u003c height; y++) { 10 for (int x = 0; x \u003c width; x++) { 11 // Reproject 12 m_valid(x, y) = false; 13 m_misc(x, y) = Float3(0.f); 14 15 float id = frameInfo.m_id(x, y); 16 // skip ivalid id 17 if(id == -1) 18 continue; 19 20 Float3 pos = frameInfo.m_position(x, y); 21 Matrix4x4 WorldToLocal = Inverse(frameInfo.m_matrix[id]); 22 Matrix4x4 preLocalToWorld = m_preFrameInfo.m_matrix[id]; 23 // P_{i-1}V_{i-1}M_{-1}M_{i}^{-1} 24 Matrix4x4 ReprojectionMatrix = preWorldToScreen*preLocalToWorld*WorldToLocal; 25 26 Float3 prePosScreen = ReprojectionMatrix(pos, Float3::EType::Point); 27 float pre_x = prePosScreen.x; 28 float pre_y = prePosScreen.y; 29 30 // is in viewport 31 if(pre_x\u003c0 || pre_x\u003ewidth-1 || pre_y\u003c0 || pre_y\u003eheight-1) 32 continue; 33 34 float preId = m_preFrameInfo.m_id(pre_x, pre_y); 35 36 if(preId == id){ 37 m_valid(x, y) = true; 38 m_misc(x, y) = m_accColor(pre_x, pre_y); 39 } 40 } 41 } 42 std::swap(m_misc, m_accColor); 43} 0x04 æ—¶é—´ç´¯ç§¯ Temporal Accumulation åæŠ•å½±å°†å½“å‰å¸§æ‰€æœ‰åƒç´ å¯¹åº”çš„ä¸Šä¸€å¸§åæŠ•å½±çš„åƒç´ é¢œè‰²ï¼ˆè‹¥åˆæ³•ï¼‰å­˜å…¥ m_accColorï¼Œä»¥ä¾¿æ—¶é—´ç´¯ç§¯å¤ç”¨ã€‚\nå¦‚æœç›´æ¥ä½¿ç”¨ä¸Šä¸€å¸§çš„ä¿¡æ¯ï¼Œå½“å…¶é¢œè‰²ä¸å½“å‰é¢œè‰²å·®å¼‚è¿‡å¤§æ—¶å¯èƒ½å¯¼è‡´ ghostingï¼Œä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µï¼Œéœ€è¦å¯¹ä¸Šä¸€å¸§ä¿¡æ¯å’Œå½“å‰å¸§ä¿¡æ¯åšé’³åˆ¶ï¼Œå³ï¼š\n$$ C^{(i-1)}=\\text{clamp}(C^{(i-1)}, \\mu - k\\sigma, \\mu + k\\sigma) $$ å…¶ä¸­ï¼Œ$\\mu,\\sigma$ åˆ†åˆ«ä¸ºå½“å‰å¸§åƒç´ æŸä¸€é‚»åŸŸçš„å‡å€¼å’Œæ–¹å·®ã€‚é’³åˆ¶åå³å¯ä½¿ç”¨ä¸‹å¼æ··åˆé¢œè‰²ï¼š\n$$ C^{(i)} = \\alpha \\bar{C}^{(i)} + (1 - \\alpha) C^{(i-1)} $$ å…¶ä¸­ï¼Œ$\\bar{C}^{(i)}$ ä¸ºå½“å‰å¸§å·²é™å™ªåƒç´ ä¿¡æ¯ï¼Œ$C^{(i-1)}$ ä¸ºä¸Šä¸€å¸§å·²é™å™ªåæŠ•å½±åƒç´ ä¿¡æ¯ï¼Œ$\\alpha$ é€šå¸¸å– 0.2ï¼Œè¡¨ç¤ºæ›´å¤šåœ°ä½¿ç”¨ä¸Šä¸€å¸§ä¿¡æ¯ã€‚\nåœ¨ denoise.cpp ä¸­å®Œæˆ TemporalAccumulation å‡½æ•°ï¼Œé€šè¿‡éå†å½“å‰åƒç´ çš„ 7Ã—7 é‚»åŸŸè®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œå¹¶å°†ä¸Šä¸€å¸§ä¿¡æ¯é™åˆ¶åˆ° $(\\mu-k\\sigma,\\mu+k\\sigma)$ èŒƒå›´å†…ã€‚ä¸ºäº†é¿å…æ±‚æ–¹å·®å†åšä¸€éå¾ªç¯ï¼Œå¯ä»¥åˆ©ç”¨æ–¹å·®çš„å¦ä¸€ä¸ªè®¡ç®—å…¬å¼ï¼š\n$$ Var(X)=E(X^{2})-E(X)^{2} $$ 1void Denoiser::TemporalAccumulation(const Buffer2D\u003cFloat3\u003e \u0026curFilteredColor) { 2 int height = m_accColor.m_height; 3 int width = m_accColor.m_width; 4 int kernelRadius = 3; 5 int kernelSize = 2*kernelRadius+1; 6 int sampleNum = kernelSize * kernelSize; 7#pragma omp parallel for 8 for (int y = 0; y \u003c height; y++) { 9 for (int x = 0; x \u003c width; x++) { 10 // Temporal clamp 11 float alpha = 1.0f; 12 // previous frame color 13 Float3 color = m_accColor(x, y); 14 15 if(m_valid(x, y)){ 16 alpha = m_alpha; 17 // calculate mu and sigma in 7*7 block 18 Float3 mu, mu2 = Float3(0.f); 19 Float3 sigma = Float3(0.f); 20 for(int i = -kernelRadius; i \u003c= kernelRadius; i++){ 21 for(int j = -kernelRadius; j \u003c= kernelRadius; j++){ 22 int sampleCoord_x = std::min(std::max(0,x+i),width-1); 23 int sampleCoord_y = std::min(std::max(0,y+j),height-1); 24 25 Float3 curSampledColor = curFilteredColor(sampleCoord_x, sampleCoord_y); 26 mu+=curSampledColor; 27 mu2+=Sqr(curSampledColor); 28 } 29 } 30 mu /= sampleNum; 31 mu2 /= sampleNum; 32 sigma = SafeSqrt(mu2 - mu*mu); 33 34 color = Clamp(color, mu-sigma*m_colorBoxK, mu+sigma*m_colorBoxK); 35 } 36 37 // Exponential moving average 38 m_misc(x, y) = Lerp(color, curFilteredColor(x, y), alpha); 39 } 40 } 41 std::swap(m_misc, m_accColor); 42} 0x05 A-Torus Wavelet åŠ é€Ÿ A-Torus Waveletï¼Œå³è¿›è¡Œå¤šæ¬¡æ»¤æ³¢ï¼Œæ¯æ¬¡ä½¿ç”¨é€æ¸å¢åŠ çš„æ»¤æ³¢æ ¸å°ºå¯¸å’Œæ­¥é•¿ï¼Œä»¥ä¿è¯æ¯æ¬¡æ»¤æ³¢çš„é‡‡æ ·ç‚¹æ•°ä¸å˜ã€‚æ€»å…±è¿›è¡Œ 5 æ¬¡æ»¤æ³¢ï¼Œæ¯æ¬¡æ»¤æ³¢è¾“å…¥å›¾åƒä¸ºä¸Šä¸€æ¬¡æ»¤æ³¢ç»“æœï¼Œç¬¬ $i$ æ¬¡æ»¤æ³¢çš„æ­¥é•¿ä¸º $2^{i}$ï¼Œæ ¸å°ºå¯¸ä¸º $2^{i+2}+1$ ã€‚é€šè¿‡ A-Torus Wavelet çš„åŠ é€Ÿï¼Œå¯ä»¥å°†åŸæœ¬ $64^{2}$ çš„é‡‡æ ·æ•°å‡å°‘ä¸º $125$ï¼Œå¤§å¹…æå‡å•å¸§é™å™ªé€Ÿåº¦ã€‚\nåœ¨ Denoise ç±»ä¸­æ–°å¢ä¸€ä¸ª ATWFilter å‡½æ•°ï¼Œå®ç°ç”± A-Trous Wavelet åŠ é€Ÿçš„æ»¤æ³¢ï¼Œåœ¨åŸæœ¬çš„ä¸¤å±‚ for å¾ªç¯å¤–éƒ¨å†åµŒå¥—ä¸€å±‚ forï¼š\n1Buffer2D\u003cFloat3\u003e Denoiser::ATWFilter(const FrameInfo \u0026frameInfo) { 2 int height = frameInfo.m_beauty.m_height; 3 int width = frameInfo.m_beauty.m_width; 4 Buffer2D\u003cFloat3\u003e filteredImage = CreateBuffer2D\u003cFloat3\u003e(width, height); 5 int passes = 5; 6#pragma omp parallel for 7 // Accelerated by A-Trous Wavelet 8 for (int y = 0; y \u003c height; y++) { 9 for (int x = 0; x \u003c width; x++) { 10 // Joint bilateral filter 11 // get current pixel vals 12 Float3 color = frameInfo.m_beauty(x, y); 13 Float3 normal = frameInfo.m_normal(x, y); 14 Float3 pos = frameInfo.m_position(x, y); 15 16 float weight_sum = 0.f; 17 Float3 color_sum = Float3(0.f); 18 19 for(int pass = 0; pass \u003c passes; pass++){ 20 int stride = pow(2, pass); 21 int kernelRadius = stride * 2; 22 for(int i = -kernelRadius; i \u003c= kernelRadius; i+=stride){ 23 for(int j = -kernelRadius; j \u003c= kernelRadius; j+=stride){ 24 // clamp coordinate 25 int sampleCoord_x = std::min(std::max(0,x+i),width-1); 26 int sampleCoord_y = std::min(std::max(0,y+j),height-1); 27 28 // sample sampled pixel vals 29 Float3 sampledColor = frameInfo.m_beauty(sampleCoord_x,sampleCoord_y); 30 Float3 sampledNormal = frameInfo.m_normal(sampleCoord_x,sampleCoord_y); 31 Float3 sampledPos = frameInfo.m_position(sampleCoord_x,sampleCoord_y); 32 33 // calculate weight 34 float weight = 0.0; 35 float d_coord2 = i*i+j*j; 36 37 float d_color2 = SqrDistance(color,sampledColor); 38 39 float cosTheta = Dot(normal,sampledNormal); 40 float d_normal2 = SafeAcos(cosTheta)*SafeAcos(cosTheta); 41 42 float d_plane = 0.f; 43 float d_pos = Distance(pos, sampledPos); 44 if (d_pos \u003e 0) 45 d_plane = Dot(normal,Normalize(sampledPos-pos)); 46 float d_plane2 = d_plane*d_plane; 47 48 float w_coord = - d_coord2/(2*m_sigmaCoord*m_sigmaCoord); 49 float w_color = - d_color2/(2*m_sigmaColor*m_sigmaColor); 50 float w_normal = - d_normal2/(2*m_sigmaNormal*m_sigmaNormal); 51 float w_plane = - d_plane2/(2*m_sigmaPlane*m_sigmaPlane); 52 53 weight = exp(w_coord+w_color+w_normal+w_plane); 54 // accumulate weight and color buffer 55 weight_sum += weight; 56 color_sum += sampledColor * weight; 57 } 58 } 59 // protect 0 weight 60 if(weight_sum == 0.0f){ 61 filteredImage(x, y) = color; 62 } 63 else{ 64 filteredImage(x, y) = color_sum / weight_sum; 65 } 66 } 67 } 68 } 69 return filteredImage; 70} åŠ é€Ÿæ•ˆæœä¹Ÿæ˜¯ååˆ†æ˜æ˜¾çš„ï¼ŒATWFilter æ¯” Filter å‡ ä¹å¿«äº†ä¸¤åˆ†é’Ÿï¼Œä½†æ˜¯å°±å•å¸§é™å™ªè´¨é‡æ¥è¯´æ˜¯ä¸å¦‚ Filter çš„ã€‚\n0x06 Afterwords æ‰€ä»¥é—«å¤§çš„ç¦»çº¿æ¸²æŸ“è¯¾ä»€ä¹ˆæ—¶å€™å¼€ :p\n","wordCount":"1304","inLanguage":"zh","datePublished":"2025-06-16T00:00:00Z","dateModified":"2025-06-16T00:00:00Z","author":{"@type":"Person","name":"The Only Problem"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-5/"},"publisher":{"@type":"Organization","name":"The Only Problem's Blog","logo":{"@type":"ImageObject","url":"https://congyuxiaoyoudao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://congyuxiaoyoudao.github.io/ accesskey=h title="The Only Problem's Blog (Alt + H)">The Only Problem's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://congyuxiaoyoudao.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://congyuxiaoyoudao.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/>Posts</a>&nbsp;Â»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/assignments/>Assignments</a></div><h1 class="post-title entry-hint-parent">Assignment 8. GAMES202 Homework 5</h1><div class=post-meta><span title='2025-06-16 00:00:00 +0000 UTC'>å…­æœˆ 16, 2025</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;The Only Problem</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#0x00-to-begin-with aria-label="0x00 To begin with">0x00 To begin with</a></li><li><a href=#0x01-%e9%97%ae%e9%a2%98%e4%bf%ae%e5%a4%8d-troubleshooting aria-label="0x01 é—®é¢˜ä¿®å¤ TroubleShooting">0x01 é—®é¢˜ä¿®å¤ TroubleShooting</a></li><li><a href=#0x02-%e8%81%94%e5%90%88%e5%8f%8c%e8%be%b9%e6%bb%a4%e6%b3%a2-joint-bilateral-filter aria-label="0x02 è”åˆåŒè¾¹æ»¤æ³¢ Joint Bilateral Filter">0x02 è”åˆåŒè¾¹æ»¤æ³¢ Joint Bilateral Filter</a></li><li><a href=#0x03-%e5%8f%8d%e6%8a%95%e5%bd%b1-reprojection aria-label="0x03 åæŠ•å½± Reprojection">0x03 åæŠ•å½± Reprojection</a></li><li><a href=#0x04-%e6%97%b6%e9%97%b4%e7%b4%af%e7%a7%af-temporal-accumulation aria-label="0x04 æ—¶é—´ç´¯ç§¯ Temporal Accumulation">0x04 æ—¶é—´ç´¯ç§¯ Temporal Accumulation</a></li><li><a href=#0x05-a-torus-wavelet-%e5%8a%a0%e9%80%9f aria-label="0x05 A-Torus Wavelet åŠ é€Ÿ">0x05 A-Torus Wavelet åŠ é€Ÿ</a></li><li><a href=#0x06-afterwords aria-label="0x06 Afterwords">0x06 Afterwords</a></li></ul></div></details></div><div class=post-content><blockquote><p>202 ç³»åˆ—å®Œç»“æ’’èŠ± âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿ï¼</p></blockquote><hr><h2 id=0x00-to-begin-with>0x00 To begin with<a hidden class=anchor aria-hidden=true href=#0x00-to-begin-with>#</a></h2><p>è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><input checked disabled type=checkbox> éƒ¨åˆ†è¯¾ç¨‹å†…å®¹å›é¡¾</li><li><input checked disabled type=checkbox> GAMES202 ä½œä¸š 5</li></ul><p><strong>For reference</strong>ğŸ‘‡ï¼š</p><ul><li>ğŸ“ºB ç«™è§†é¢‘ï¼š
<a href="https://www.bilibili.com/video/BV1YK4y1T7yY/?spm_id_from=333.337.top_right_bar_window_custom_collection.content.click&amp;vd_source=b6584cebba3a7a1a34d2f60d63bdc868">GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“</a></li><li>ğŸ“¦ä»£ç ä»“åº“ï¼š
<a href=https://github.com/congyuxiaoyoudao/GAMES202_Homework/tree/working>congyuxiaoyoudao/GAMES202_Homework at working</a></li><li><a href=https://games-cn.org/forums/topic/zuoye5fabugonggao/>ä½œä¸š5å‘å¸ƒå…¬å‘ŠåŠåœºæ™¯ä¸‹è½½</a></li><li>ğŸ“–
<a href=https://zhuanlan.zhihu.com/p/607012514>GAMES202-ä½œä¸š5ï¼šå®æ—¶å…‰çº¿è¿½è¸ªé™å™ª</a></li></ul><blockquote><p>master åˆ†æ”¯ä¸Šæ˜¯ 202 å…¨éƒ¨ä½œä¸šæ±‡æ€»ï¼Œworking åˆ†æ”¯ç”¨äºæäº¤ä»£ç ã€‚éœ€è¦åŸå§‹ä½œä¸šå¯ä¸‹è½½ master åˆ†æ”¯çš„åŒ…</p></blockquote><hr><h2 id=0x01-é—®é¢˜ä¿®å¤-troubleshooting>0x01 é—®é¢˜ä¿®å¤ TroubleShooting<a hidden class=anchor aria-hidden=true href=#0x01-é—®é¢˜ä¿®å¤-troubleshooting>#</a></h2><p>åšä½œä¸šæ—¶é‡åˆ°ä¸€äº›å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸€å¹¶æä¸€ä¸‹ï¼š</p><ol><li>è¿è¡Œ build.bat å build ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°å¯æ‰§è¡Œæ–‡ä»¶</li><li><code>ReadFloatImage</code> æ–¹æ³•æŠ¥é”™</li><li>mathutil.h ä¸­ <code>uint32_t</code> was not declared in this scope</li></ol><p>ç¬¬ä¸€ä¸ªé—®é¢˜çº¯å±å¯¹ Cmake ä¸ç†Ÿç»ƒï¼Œbuild.bat æä¾›çš„å‘½ä»¤åªæ˜¯ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶ï¼Œè¦è¿è¡Œæ„å»ºè¿˜éœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥ç”¨ VS ç­‰ IDE è¿è¡Œï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>cmake --build build
</span></span></code></pre></div><p>è¿™é‡Œä¸ºäº†ç®€åŒ–è¿è¡Œæ“ä½œï¼Œæ–°å¢äº†ä¸€ä¸ª run.batï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>cmake --build build
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nb>cd</span> build
</span></span><span class=line><span class=ln>3</span><span class=cl>Denoise.exe
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=nb>cd</span> ..
</span></span></code></pre></div><p>ç¬¬äºŒä¸ªé—®é¢˜ä¸ºè·¯å¾„é”™è¯¯ï¼Œä¸‹è½½å®Œåœºæ™¯åæˆ‘çš„æ ¹ç›®å½•æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>assignment5/ 
</span></span><span class=line><span class=ln>2</span><span class=cl>â”œâ”€â”€ examples/
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>|</span>	â””â”€â”€ ...
</span></span><span class=line><span class=ln>4</span><span class=cl>â”œâ”€â”€ src/ 
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>|</span>   â”œâ”€â”€ main.cpp
</span></span><span class=line><span class=ln>6</span><span class=cl>â”‚   â””â”€â”€ ...
</span></span><span class=line><span class=ln>7</span><span class=cl>â””â”€â”€ ...
</span></span></code></pre></div><p>æ‰€ä»¥éœ€è¦åœ¨ main.cpp ä¸­æ›´æ”¹ä¸€ä¸‹è·¯å¾„ï¼ˆæˆ–è€…ç›´æ¥æŠŠ examples æ”¾åˆ° src ä¸‹ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln>1</span><span class=cl><span class=n>filesystem</span><span class=o>::</span><span class=n>path</span> <span class=n>inputDir</span><span class=p>(</span><span class=s>&#34;../examples/box/input&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>filesystem</span><span class=o>::</span><span class=n>path</span> <span class=n>outputDir</span><span class=p>(</span><span class=s>&#34;../examples/box/output&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œç¼ºå°‘å¤´æ–‡ä»¶ï¼Œåœ¨ mathutil.h ä¸­åŒ…å« <code>&lt;cstdint></code> å³å¯ã€‚</p><hr><h2 id=0x02-è”åˆåŒè¾¹æ»¤æ³¢-joint-bilateral-filter>0x02 è”åˆåŒè¾¹æ»¤æ³¢ Joint Bilateral Filter<a hidden class=anchor aria-hidden=true href=#0x02-è”åˆåŒè¾¹æ»¤æ³¢-joint-bilateral-filter>#</a></h2><p>å¯¹äºå•å¸§å›¾åƒçš„é™å™ªï¼Œå®é™…ä¸Šå°±æ˜¯ä½é€šæ»¤æ³¢çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å¸¸è§çš„ä½é€šæ»¤æ³¢æ ¸ï¼ˆä¾‹å¦‚é«˜æ–¯æ ¸ï¼‰ä¼šæ— æ¡ä»¶åœ°æŠ¹é™¤è¾“å…¥å›¾åƒä¸­çš„é«˜é¢‘éƒ¨åˆ†ï¼ŒåŒ…æ‹¬å›¾åƒä¸­ä¸åŒç‰©ä½“çš„è¾¹ç•Œã€‚è€Œæˆ‘ä»¬å¸Œæœ›åœ¨é™å™ªçš„è¿‡ç¨‹ä¸­èƒ½å¤Ÿä¿ç•™è¿™äº›è¾¹ç¼˜ï¼Œé¿å… Overblurï¼Œå°±éœ€è¦å¯»æ‰¾åˆ«çš„æ–¹æ³•ã€‚</p><p>åŒè¾¹æ»¤æ³¢æä¾›äº†ä¸€ä¸ªä¸é”™çš„æ€è·¯ï¼šåŒè¾¹æ»¤æ³¢æ ¸çš„æƒé‡ä¸ä»…è€ƒè™‘äº†åƒç´ é—´å‡ ä½•è·ç¦»çš„å·®å¼‚ï¼Œè¿˜è€ƒè™‘äº†å›¾åƒå€¼åŸŸä¸Šçš„å·®å¼‚ï¼š</p><div>$$
w(i, j, k, l) = \exp\left( -\frac{(i - k)^2 + (j - l)^2}{2\sigma_d^2} - \frac{\|I(i, j) - I(k, l)\|^2}{2\sigma_r^2} \right)
$$</div><p>å½“ä¸¤ä¸ªåƒç´ åœ¨å€¼ï¼ˆé¢œè‰²ã€æ·±åº¦ç­‰ï¼‰ä¸Šå·®å¼‚è¿‡å¤§æ—¶ï¼Œé‡‡æ ·åƒç´ å¯¹ä¸­å¿ƒåƒç´ çš„è´¡çŒ®å°±å‡å°‘ï¼Œè¿™æ ·å°±å¯ä»¥ç»´æŒä½è¾¹ç¼˜ä¿¡æ¯ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åŒè¾¹æ»¤æ³¢çš„åŸºç¡€ä¸Šï¼Œä¸ºæ ¸åŠ å…¥æ›´å¤šæ§åˆ¶ä»¥åº”å¯¹å¤šç§å¤æ‚è¾¹ç¼˜æƒ…å†µï¼Œè¿™å°±æ˜¯è”åˆåŒè¾¹æ»¤æ³¢çš„æ€æƒ³ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%208.GAMES202HW5/202506201352009.png#center></p><p>ä½¿ç”¨è”åˆåŒè¾¹æ»¤æ³¢å¯¹å•å¸§å›¾åƒè¿›è¡Œé™å™ªï¼Œä½œä¸šä¸­ç»™å‡ºçš„æ ¸ä¸ºï¼š</p><div>$$
J(\mathbf{i}, \mathbf{j}) = \exp\left( -\frac{\|\mathbf{i} - \mathbf{j}\|^2}{2\sigma_p^2} - \frac{\|\tilde{C}[i] - \tilde{C}[j]\|^2}{2\sigma_c^2} - \frac{D_{\text{normal}}(\mathbf{i}, \mathbf{j})^2}{2\sigma_n^2} - \frac{D_{\text{plane}}(\mathbf{i}, \mathbf{j})^2}{2\sigma_d^2} \right)
$$</div><p>å…¶ä¸­ï¼š</p><ul><li>$\lVert \mathbf{i} - \mathbf{j} \rVert$ï¼šåƒç´ åæ ‡å·®å€¼</li><li>$\lVert \tilde{C}[i] - \tilde{C}[j] \rVert$ï¼šé¢œè‰²å·®å€¼</li><li>$D_{\text{normal}}(\mathbf{i}, \mathbf{j}) = \arccos\left( \text{Normal}[\mathbf{i}] \cdot \text{{Normal}}[\mathbf{j}] \right)$ï¼Œæè¿°é¢æœå‘å·®å¼‚</li><li>$D_{\text{plane}}(\text{i}, \text{j}) = \text{Normal}[\text{i}] \cdot \frac{\text{Position}[\text{j}] - \text{Position}[\text{i}]}{\lVert \text{Position}[\text{j}] - \text{Position}[\text{i}] \rVert}$ï¼Œæè¿°è·ç¦»å·®å¼‚ï¼ˆæ²¿æ³•å‘å˜åŒ–çš„è·ç¦»ï¼‰</li></ul><blockquote><p>ä¸€ç›´æœ‰ç‚¹ç–‘æƒ‘ä¸ºä»€ä¹ˆå¾ˆå¤šä½œä¸šå®ç°éƒ½æ˜¯æŠŠç¬¬ä¸€é¡¹å½“ä½œä¸–ç•Œä½ç½®å·®å¼‚ï¼Œè¯•äº†ä¸€ä¸‹æ•ˆæœä¹Ÿçš„ç¡®å·®ä¸å¤š</p></blockquote><p>å„ä¸ª $\sigma$ ä¸ºæ§åˆ¶ä¸åŒé¡¹çš„å¹³æ»‘ç¨‹åº¦çš„æ ‡å‡†å·®ï¼Œ$\sigma$ è¶Šå¤§è¡¨ç¤ºå¯¹ä¸Šè¿°è·ç¦»å·®å¼‚è¶Šä¸æ•æ„Ÿï¼Œå³æ›´èƒ½å®¹å¿æƒé‡å·®å¼‚ã€‚</p><p>åœ¨ denoise.cpp ä¸­å®Œæˆ <code>Filter</code> å‡½æ•°ï¼ŒæŒ‰ç…§ä¸Šè¿°å…¬å¼å®Œæˆè”åˆåŒè¾¹æ»¤æ³¢é€»è¾‘ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl><span class=n>Buffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span> <span class=n>Denoiser</span><span class=o>::</span><span class=n>Filter</span><span class=p>(</span><span class=k>const</span> <span class=n>FrameInfo</span> <span class=o>&amp;</span><span class=n>frameInfo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=kt>int</span> <span class=n>height</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>.</span><span class=n>m_height</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=kt>int</span> <span class=n>width</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>.</span><span class=n>m_width</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=n>Buffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span> <span class=n>filteredImage</span> <span class=o>=</span> <span class=n>CreateBuffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=kt>int</span> <span class=n>kernelRadius</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=cp>#pragma omp parallel for
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=cp></span>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>y</span> <span class=o>&lt;</span> <span class=n>height</span><span class=p>;</span> <span class=n>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=n>width</span><span class=p>;</span> <span class=n>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>            <span class=c1>// Joint bilateral filter
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>            <span class=c1>// get current pixel vals
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>            <span class=n>Float3</span> <span class=n>color</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>            <span class=n>Float3</span> <span class=n>normal</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_normal</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>            <span class=n>Float3</span> <span class=n>pos</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_position</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=kt>float</span> <span class=n>weight_sum</span> <span class=o>=</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=n>Float3</span> <span class=n>color_sum</span> <span class=o>=</span> <span class=n>Float3</span><span class=p>(</span><span class=mf>0.f</span><span class=p>);</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>            <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=o>-</span><span class=n>kernelRadius</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>kernelRadius</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=o>-</span><span class=n>kernelRadius</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>kernelRadius</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                    <span class=c1>// clamp coordinate
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>                    <span class=kt>int</span> <span class=n>sampleCoord_x</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>i</span><span class=p>),</span><span class=n>width</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span> 
</span></span><span class=line><span class=ln>21</span><span class=cl>                    <span class=kt>int</span> <span class=n>sampleCoord_y</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>j</span><span class=p>),</span><span class=n>height</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                    
</span></span><span class=line><span class=ln>23</span><span class=cl>                    <span class=c1>// sample sampled pixel vals
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>                    <span class=n>Float3</span> <span class=n>sampledColor</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span><span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>                    <span class=n>Float3</span> <span class=n>sampledNormal</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_normal</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span><span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>                    <span class=n>Float3</span> <span class=n>sampledPos</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_position</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span><span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>                    <span class=c1>// calculate weight
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1></span>                    <span class=kt>float</span> <span class=n>weight</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                    <span class=kt>float</span> <span class=n>d_coord2</span> <span class=o>=</span> <span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=o>*</span><span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                    
</span></span><span class=line><span class=ln>32</span><span class=cl>                    <span class=kt>float</span> <span class=n>d_color2</span> <span class=o>=</span> <span class=n>SqrDistance</span><span class=p>(</span><span class=n>color</span><span class=p>,</span><span class=n>sampledColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>                    
</span></span><span class=line><span class=ln>34</span><span class=cl>                    <span class=kt>float</span> <span class=n>cosTheta</span> <span class=o>=</span> <span class=n>Dot</span><span class=p>(</span><span class=n>normal</span><span class=p>,</span><span class=n>sampledNormal</span><span class=p>);</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>                    <span class=kt>float</span> <span class=n>d_normal2</span> <span class=o>=</span> <span class=n>SafeAcos</span><span class=p>(</span><span class=n>cosTheta</span><span class=p>)</span><span class=o>*</span><span class=n>SafeAcos</span><span class=p>(</span><span class=n>cosTheta</span><span class=p>);</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl>                    <span class=kt>float</span> <span class=n>d_plane</span> <span class=o>=</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>                    <span class=kt>float</span> <span class=n>d_pos</span> <span class=o>=</span> <span class=n>Distance</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>sampledPos</span><span class=p>);</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>d_pos</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>                        <span class=n>d_plane</span> <span class=o>=</span> <span class=n>Dot</span><span class=p>(</span><span class=n>normal</span><span class=p>,</span><span class=n>Normalize</span><span class=p>(</span><span class=n>sampledPos</span><span class=o>-</span><span class=n>pos</span><span class=p>));</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>                    <span class=kt>float</span> <span class=n>d_plane2</span> <span class=o>=</span> <span class=n>d_plane</span><span class=o>*</span><span class=n>d_plane</span><span class=p>;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>
</span></span><span class=line><span class=ln>43</span><span class=cl>                    <span class=kt>float</span> <span class=n>w_coord</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_coord2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaCoord</span><span class=o>*</span><span class=n>m_sigmaCoord</span><span class=p>);</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>                    <span class=kt>float</span> <span class=n>w_color</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_color2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaColor</span><span class=o>*</span><span class=n>m_sigmaColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>                    <span class=kt>float</span> <span class=n>w_normal</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_normal2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaNormal</span><span class=o>*</span><span class=n>m_sigmaNormal</span><span class=p>);</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>                    <span class=kt>float</span> <span class=n>w_plane</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_plane2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaPlane</span><span class=o>*</span><span class=n>m_sigmaPlane</span><span class=p>);</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>
</span></span><span class=line><span class=ln>48</span><span class=cl>                    <span class=n>weight</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>w_coord</span><span class=o>+</span><span class=n>w_color</span><span class=o>+</span><span class=n>w_normal</span><span class=o>+</span><span class=n>w_plane</span><span class=p>);</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>                    <span class=c1>// accumulate weight and color buffer
</span></span></span><span class=line><span class=ln>50</span><span class=cl><span class=c1></span>                    <span class=n>weight_sum</span> <span class=o>+=</span> <span class=n>weight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>                    <span class=n>color_sum</span> <span class=o>+=</span> <span class=n>sampledColor</span> <span class=o>*</span> <span class=n>weight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>            <span class=c1>// protect 0 weight
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=c1></span>            <span class=k>if</span><span class=p>(</span><span class=n>weight_sum</span> <span class=o>==</span> <span class=mf>0.0f</span><span class=p>){</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>                <span class=n>filteredImage</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>            <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>                <span class=n>filteredImage</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>color_sum</span> <span class=o>/</span> <span class=n>weight_sum</span><span class=p>;</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>    <span class=k>return</span> <span class=n>filteredImage</span><span class=p>;</span>
</span></span><span class=line><span class=ln>64</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img alt=é™å™ªå‰ loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%208.GAMES202HW5/202506201504200.png#center></p><p><img alt=é™å™ªå loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%208.GAMES202HW5/202506201506541.png#center></p><hr><h2 id=0x03-åæŠ•å½±-reprojection>0x03 åæŠ•å½± Reprojection<a hidden class=anchor aria-hidden=true href=#0x03-åæŠ•å½±-reprojection>#</a></h2><p>åæŠ•å½±åˆ©ç”¨å½“å‰å¸§çš„ä¿¡æ¯æ‰¾åˆ°ä¸Šä¸€å¸§çš„å¯¹åº”åƒç´ ä½ç½®ï¼Œé€šè¿‡åæŠ•å½±å¯ä»¥åœ¨æ—¶é—´ä¸Šå¤ç”¨å·²ç»æ»¤æ³¢çš„ä¸Šä¸€å¸§ä¿¡æ¯ã€‚</p><p>å·²çŸ¥å½“å‰å¸§çš„åƒç´ åæ ‡ï¼Œå¯ä»¥åœ¨ GBuffer ä¸Šè·å–ä¸–ç•Œä½ç½®å’Œå„ç±»å˜æ¢çŸ©é˜µï¼Œä½¿ç”¨ä¸‹å¼å³å¯é€šè¿‡åƒç´ ä¸–ç•Œä½ç½®æ‰¾åˆ°ä¸Šä¸€å¸§è¯¥åƒç´ çš„å±å¹•åæ ‡ï¼š</p><div>$$
\text{Screen}_{i-1} = P_{i-1} V_{i-1} M_{i-1} M_i^{-1} \, \text{World}_i
$$</div><p>æŠ•å½±åˆ°å±å¹•åæ ‡ä¸‹ä¼šå­˜åœ¨ä¸€äº›å±å¹•ç©ºé—´å›ºæœ‰çš„é—®é¢˜ï¼Œå¯¼è‡´åæŠ•å½±åçš„åƒç´ ä¸åˆæ³•ï¼Œè‹¥å¼ºè¡Œå¤ç”¨ä¼šå¯¼è‡´ lagging ï¼Œå¯¹äºè¿™äº›æƒ…å†µæˆ‘ä»¬è¦æ‰‹åŠ¨è¿›è¡Œåˆ¤æ–­ï¼š</p><ol><li>åæŠ•å½±åçš„åƒç´ åœ¨å±å¹•å¤–ï¼Œå³å½“å‰å¸§åƒç´ å¯¹åº”æ–°è¿›å…¥å±å¹•çš„ç‰©ä½“</li><li>åæŠ•å½±åçš„åƒç´ å’Œå½“å‰å¸§åƒç´ å¯¹åº”ç‰©ä½“çš„ id ä¸åŒ</li></ol><p>ç¬¬ä¸€ç§æƒ…å†µå¯ä»¥é€šè¿‡åˆ¤æ–­åæŠ•å½±åçš„åƒç´ åæ ‡æ˜¯å¦åˆæ³•å±å¹•èŒƒå›´å†…ï¼ˆ$[0,w-1],[0,h-1]$ï¼‰ï¼›ç¬¬äºŒç§æƒ…å†µå¯ä»¥é€šè¿‡åˆ¤æ–­ GBuffer Id æ˜¯å¦ç›¸ç­‰ã€‚ä»…å¯¹ä¸Šè¿°åˆ¤æ–­ååˆæ³•çš„åƒç´ è¿›è¡Œæ—¶é—´ç´¯ç§¯ï¼Œæ›´æ–° <code>m_valid</code> å’Œ <code>m_misc</code>ã€‚</p><p>æŒ‰ç…§ä¸Šè¿°æ€è·¯å®Œæˆ <code>Reprojection</code> å‡½æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl><span class=kt>void</span> <span class=n>Denoiser</span><span class=o>::</span><span class=n>Reprojection</span><span class=p>(</span><span class=k>const</span> <span class=n>FrameInfo</span> <span class=o>&amp;</span><span class=n>frameInfo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=kt>int</span> <span class=n>height</span> <span class=o>=</span> <span class=n>m_accColor</span><span class=p>.</span><span class=n>m_height</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=kt>int</span> <span class=n>width</span> <span class=o>=</span> <span class=n>m_accColor</span><span class=p>.</span><span class=n>m_width</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=n>Matrix4x4</span> <span class=n>preWorldToScreen</span> <span class=o>=</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=n>m_preFrameInfo</span><span class=p>.</span><span class=n>m_matrix</span><span class=p>[</span><span class=n>m_preFrameInfo</span><span class=p>.</span><span class=n>m_matrix</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>Matrix4x4</span> <span class=n>preWorldToCamera</span> <span class=o>=</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=n>m_preFrameInfo</span><span class=p>.</span><span class=n>m_matrix</span><span class=p>[</span><span class=n>m_preFrameInfo</span><span class=p>.</span><span class=n>m_matrix</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=cp>#pragma omp parallel for
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=cp></span>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>y</span> <span class=o>&lt;</span> <span class=n>height</span><span class=p>;</span> <span class=n>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=n>width</span><span class=p>;</span> <span class=n>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>            <span class=c1>// Reproject
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>            <span class=n>m_valid</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>            <span class=n>m_misc</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>Float3</span><span class=p>(</span><span class=mf>0.f</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=kt>float</span> <span class=n>id</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_id</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=c1>// skip ivalid id
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>            <span class=k>if</span><span class=p>(</span><span class=n>id</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>            <span class=n>Float3</span> <span class=n>pos</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_position</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>            <span class=n>Matrix4x4</span> <span class=n>WorldToLocal</span> <span class=o>=</span> <span class=n>Inverse</span><span class=p>(</span><span class=n>frameInfo</span><span class=p>.</span><span class=n>m_matrix</span><span class=p>[</span><span class=n>id</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>            <span class=n>Matrix4x4</span> <span class=n>preLocalToWorld</span> <span class=o>=</span> <span class=n>m_preFrameInfo</span><span class=p>.</span><span class=n>m_matrix</span><span class=p>[</span><span class=n>id</span><span class=p>];</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>            <span class=c1>// P_{i-1}V_{i-1}M_{-1}M_{i}^{-1}
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>            <span class=n>Matrix4x4</span> <span class=n>ReprojectionMatrix</span> <span class=o>=</span> <span class=n>preWorldToScreen</span><span class=o>*</span><span class=n>preLocalToWorld</span><span class=o>*</span><span class=n>WorldToLocal</span><span class=p>;</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>            <span class=n>Float3</span> <span class=n>prePosScreen</span> <span class=o>=</span> <span class=n>ReprojectionMatrix</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>Float3</span><span class=o>::</span><span class=n>EType</span><span class=o>::</span><span class=n>Point</span><span class=p>);</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>            <span class=kt>float</span> <span class=n>pre_x</span> <span class=o>=</span> <span class=n>prePosScreen</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>            <span class=kt>float</span> <span class=n>pre_y</span> <span class=o>=</span> <span class=n>prePosScreen</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>            <span class=c1>// is in viewport
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1></span>            <span class=k>if</span><span class=p>(</span><span class=n>pre_x</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=n>pre_x</span><span class=o>&gt;</span><span class=n>width</span><span class=o>-</span><span class=mi>1</span> <span class=o>||</span> <span class=n>pre_y</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=n>pre_y</span><span class=o>&gt;</span><span class=n>height</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>                <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>            <span class=kt>float</span> <span class=n>preId</span> <span class=o>=</span> <span class=n>m_preFrameInfo</span><span class=p>.</span><span class=n>m_id</span><span class=p>(</span><span class=n>pre_x</span><span class=p>,</span> <span class=n>pre_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>            
</span></span><span class=line><span class=ln>36</span><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>preId</span> <span class=o>==</span> <span class=n>id</span><span class=p>){</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>                <span class=n>m_valid</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>                <span class=n>m_misc</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>m_accColor</span><span class=p>(</span><span class=n>pre_x</span><span class=p>,</span> <span class=n>pre_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>m_misc</span><span class=p>,</span> <span class=n>m_accColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=0x04-æ—¶é—´ç´¯ç§¯-temporal-accumulation>0x04 æ—¶é—´ç´¯ç§¯ Temporal Accumulation<a hidden class=anchor aria-hidden=true href=#0x04-æ—¶é—´ç´¯ç§¯-temporal-accumulation>#</a></h2><p>åæŠ•å½±å°†å½“å‰å¸§æ‰€æœ‰åƒç´ å¯¹åº”çš„ä¸Šä¸€å¸§åæŠ•å½±çš„åƒç´ é¢œè‰²ï¼ˆè‹¥åˆæ³•ï¼‰å­˜å…¥ <code>m_accColor</code>ï¼Œä»¥ä¾¿æ—¶é—´ç´¯ç§¯å¤ç”¨ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%208.GAMES202HW5/202506201530314.png#center></p><p>å¦‚æœç›´æ¥ä½¿ç”¨ä¸Šä¸€å¸§çš„ä¿¡æ¯ï¼Œå½“å…¶é¢œè‰²ä¸å½“å‰é¢œè‰²å·®å¼‚è¿‡å¤§æ—¶å¯èƒ½å¯¼è‡´ ghostingï¼Œä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µï¼Œéœ€è¦å¯¹ä¸Šä¸€å¸§ä¿¡æ¯å’Œå½“å‰å¸§ä¿¡æ¯åšé’³åˆ¶ï¼Œå³ï¼š</p><div>$$
C^{(i-1)}=\text{clamp}(C^{(i-1)}, \mu - k\sigma, \mu + k\sigma)
$$</div><p>å…¶ä¸­ï¼Œ$\mu,\sigma$ åˆ†åˆ«ä¸ºå½“å‰å¸§åƒç´ æŸä¸€é‚»åŸŸçš„å‡å€¼å’Œæ–¹å·®ã€‚é’³åˆ¶åå³å¯ä½¿ç”¨ä¸‹å¼æ··åˆé¢œè‰²ï¼š</p><div>$$
C^{(i)} = \alpha \bar{C}^{(i)} + (1 - \alpha) C^{(i-1)}
$$</div><p>å…¶ä¸­ï¼Œ$\bar{C}^{(i)}$ ä¸ºå½“å‰å¸§å·²é™å™ªåƒç´ ä¿¡æ¯ï¼Œ$C^{(i-1)}$ ä¸ºä¸Šä¸€å¸§å·²é™å™ªåæŠ•å½±åƒç´ ä¿¡æ¯ï¼Œ$\alpha$ é€šå¸¸å– 0.2ï¼Œè¡¨ç¤ºæ›´å¤šåœ°ä½¿ç”¨ä¸Šä¸€å¸§ä¿¡æ¯ã€‚</p><p>åœ¨ denoise.cpp ä¸­å®Œæˆ <code>TemporalAccumulation</code> å‡½æ•°ï¼Œé€šè¿‡éå†å½“å‰åƒç´ çš„ 7Ã—7 é‚»åŸŸè®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œå¹¶å°†ä¸Šä¸€å¸§ä¿¡æ¯é™åˆ¶åˆ° $(\mu-k\sigma,\mu+k\sigma)$ èŒƒå›´å†…ã€‚ä¸ºäº†é¿å…æ±‚æ–¹å·®å†åšä¸€éå¾ªç¯ï¼Œå¯ä»¥åˆ©ç”¨æ–¹å·®çš„å¦ä¸€ä¸ªè®¡ç®—å…¬å¼ï¼š</p><div>$$
Var(X)=E(X^{2})-E(X)^{2}
$$</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl><span class=kt>void</span> <span class=n>Denoiser</span><span class=o>::</span><span class=n>TemporalAccumulation</span><span class=p>(</span><span class=k>const</span> <span class=n>Buffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span> <span class=o>&amp;</span><span class=n>curFilteredColor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=kt>int</span> <span class=n>height</span> <span class=o>=</span> <span class=n>m_accColor</span><span class=p>.</span><span class=n>m_height</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=kt>int</span> <span class=n>width</span> <span class=o>=</span> <span class=n>m_accColor</span><span class=p>.</span><span class=n>m_width</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=kt>int</span> <span class=n>kernelRadius</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=kt>int</span> <span class=n>kernelSize</span> <span class=o>=</span> <span class=mi>2</span><span class=o>*</span><span class=n>kernelRadius</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kt>int</span> <span class=n>sampleNum</span> <span class=o>=</span> <span class=n>kernelSize</span> <span class=o>*</span> <span class=n>kernelSize</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=cp>#pragma omp parallel for
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=cp></span>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>y</span> <span class=o>&lt;</span> <span class=n>height</span><span class=p>;</span> <span class=n>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=n>width</span><span class=p>;</span> <span class=n>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=c1>// Temporal clamp
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>            <span class=kt>float</span> <span class=n>alpha</span> <span class=o>=</span> <span class=mf>1.0f</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>            <span class=c1>// previous frame color
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>            <span class=n>Float3</span> <span class=n>color</span> <span class=o>=</span> <span class=n>m_accColor</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>m_valid</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)){</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>                <span class=n>alpha</span> <span class=o>=</span> <span class=n>m_alpha</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>                <span class=c1>// calculate mu and sigma in 7*7 block
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>                <span class=n>Float3</span> <span class=n>mu</span><span class=p>,</span> <span class=n>mu2</span> <span class=o>=</span> <span class=n>Float3</span><span class=p>(</span><span class=mf>0.f</span><span class=p>);</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                <span class=n>Float3</span> <span class=n>sigma</span> <span class=o>=</span> <span class=n>Float3</span><span class=p>(</span><span class=mf>0.f</span><span class=p>);</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=o>-</span><span class=n>kernelRadius</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>kernelRadius</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>                    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=o>-</span><span class=n>kernelRadius</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>kernelRadius</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                        <span class=kt>int</span> <span class=n>sampleCoord_x</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>i</span><span class=p>),</span><span class=n>width</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span> 
</span></span><span class=line><span class=ln>23</span><span class=cl>                        <span class=kt>int</span> <span class=n>sampleCoord_y</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>j</span><span class=p>),</span><span class=n>height</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>                        <span class=n>Float3</span> <span class=n>curSampledColor</span> <span class=o>=</span> <span class=n>curFilteredColor</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span> <span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>                        <span class=n>mu</span><span class=o>+=</span><span class=n>curSampledColor</span><span class=p>;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>                        <span class=n>mu2</span><span class=o>+=</span><span class=n>Sqr</span><span class=p>(</span><span class=n>curSampledColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                <span class=n>mu</span> <span class=o>/=</span> <span class=n>sampleNum</span><span class=p>;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                <span class=n>mu2</span> <span class=o>/=</span> <span class=n>sampleNum</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>                <span class=n>sigma</span> <span class=o>=</span> <span class=n>SafeSqrt</span><span class=p>(</span><span class=n>mu2</span> <span class=o>-</span> <span class=n>mu</span><span class=o>*</span><span class=n>mu</span><span class=p>);</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>                <span class=n>color</span> <span class=o>=</span> <span class=n>Clamp</span><span class=p>(</span><span class=n>color</span><span class=p>,</span> <span class=n>mu</span><span class=o>-</span><span class=n>sigma</span><span class=o>*</span><span class=n>m_colorBoxK</span><span class=p>,</span> <span class=n>mu</span><span class=o>+</span><span class=n>sigma</span><span class=o>*</span><span class=n>m_colorBoxK</span><span class=p>);</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl>            <span class=c1>// Exponential moving average
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=c1></span>            <span class=n>m_misc</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>Lerp</span><span class=p>(</span><span class=n>color</span><span class=p>,</span> <span class=n>curFilteredColor</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=n>alpha</span><span class=p>);</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>m_misc</span><span class=p>,</span> <span class=n>m_accColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img alt=æ—¶é—´ç´¯ç§¯ç»“æœ loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%208.GAMES202HW5/202506201607272.gif#center></p><hr><h2 id=0x05-a-torus-wavelet-åŠ é€Ÿ>0x05 A-Torus Wavelet åŠ é€Ÿ<a hidden class=anchor aria-hidden=true href=#0x05-a-torus-wavelet-åŠ é€Ÿ>#</a></h2><p>A-Torus Waveletï¼Œå³è¿›è¡Œå¤šæ¬¡æ»¤æ³¢ï¼Œæ¯æ¬¡ä½¿ç”¨é€æ¸å¢åŠ çš„æ»¤æ³¢æ ¸å°ºå¯¸å’Œæ­¥é•¿ï¼Œä»¥ä¿è¯æ¯æ¬¡æ»¤æ³¢çš„é‡‡æ ·ç‚¹æ•°ä¸å˜ã€‚æ€»å…±è¿›è¡Œ 5 æ¬¡æ»¤æ³¢ï¼Œæ¯æ¬¡æ»¤æ³¢è¾“å…¥å›¾åƒä¸ºä¸Šä¸€æ¬¡æ»¤æ³¢ç»“æœï¼Œç¬¬ $i$ æ¬¡æ»¤æ³¢çš„æ­¥é•¿ä¸º $2^{i}$ï¼Œæ ¸å°ºå¯¸ä¸º $2^{i+2}+1$ ã€‚é€šè¿‡ A-Torus Wavelet çš„åŠ é€Ÿï¼Œå¯ä»¥å°†åŸæœ¬ $64^{2}$ çš„é‡‡æ ·æ•°å‡å°‘ä¸º $125$ï¼Œå¤§å¹…æå‡å•å¸§é™å™ªé€Ÿåº¦ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-issues/Issue%2012.SPHFluidSimulation/202506161527798.png#center></p><p>åœ¨ Denoise ç±»ä¸­æ–°å¢ä¸€ä¸ª <code>ATWFilter</code> å‡½æ•°ï¼Œå®ç°ç”± A-Trous Wavelet åŠ é€Ÿçš„æ»¤æ³¢ï¼Œåœ¨åŸæœ¬çš„ä¸¤å±‚ for å¾ªç¯å¤–éƒ¨å†åµŒå¥—ä¸€å±‚ forï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl><span class=n>Buffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span> <span class=n>Denoiser</span><span class=o>::</span><span class=n>ATWFilter</span><span class=p>(</span><span class=k>const</span> <span class=n>FrameInfo</span> <span class=o>&amp;</span><span class=n>frameInfo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=kt>int</span> <span class=n>height</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>.</span><span class=n>m_height</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=kt>int</span> <span class=n>width</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>.</span><span class=n>m_width</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=n>Buffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span> <span class=n>filteredImage</span> <span class=o>=</span> <span class=n>CreateBuffer2D</span><span class=o>&lt;</span><span class=n>Float3</span><span class=o>&gt;</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=kt>int</span> <span class=n>passes</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=cp>#pragma omp parallel for
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=cp></span>    <span class=c1>// Accelerated by A-Trous Wavelet
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>y</span> <span class=o>&lt;</span> <span class=n>height</span><span class=p>;</span> <span class=n>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=n>width</span><span class=p>;</span> <span class=n>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=c1>// Joint bilateral filter
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>            <span class=c1>// get current pixel vals
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>            <span class=n>Float3</span> <span class=n>color</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>            <span class=n>Float3</span> <span class=n>normal</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_normal</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>            <span class=n>Float3</span> <span class=n>pos</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_position</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=kt>float</span> <span class=n>weight_sum</span> <span class=o>=</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>            <span class=n>Float3</span> <span class=n>color_sum</span> <span class=o>=</span> <span class=n>Float3</span><span class=p>(</span><span class=mf>0.f</span><span class=p>);</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>            <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>pass</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>pass</span> <span class=o>&lt;</span> <span class=n>passes</span><span class=p>;</span> <span class=n>pass</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                <span class=kt>int</span> <span class=n>stride</span> <span class=o>=</span> <span class=n>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>pass</span><span class=p>);</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>                <span class=kt>int</span> <span class=n>kernelRadius</span> <span class=o>=</span> <span class=n>stride</span> <span class=o>*</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=o>-</span><span class=n>kernelRadius</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>kernelRadius</span><span class=p>;</span> <span class=n>i</span><span class=o>+=</span><span class=n>stride</span><span class=p>){</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>                    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=o>-</span><span class=n>kernelRadius</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>kernelRadius</span><span class=p>;</span> <span class=n>j</span><span class=o>+=</span><span class=n>stride</span><span class=p>){</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>                        <span class=c1>// clamp coordinate
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>                        <span class=kt>int</span> <span class=n>sampleCoord_x</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>i</span><span class=p>),</span><span class=n>width</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span> 
</span></span><span class=line><span class=ln>26</span><span class=cl>                        <span class=kt>int</span> <span class=n>sampleCoord_y</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>j</span><span class=p>),</span><span class=n>height</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>                        
</span></span><span class=line><span class=ln>28</span><span class=cl>                        <span class=c1>// sample sampled pixel vals
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1></span>                        <span class=n>Float3</span> <span class=n>sampledColor</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_beauty</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span><span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                        <span class=n>Float3</span> <span class=n>sampledNormal</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_normal</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span><span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                        <span class=n>Float3</span> <span class=n>sampledPos</span> <span class=o>=</span> <span class=n>frameInfo</span><span class=p>.</span><span class=n>m_position</span><span class=p>(</span><span class=n>sampleCoord_x</span><span class=p>,</span><span class=n>sampleCoord_y</span><span class=p>);</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>                        <span class=c1>// calculate weight
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1></span>                        <span class=kt>float</span> <span class=n>weight</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>                        <span class=kt>float</span> <span class=n>d_coord2</span> <span class=o>=</span> <span class=n>i</span><span class=o>*</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=o>*</span><span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>                        
</span></span><span class=line><span class=ln>37</span><span class=cl>                        <span class=kt>float</span> <span class=n>d_color2</span> <span class=o>=</span> <span class=n>SqrDistance</span><span class=p>(</span><span class=n>color</span><span class=p>,</span><span class=n>sampledColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>                        
</span></span><span class=line><span class=ln>39</span><span class=cl>                        <span class=kt>float</span> <span class=n>cosTheta</span> <span class=o>=</span> <span class=n>Dot</span><span class=p>(</span><span class=n>normal</span><span class=p>,</span><span class=n>sampledNormal</span><span class=p>);</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>                        <span class=kt>float</span> <span class=n>d_normal2</span> <span class=o>=</span> <span class=n>SafeAcos</span><span class=p>(</span><span class=n>cosTheta</span><span class=p>)</span><span class=o>*</span><span class=n>SafeAcos</span><span class=p>(</span><span class=n>cosTheta</span><span class=p>);</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>
</span></span><span class=line><span class=ln>42</span><span class=cl>                        <span class=kt>float</span> <span class=n>d_plane</span> <span class=o>=</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>                        <span class=kt>float</span> <span class=n>d_pos</span> <span class=o>=</span> <span class=n>Distance</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>sampledPos</span><span class=p>);</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>d_pos</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>                            <span class=n>d_plane</span> <span class=o>=</span> <span class=n>Dot</span><span class=p>(</span><span class=n>normal</span><span class=p>,</span><span class=n>Normalize</span><span class=p>(</span><span class=n>sampledPos</span><span class=o>-</span><span class=n>pos</span><span class=p>));</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>                        <span class=kt>float</span> <span class=n>d_plane2</span> <span class=o>=</span> <span class=n>d_plane</span><span class=o>*</span><span class=n>d_plane</span><span class=p>;</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>
</span></span><span class=line><span class=ln>48</span><span class=cl>                        <span class=kt>float</span> <span class=n>w_coord</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_coord2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaCoord</span><span class=o>*</span><span class=n>m_sigmaCoord</span><span class=p>);</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>                        <span class=kt>float</span> <span class=n>w_color</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_color2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaColor</span><span class=o>*</span><span class=n>m_sigmaColor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>                        <span class=kt>float</span> <span class=n>w_normal</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_normal2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaNormal</span><span class=o>*</span><span class=n>m_sigmaNormal</span><span class=p>);</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>                        <span class=kt>float</span> <span class=n>w_plane</span> <span class=o>=</span> <span class=o>-</span> <span class=n>d_plane2</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>m_sigmaPlane</span><span class=o>*</span><span class=n>m_sigmaPlane</span><span class=p>);</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>
</span></span><span class=line><span class=ln>53</span><span class=cl>                        <span class=n>weight</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>w_coord</span><span class=o>+</span><span class=n>w_color</span><span class=o>+</span><span class=n>w_normal</span><span class=o>+</span><span class=n>w_plane</span><span class=p>);</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>                        <span class=c1>// accumulate weight and color buffer
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=c1></span>                        <span class=n>weight_sum</span> <span class=o>+=</span> <span class=n>weight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>                        <span class=n>color_sum</span> <span class=o>+=</span> <span class=n>sampledColor</span> <span class=o>*</span> <span class=n>weight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>                <span class=c1>// protect 0 weight
</span></span></span><span class=line><span class=ln>60</span><span class=cl><span class=c1></span>                <span class=k>if</span><span class=p>(</span><span class=n>weight_sum</span> <span class=o>==</span> <span class=mf>0.0f</span><span class=p>){</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>                    <span class=n>filteredImage</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>                <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>                    <span class=n>filteredImage</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>=</span> <span class=n>color_sum</span> <span class=o>/</span> <span class=n>weight_sum</span><span class=p>;</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>69</span><span class=cl>    <span class=k>return</span> <span class=n>filteredImage</span><span class=p>;</span>
</span></span><span class=line><span class=ln>70</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img alt="A-Torus Wavelet ç»“æœ" loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/Assignments/Assignment%208.GAMES202HW5/202506201611045.gif#center></p><p>åŠ é€Ÿæ•ˆæœä¹Ÿæ˜¯ååˆ†æ˜æ˜¾çš„ï¼Œ<code>ATWFilter</code> æ¯” <code>Filter</code> å‡ ä¹å¿«äº†ä¸¤åˆ†é’Ÿï¼Œä½†æ˜¯å°±å•å¸§é™å™ªè´¨é‡æ¥è¯´æ˜¯ä¸å¦‚ <code>Filter</code> çš„ã€‚</p><hr><h2 id=0x06-afterwords>0x06 Afterwords<a hidden class=anchor aria-hidden=true href=#0x06-afterwords>#</a></h2><p>æ‰€ä»¥é—«å¤§çš„ç¦»çº¿æ¸²æŸ“è¯¾ä»€ä¹ˆæ—¶å€™å¼€ :p</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://congyuxiaoyoudao.github.io/tags/games202/>GAMES202</a></li><li><a href=https://congyuxiaoyoudao.github.io/tags/rtrt/>RTRT</a></li></ul><nav class=paginav><a class=prev href=https://congyuxiaoyoudao.github.io/posts/interludes/webgpu-from-scratch/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Interlude 3. WebGPU From Scratch</span>
</a><a class=next href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-4/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Assignment 7. GAMES202 Homework 4</span></a></nav></footer><div id=tw-comment></div><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="light"?"light":"noborder_dark",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"congyuxiaoyoudao/congyuxiaoyoudao.github.io","data-repo-id":"","data-category":"Announcements","data-category-id":"","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"","data-emit-metadata":"","data-input-position":"","data-theme":getStoredTheme(),"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous"},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#tw-comment").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://congyuxiaoyoudao.github.io/>The Only Problem's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>