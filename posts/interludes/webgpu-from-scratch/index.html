<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Interlude 3. WebGPU From Scratch | The Only Problem's Blog</title><meta name=keywords content="WebGPU"><meta name=description content="
ä»å¯¼å¸ˆé‚£é‡Œå¬è¯´äº† WebGPUï¼Œåšäº†ç‚¹è°ƒæŸ¥å‘ç°è¿™ä¸ª API è¿˜æŒºæ–°çš„ï¼Œæ­£å¥½ä¹‹å‰åªé›¶é›¶ç¢ç¢å­¦äº†ä¸€ç‚¹ OpenGLï¼Œç›¸æ¯”äºä¸é€‚åˆäººç±»å­¦çš„ Vulkanï¼Œè¿˜æ˜¯ WebGPU æ˜¾å¾—å‹å¥½ä¸€ç‚¹ã€‚

ğŸš© 0x00 To begin with
è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

 ä»€ä¹ˆæ˜¯ WebGPU
 é…ç½® WebGPU å¼€å‘ç¯å¢ƒ
 ç¬¬ä¸€ä¸ª WebGPU é¡¹ç›®ï¼šHelloTriangleï¼

For referenceğŸ‘‡ï¼š

ğŸª 







  
  WebGPU Samples


ğŸ“– 







  
  WebGPU API Spec


ğŸ“– 







  
  WebGPU Shading Language


ğŸ“º 







  
  WebGPUå°ç™½å…¥é—¨ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é›¶åŸºç¡€åˆ›å»ºç¬¬ä¸€ä¸ªWebGPUé¡¹ç›®ï¼


ğŸ“– 







  
  æ‚¨çš„ç¬¬ä¸€ä¸ª WebGPU åº”ç”¨


ğŸ“– 







  
  lil-gui 0.20.0




0x01 è®¤è¯† WebGPU
WebGPU æ˜¯ä¸€ä¸ªç”± W3C GPU å·¥ä½œç»„åˆ¶å®šçš„æ–°çš„ç°ä»£å›¾å½¢ APIï¼Œç”¨äºåœ¨ Web åº”ç”¨ä¸­è®¿é—® GPU åŠŸèƒ½ã€‚
åœ¨ WebGPU å‡ºç°ä¹‹å‰ï¼ŒWeb ç«¯çš„å›¾å½¢ç¼–ç¨‹åº”ç”¨ä¸»è¦é‡‡ç”¨ WebGL å’Œ WebGL 2ï¼Œè™½ç„¶å®ƒä»¬æœ‰ç€è·¨å¹³å°èƒ½åŠ›å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä½†æ¶æ„è¿‡äºå¤è€ï¼Œæœ€æ–°çš„ WebGL 2 åªæ˜¯å°è£…äº† 2009 å¹´ OpenGL 3.2 çš„å®ç°ã€‚Khronos ä¹ŸæŒ‡å‡º WebGL åç»­æ›´æ–°ä¸­ä¸å†å¼•å…¥ç°ä»£ GPU çš„æ–°ç‰¹æ€§ã€‚"><meta name=author content="The Only Problem"><link rel=canonical href=https://congyuxiaoyoudao.github.io/posts/interludes/webgpu-from-scratch/><link crossorigin=anonymous href=/assets/css/stylesheet.452758010f0b7fc9ad7fa528ffdfdd8eb9e830816fb8c8119f16f39583297db8.css integrity="sha256-RSdYAQ8Lf8mtf6Uo/9/djrnoMIFvuMgRnxbzlYMpfbg=" rel="preload stylesheet" as=style><link rel=icon href=https://congyuxiaoyoudao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://congyuxiaoyoudao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://congyuxiaoyoudao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://congyuxiaoyoudao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://congyuxiaoyoudao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://congyuxiaoyoudao.github.io/posts/interludes/webgpu-from-scratch/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity=sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity=sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk crossorigin=anonymous onload='window.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\$$",right:"\\\\$$",display:!1},{left:"\\$$",right:"\\\\$$",display:!0}]})})'></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css><meta property="og:url" content="https://congyuxiaoyoudao.github.io/posts/interludes/webgpu-from-scratch/"><meta property="og:site_name" content="The Only Problem's Blog"><meta property="og:title" content="Interlude 3. WebGPU From Scratch"><meta property="og:description" content=" ä»å¯¼å¸ˆé‚£é‡Œå¬è¯´äº† WebGPUï¼Œåšäº†ç‚¹è°ƒæŸ¥å‘ç°è¿™ä¸ª API è¿˜æŒºæ–°çš„ï¼Œæ­£å¥½ä¹‹å‰åªé›¶é›¶ç¢ç¢å­¦äº†ä¸€ç‚¹ OpenGLï¼Œç›¸æ¯”äºä¸é€‚åˆäººç±»å­¦çš„ Vulkanï¼Œè¿˜æ˜¯ WebGPU æ˜¾å¾—å‹å¥½ä¸€ç‚¹ã€‚
ğŸš© 0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
ä»€ä¹ˆæ˜¯ WebGPU é…ç½® WebGPU å¼€å‘ç¯å¢ƒ ç¬¬ä¸€ä¸ª WebGPU é¡¹ç›®ï¼šHelloTriangleï¼ For referenceğŸ‘‡ï¼š
ğŸª WebGPU Samples ğŸ“– WebGPU API Spec ğŸ“– WebGPU Shading Language ğŸ“º WebGPUå°ç™½å…¥é—¨ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é›¶åŸºç¡€åˆ›å»ºç¬¬ä¸€ä¸ªWebGPUé¡¹ç›®ï¼ ğŸ“– æ‚¨çš„ç¬¬ä¸€ä¸ª WebGPU åº”ç”¨ ğŸ“– lil-gui 0.20.0 0x01 è®¤è¯† WebGPU WebGPU æ˜¯ä¸€ä¸ªç”± W3C GPU å·¥ä½œç»„åˆ¶å®šçš„æ–°çš„ç°ä»£å›¾å½¢ APIï¼Œç”¨äºåœ¨ Web åº”ç”¨ä¸­è®¿é—® GPU åŠŸèƒ½ã€‚
åœ¨ WebGPU å‡ºç°ä¹‹å‰ï¼ŒWeb ç«¯çš„å›¾å½¢ç¼–ç¨‹åº”ç”¨ä¸»è¦é‡‡ç”¨ WebGL å’Œ WebGL 2ï¼Œè™½ç„¶å®ƒä»¬æœ‰ç€è·¨å¹³å°èƒ½åŠ›å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä½†æ¶æ„è¿‡äºå¤è€ï¼Œæœ€æ–°çš„ WebGL 2 åªæ˜¯å°è£…äº† 2009 å¹´ OpenGL 3.2 çš„å®ç°ã€‚Khronos ä¹ŸæŒ‡å‡º WebGL åç»­æ›´æ–°ä¸­ä¸å†å¼•å…¥ç°ä»£ GPU çš„æ–°ç‰¹æ€§ã€‚"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-30T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-30T00:00:00+00:00"><meta property="article:tag" content="WebGPU"><meta name=twitter:card content="summary"><meta name=twitter:title content="Interlude 3. WebGPU From Scratch"><meta name=twitter:description content="
ä»å¯¼å¸ˆé‚£é‡Œå¬è¯´äº† WebGPUï¼Œåšäº†ç‚¹è°ƒæŸ¥å‘ç°è¿™ä¸ª API è¿˜æŒºæ–°çš„ï¼Œæ­£å¥½ä¹‹å‰åªé›¶é›¶ç¢ç¢å­¦äº†ä¸€ç‚¹ OpenGLï¼Œç›¸æ¯”äºä¸é€‚åˆäººç±»å­¦çš„ Vulkanï¼Œè¿˜æ˜¯ WebGPU æ˜¾å¾—å‹å¥½ä¸€ç‚¹ã€‚

ğŸš© 0x00 To begin with
è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

 ä»€ä¹ˆæ˜¯ WebGPU
 é…ç½® WebGPU å¼€å‘ç¯å¢ƒ
 ç¬¬ä¸€ä¸ª WebGPU é¡¹ç›®ï¼šHelloTriangleï¼

For referenceğŸ‘‡ï¼š

ğŸª 







  
  WebGPU Samples


ğŸ“– 







  
  WebGPU API Spec


ğŸ“– 







  
  WebGPU Shading Language


ğŸ“º 







  
  WebGPUå°ç™½å…¥é—¨ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é›¶åŸºç¡€åˆ›å»ºç¬¬ä¸€ä¸ªWebGPUé¡¹ç›®ï¼


ğŸ“– 







  
  æ‚¨çš„ç¬¬ä¸€ä¸ª WebGPU åº”ç”¨


ğŸ“– 







  
  lil-gui 0.20.0




0x01 è®¤è¯† WebGPU
WebGPU æ˜¯ä¸€ä¸ªç”± W3C GPU å·¥ä½œç»„åˆ¶å®šçš„æ–°çš„ç°ä»£å›¾å½¢ APIï¼Œç”¨äºåœ¨ Web åº”ç”¨ä¸­è®¿é—® GPU åŠŸèƒ½ã€‚
åœ¨ WebGPU å‡ºç°ä¹‹å‰ï¼ŒWeb ç«¯çš„å›¾å½¢ç¼–ç¨‹åº”ç”¨ä¸»è¦é‡‡ç”¨ WebGL å’Œ WebGL 2ï¼Œè™½ç„¶å®ƒä»¬æœ‰ç€è·¨å¹³å°èƒ½åŠ›å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä½†æ¶æ„è¿‡äºå¤è€ï¼Œæœ€æ–°çš„ WebGL 2 åªæ˜¯å°è£…äº† 2009 å¹´ OpenGL 3.2 çš„å®ç°ã€‚Khronos ä¹ŸæŒ‡å‡º WebGL åç»­æ›´æ–°ä¸­ä¸å†å¼•å…¥ç°ä»£ GPU çš„æ–°ç‰¹æ€§ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://congyuxiaoyoudao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Interludes","item":"https://congyuxiaoyoudao.github.io/posts/interludes/"},{"@type":"ListItem","position":3,"name":"Interlude 3. WebGPU From Scratch","item":"https://congyuxiaoyoudao.github.io/posts/interludes/webgpu-from-scratch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Interlude 3. WebGPU From Scratch","name":"Interlude 3. WebGPU From Scratch","description":" ä»å¯¼å¸ˆé‚£é‡Œå¬è¯´äº† WebGPUï¼Œåšäº†ç‚¹è°ƒæŸ¥å‘ç°è¿™ä¸ª API è¿˜æŒºæ–°çš„ï¼Œæ­£å¥½ä¹‹å‰åªé›¶é›¶ç¢ç¢å­¦äº†ä¸€ç‚¹ OpenGLï¼Œç›¸æ¯”äºä¸é€‚åˆäººç±»å­¦çš„ Vulkanï¼Œè¿˜æ˜¯ WebGPU æ˜¾å¾—å‹å¥½ä¸€ç‚¹ã€‚\nğŸš© 0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\nä»€ä¹ˆæ˜¯ WebGPU é…ç½® WebGPU å¼€å‘ç¯å¢ƒ ç¬¬ä¸€ä¸ª WebGPU é¡¹ç›®ï¼šHelloTriangleï¼ For referenceğŸ‘‡ï¼š\nğŸª WebGPU Samples ğŸ“– WebGPU API Spec ğŸ“– WebGPU Shading Language ğŸ“º WebGPUå°ç™½å…¥é—¨ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é›¶åŸºç¡€åˆ›å»ºç¬¬ä¸€ä¸ªWebGPUé¡¹ç›®ï¼ ğŸ“– æ‚¨çš„ç¬¬ä¸€ä¸ª WebGPU åº”ç”¨ ğŸ“– lil-gui 0.20.0 0x01 è®¤è¯† WebGPU WebGPU æ˜¯ä¸€ä¸ªç”± W3C GPU å·¥ä½œç»„åˆ¶å®šçš„æ–°çš„ç°ä»£å›¾å½¢ APIï¼Œç”¨äºåœ¨ Web åº”ç”¨ä¸­è®¿é—® GPU åŠŸèƒ½ã€‚\nåœ¨ WebGPU å‡ºç°ä¹‹å‰ï¼ŒWeb ç«¯çš„å›¾å½¢ç¼–ç¨‹åº”ç”¨ä¸»è¦é‡‡ç”¨ WebGL å’Œ WebGL 2ï¼Œè™½ç„¶å®ƒä»¬æœ‰ç€è·¨å¹³å°èƒ½åŠ›å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä½†æ¶æ„è¿‡äºå¤è€ï¼Œæœ€æ–°çš„ WebGL 2 åªæ˜¯å°è£…äº† 2009 å¹´ OpenGL 3.2 çš„å®ç°ã€‚Khronos ä¹ŸæŒ‡å‡º WebGL åç»­æ›´æ–°ä¸­ä¸å†å¼•å…¥ç°ä»£ GPU çš„æ–°ç‰¹æ€§ã€‚\n","keywords":["WebGPU"],"articleBody":" ä»å¯¼å¸ˆé‚£é‡Œå¬è¯´äº† WebGPUï¼Œåšäº†ç‚¹è°ƒæŸ¥å‘ç°è¿™ä¸ª API è¿˜æŒºæ–°çš„ï¼Œæ­£å¥½ä¹‹å‰åªé›¶é›¶ç¢ç¢å­¦äº†ä¸€ç‚¹ OpenGLï¼Œç›¸æ¯”äºä¸é€‚åˆäººç±»å­¦çš„ Vulkanï¼Œè¿˜æ˜¯ WebGPU æ˜¾å¾—å‹å¥½ä¸€ç‚¹ã€‚\nğŸš© 0x00 To begin with è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\nä»€ä¹ˆæ˜¯ WebGPU é…ç½® WebGPU å¼€å‘ç¯å¢ƒ ç¬¬ä¸€ä¸ª WebGPU é¡¹ç›®ï¼šHelloTriangleï¼ For referenceğŸ‘‡ï¼š\nğŸª WebGPU Samples ğŸ“– WebGPU API Spec ğŸ“– WebGPU Shading Language ğŸ“º WebGPUå°ç™½å…¥é—¨ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é›¶åŸºç¡€åˆ›å»ºç¬¬ä¸€ä¸ªWebGPUé¡¹ç›®ï¼ ğŸ“– æ‚¨çš„ç¬¬ä¸€ä¸ª WebGPU åº”ç”¨ ğŸ“– lil-gui 0.20.0 0x01 è®¤è¯† WebGPU WebGPU æ˜¯ä¸€ä¸ªç”± W3C GPU å·¥ä½œç»„åˆ¶å®šçš„æ–°çš„ç°ä»£å›¾å½¢ APIï¼Œç”¨äºåœ¨ Web åº”ç”¨ä¸­è®¿é—® GPU åŠŸèƒ½ã€‚\nåœ¨ WebGPU å‡ºç°ä¹‹å‰ï¼ŒWeb ç«¯çš„å›¾å½¢ç¼–ç¨‹åº”ç”¨ä¸»è¦é‡‡ç”¨ WebGL å’Œ WebGL 2ï¼Œè™½ç„¶å®ƒä»¬æœ‰ç€è·¨å¹³å°èƒ½åŠ›å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä½†æ¶æ„è¿‡äºå¤è€ï¼Œæœ€æ–°çš„ WebGL 2 åªæ˜¯å°è£…äº† 2009 å¹´ OpenGL 3.2 çš„å®ç°ã€‚Khronos ä¹ŸæŒ‡å‡º WebGL åç»­æ›´æ–°ä¸­ä¸å†å¼•å…¥ç°ä»£ GPU çš„æ–°ç‰¹æ€§ã€‚\nè¿‘ 10 å¹´æ¥ï¼ŒGPU å–å¾—äº†é£é€Ÿå‘å±•ï¼Œä¹ŸåŒæ—¶å¸¦æ¥äº†ä¸å…¶äº¤äº’çš„ç°ä»£å›¾å½¢ API çš„å‘å±•ï¼Œä¾‹å¦‚ Metalã€D3D å’Œ Vulkanã€‚WebGPU ç»§æ‰¿äº†è¿™äº›å‘å±•ï¼Œå¹¶å°†å…¶å¸¦åˆ°äº† Web å¹³å°ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­é«˜æ•ˆè¿è¡Œ GPU çš„é€šç”¨è®¡ç®—èƒ½åŠ›ã€‚\nä½œä¸º WebGL çš„ç»§ä»»è€…ï¼ŒWebGPU ä¸åªæ˜¯ä¸€ä¸ªèƒ½ç”»å›¾ APIï¼Œè¿˜å…·å¤‡å¼ºå¤§çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œè¿™ä½¿å¾— WebGPU å¯ä»¥åˆ©ç”¨ ComputeShader æ‰¿æ‹…æ›´å¹¿æ³›çš„è®¡ç®—ä»»åŠ¡ï¼Œä¾‹å¦‚ç²’å­æ¨¡æ‹Ÿã€åŒè°ƒæ’åºç­‰ã€‚\n0x02 åˆ›å»º WebGPU é¡¹ç›® åˆ›å»ºåŸºæœ¬ Vite é¡¹ç›® é¦–å…ˆï¼Œç¡®ä¿ç”µè„‘ä¸Šæœ‰å¦‚ä¸‹é…ç½®ï¼š\nNode.js æ”¯æŒ WebGPU çš„æµè§ˆå™¨ï¼Œå¦‚ Chrome å’Œ Edgeï¼ˆç‰ˆæœ¬ 113 ä»¥ä¸Šï¼‰ ä»£ç ç¼–è¾‘å™¨ï¼Œå¦‚ VSCode è¿›å…¥é¡¹ç›®æ ¹ç›®å½•æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼š\n1npm create vite@latest webgpu-render-lab -- --template vanilla-ts è¿™é‡Œçš„ webgpu-render-lab æ˜¯é¡¹ç›®åï¼Œå¯ä»»å–\næŒ‰ç…§æŒ‡ç¤ºé€‰æ‹©å¼€å‘æ¨¡æ¿å’Œå˜ä½“ï¼Œè¿™é‡Œé€‰æ‹© Vanilla å’Œ TypeScriptï¼Œå³åŸç”Ÿ HTML + TypeScript çš„æ¨¡æ¿ã€‚\nç„¶åæŒ‰ç…§ä¸‹æ–¹æç¤ºä¾æ¬¡è¿è¡Œï¼š\n1cd webgpu-render-lab 2npm install 3npm run dev åœ¨æµè§ˆå™¨è®¿é—®å¯¹åº”çš„ç«¯å£å³å¯çœ‹åˆ°åˆå§‹çš„æ¨¡æ¿ç½‘é¡µã€‚\nç›®å‰çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š\n1my-webgpu-app/ 2â”œâ”€â”€ node_modules # dependencies 3â”œâ”€â”€ public # static assets 4â”œâ”€â”€ index.html # initial html 5â”œâ”€â”€ src/ 6â”‚ â””â”€â”€ main.ts # main TypeScript file 7â”œâ”€â”€ tsconfig.json # TypeScript configure 8â”œâ”€â”€ package.json # Node.js configure 9â””â”€â”€ ...others é…ç½® WebGPU é¡¹ç›® é¡¹ç›®ç›®å½•ä¸‹ï¼Œç»ˆç«¯è¿è¡Œï¼š\n1npm install -D @webgpu/types å®‰è£… WebGPU çš„ Ts ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œç„¶ååœ¨ tsconfig.json çš„ compilerOptions ä¸­å¢åŠ ä¸€æ¡ï¼š\n1// tsconfig.json 2\"compilerOptions\": { 3\t... 4\t\"types\": [\"vite/client\",\"@webgpu/types\"] 5} ä»¥å¯ç”¨ Vite å’Œ WebGPU ç±»å‹çš„æ™ºèƒ½æç¤ºå’Œç±»å‹æ£€æŸ¥ã€‚\ntsconfig.json ä¸­è¿˜æœ‰ä¸€ä¸ªå­—æ®µ includeï¼Œç”¨äºå‘Šè¯‰ TypeScript ç¼–è¯‘å™¨åªå¤„ç†/ç±»å‹æ£€æŸ¥æ‰€åˆ—å‡ºè·¯å¾„ä¸‹çš„ Ts æ–‡ä»¶ï¼Œä»¥æå‡é€Ÿåº¦ã€‚\n1// tsconfig.json 2\t\"include\": [\"src\"] æ‰€ä»¥å¦‚æœæœ‰ Ts æ–‡ä»¶è·¯å¾„ä¸åœ¨ src ä¸‹ï¼Œéœ€è¦åœ¨è¿™é‡ŒåŒ…å«å…¶æ‰€å±è·¯å¾„ã€‚\n0x03 HelloTriangle è¦ç”»ä¸–ç•Œï¼Œå…ˆç”»ä¸‰è§’å½¢ï¼\nWebGPU æ¸²æŸ“æµç¨‹ åœ¨æ­£å¼å†™ç¨‹åºä¹‹å‰ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ WebGPU çš„æ¶æ„å’Œæ¸²æŸ“æµç¨‹ã€‚\nå®é™…ä¸Šï¼ŒWebGPU å¹¶éç›´æ¥æ“çºµç¡¬ä»¶ï¼Œè€Œæ˜¯è¿è¡Œåœ¨æµè§ˆå™¨å†…éƒ¨çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚Web åº”ç”¨çš„ä¸€ä¸ªé¡µé¢å¤„äºä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œç”± JS çš„ API è´Ÿè´£ä¸æµè§ˆå™¨è¿›è¡Œæ²Ÿé€šï¼Œåè€…é€šè¿‡è¿›ç¨‹é—´é€šè®¯ï¼ˆIPCï¼‰å°†å‰è€…ä¼ é€’ç»™ Native Moduleï¼Œå†ç”± Native Module æ ¹æ®æ“ä½œç³»ç»Ÿæ˜ å°„åˆ°ä¸åŒçš„åŸç”Ÿå›¾å½¢ APIï¼ˆMetalã€D3Dã€Vulkanï¼‰ï¼Œå®Œæˆæœ€ç»ˆçš„æ¸²æŸ“å’Œè®¡ç®—ä»»åŠ¡ã€‚\nNative Moduleï¼ˆåŸç”Ÿæ¨¡ç»„ï¼‰ï¼šæŒ‡ç”±æœ¬åœ°ç³»ç»Ÿä»£ç ï¼ˆå¦‚ C/C++ã€Rustï¼‰ç¼–å†™ã€ç»è¿‡ç¼–è¯‘åä¾›é«˜çº§è¯­è¨€ï¼ˆå¦‚ JavaScriptã€Pythonï¼‰è°ƒç”¨çš„æ¨¡å—ï¼Œç›´æ¥ä¸æ“ä½œç³»ç»Ÿæˆ–åº•å±‚ç¡¬ä»¶äº¤äº’ã€‚Chrome ä¸­çš„ Dawn å°±æ˜¯ä¸€ä¸ª Native Module\nWebGPU çš„å·¥ä½œæµç¨‹å¤§è‡´å¯ä»¥åˆ†æˆï¼šåˆå§‹åŒ–ã€é…ç½®ç®¡çº¿å’Œå½•åˆ¶å‘½ä»¤é˜Ÿåˆ—ä¸‰ä¸ªé˜¶æ®µï¼š\nåˆå§‹åŒ–ï¼šè·å–å¯ä¾› JS æ“ä½œçš„ GPU é€»è¾‘å®ä¾‹ï¼Œé…ç½®ä¸Šä¸‹æ–‡ é…ç½®ç®¡çº¿ï¼šåˆ›å»ºç®¡çº¿ï¼Œåˆ›å»º Shader æ¨¡å—ï¼Œåˆ›å»º GPU å˜é‡ï¼ˆBuffersã€BindGroupsï¼‰ å½•åˆ¶å‘½ä»¤é˜Ÿåˆ—ï¼šå¼€å§‹ Passï¼Œç»˜åˆ¶é¡¶ç‚¹ï¼Œæäº¤é˜Ÿåˆ— ä¸ªäººæ„Ÿè§‰ï¼Œå…¶å®ä¹Ÿå¯ä»¥æŠŠè¿™ä¸‰ä¸ªè¿‡ç¨‹åˆå¹¶èµ·æ¥å½“ä½œä¸€ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ¯•ç«Ÿåœ¨ TS é‡Œå†™çš„åªæ˜¯æ•´ä¸ªæ¸²æŸ“é€»è¾‘ï¼ŒçœŸæ­£æ‰§è¡Œç»˜åˆ¶è¡Œä¸ºæ˜¯ç”± Native è¿›ç¨‹å®Œæˆçš„ã€‚\nåˆå§‹åŒ– WebGPU å› ä¸º WebGPU å°†æ¸²æŸ“ç»“æœç»˜åˆ¶åˆ° GPUCanvasContext ä¸Šï¼Œè€Œè¿™ä¸ª context æ˜¯é€šè¿‡ HTML çš„ è·å–çš„ï¼Œæ‰€ä»¥ç¡®ä¿ç½‘é¡µçš„ HTML æ–‡ä»¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ª canvas å…ƒç´ ï¼Œä½œä¸º GPU çš„æ¸²æŸ“ç›®æ ‡ã€‚\n1\u003ccanvas\u003e\u003c/canvas\u003e é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹ç›®å‰çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒ WebGPUï¼Œå¯ä»¥ç”¨ navigator.gpu åˆ¤æ–­ï¼Œå®ƒæ˜¯ WebGPU æä¾›ç»™ JS çš„å…¥å£å¯¹è±¡ï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ WebGPUï¼Œåˆ™å…¶ä¸º undefinedï¼Œéœ€è¦æ›´æ¢åˆé€‚çš„æµè§ˆå™¨æˆ–è€…å¼€å¯æŸä¸ª flagã€‚\n1 if (!navigator.gpu) { 2 throw new Error(\"WebGPU is not supported in this browser.\"); 3 } 4 else{ 5 console.log(\"Hello, WebGPU!\"); 6 } è·å¾—äº† WebGPU æ”¯æŒåï¼Œåˆ™å¯ä»¥è°ƒç”¨ navigator.gpu çš„ requestAdapter è·å¾—ä¸€ä¸ª GPU çš„é€»è¾‘é€‚é…å™¨ï¼ˆadapterï¼‰ï¼Œå†ç”± adapter è°ƒç”¨ requestDevice è·å¾—ä¸€ä¸ªå®é™…ä½¿ç”¨ JS è¿›è¡Œäº¤äº’çš„ GPU è®¾å¤‡ï¼ˆdeviceï¼‰ã€‚\n1const adapter = await navigator.gpu.requestAdapter(); 2const device = await gpuAdapter.requestDevice(); adapter å’Œ deviceï¼šGPUAdapter å°è£…äº†ä¸€ä¸ªé€‚é…å™¨ï¼Œå¹¶æè¿°å…¶ç‰¹æ€§ï¼ˆfeaturesï¼‰ã€é™åˆ¶ï¼ˆlimitsï¼‰åŠé€‚é…å™¨ä¿¡æ¯ï¼ˆInfoï¼‰ï¼Œæ˜¯æµè§ˆå™¨å¯¹ GPU çš„æŠ½è±¡ï¼Œå¯ä»¥ç”¨å®ƒé€‰æ‹©å¤šä¸ª GPUï¼ˆé›†æ˜¾ï¼Œç‹¬æ˜¾ï¼‰ï¼›GPUDevice å°è£…äº†ä¸€ä¸ªè®¾å¤‡ï¼Œå¹¶æš´éœ²è¯¥è®¾å¤‡çš„åŠŸèƒ½ï¼ˆåªè¯»ï¼‰ï¼Œä»£è¡¨ä¸ GPU çš„é€»è¾‘è¿æ¥ï¼Œå¯ä»¥ç”¨ device è°ƒç”¨ WebGPU æ¥å£ã€‚\næ­£å¦‚å¼€å¤´æ‰€è¯´ï¼ŒGPUCanvasContext æ˜¯é€šè¿‡ HTMLCanvasElement å®ä¾‹è°ƒç”¨ getContext æ–¹æ³•åˆ›å»ºçš„ï¼Œå¯¹äº WebGPU åˆ›å»ºä¸€ä¸ª WebGPU ä¸“ç”¨çš„ç”»å¸ƒä¸Šä¸‹æ–‡ï¼Œä¼ é€’ webgpu ä½œä¸ºå…¶ contextType å‚æ•°ã€‚\n1const canvas = document.querySelector('canvas') as HTMLCanvasElement; 2const context = canvas.getContext('webgpu'); canvas å’Œ contextï¼šç±»ä¼¼äº adapter å’Œ deviceï¼Œcanvas åªæ˜¯ä¸€ä¸ª HTML çš„ DOM å…ƒç´ ï¼Œéœ€è¦é€šè¿‡ getContext åˆ›å»ºä¸€ä¸ª WebGPU å¯ä»¥æ§åˆ¶çš„é€»è¾‘ç”»å¸ƒï¼Œåœ¨ context ä¸Šè¿›è¡Œç»˜åˆ¶ã€‚åˆ›å»º context ä¹‹åï¼Œå¯ä»¥é€šè¿‡ configure æ–¹æ³•é…ç½®ç”»å¸ƒä¸Šä¸‹æ–‡ï¼Œè‡³å°‘åŒ…æ‹¬ device å’Œ formatï¼ˆGPUTextureFormatï¼‰ï¼Œåè€…ä¸€èˆ¬ä¸º bgra8unormã€‚\nrequestAdapter å’Œ requestDevice éƒ½æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª Promiseï¼Œéœ€è¦ä½¿ç”¨ await è·å–å®é™…è¿”å›å¯¹è±¡ï¼Œè€Œ await å¿…é¡»åœ¨ async å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤–é¢åŒ…è£¹ä¸€ä¸ª async functionï¼š\n1async function initWebGPU() { 2 // check webgpu support ... 3 // request GPU adapter 4 const adapter = await navigator.gpu.requestAdapter(); 5 if (!adapter) { 6 throw new Error(\"Cannot get GPU adapter.\"); 7 } 8 9 // request a logical device 10 const device = await adapter.requestDevice(); 11 12 // get canvas and configure webgpu context 13 const canvas = document.querySelector('canvas') as HTMLCanvasElement; 14 const context = canvas.getContext('webgpu')!; 15 const presentationFormat = navigator.gpu.getPreferredCanvasFormat(); 16 17 context.configure({ 18 device, 19 format: presentationFormat, 20 alphaMode: 'premultiplied', 21 }); 22 // other code ... 23} è‡³æ­¤ï¼ŒWebGPU åˆå§‹åŒ–å®Œæ¯•ã€‚\né…ç½®ç®¡çº¿ WebGPU ä¸€å…±æœ‰ä¸¤ç§ç®¡çº¿ï¼šGPUComputePipelineï¼ˆè®¡ç®—ç®¡çº¿ï¼‰ å’Œ GPURenderPipelineï¼ˆæ¸²æŸ“ç®¡çº¿ï¼‰ï¼Œæ— è®ºå“ªç§ç®¡çº¿éƒ½è§„å®šäº† GPU çš„ä»»åŠ¡æµç¨‹ï¼ŒåŒ…æ‹¬ä» bindings æˆ–è€… buffers è·å–è¾“å…¥ï¼Œå¹¶äº§ç”Ÿè¾“å‡ºï¼ˆä¾‹å¦‚æ¸²æŸ“çº¹ç†ï¼‰çš„è¿‡ç¨‹ã€‚\nä»ç»“æ„ä¸Šçœ‹ï¼Œç®¡çº¿ç”±ä¸€ç³»åˆ—å¯ç¼–ç¨‹é˜¶æ®µï¼ˆshadersï¼‰å’Œå›ºå®šåŠŸèƒ½çŠ¶æ€ï¼ˆæ··åˆæ¨¡å¼ï¼‰ç»„æˆï¼Œä¸€ä¸ªæ¸²æŸ“ç®¡çº¿ä¸€èˆ¬åŒ…æ‹¬é¡¶ç‚¹ç€è‰²å™¨ï¼ˆvertex shaderï¼‰ã€ç‰‡å…ƒç€è‰²å™¨ï¼ˆfragment shaderï¼‰ç­‰ï¼Œè®¡ç®—ç®¡çº¿åˆ™åŒ…æ‹¬è®¡ç®—ç€è‰²å™¨ï¼ˆcompute shaderï¼‰ã€‚\nå¯¹äºä¸€ä¸ªæ¸²æŸ“ç®¡çº¿ï¼Œå¯ä»¥é€šè¿‡ createRenderPipeline æ–¹æ³•ç«‹å³åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯é€šè¿‡ createRenderPipelineAsync æ–¹æ³•å¼‚æ­¥åˆ›å»ºã€‚createRenderPipeline æ–¹æ³•æ¥å—ä¸€ä¸ªå­—å…¸å¯¹è±¡ GPURenderPipelineDescriptorï¼ŒåŒ…å«å¦‚ä¸‹æˆå‘˜ï¼š\nvertexï¼ˆGPUVertexStateï¼‰ï¼šæè¿°ç®¡çº¿é¡¶ç‚¹ç€è‰²å™¨å…¥å£åŠå…¶è¾“å…¥ç¼“å†²åŒºå¸ƒå±€ primitiveï¼ˆGPUPrimitiveStateï¼‰ï¼šæè¿°ç®¡çº¿ä¸­åŸå§‹å›¾å…ƒç›¸å…³å±æ€§ depthStencilï¼ˆGPUDepthStencilStateï¼‰ï¼šå¯é€‰çš„æ·±åº¦æ¨¡æ¿å±æ€§ multisampleï¼ˆGPUMultisampleStateï¼‰ï¼šå¤šé‡é‡‡æ ·å±æ€§ fragmentï¼ˆGPUFragmentStateï¼‰ï¼šæè¿°ç®¡çº¿ç‰‡å…ƒç€è‰²å™¨å…¥å£åŠå…¶è¾“å‡ºé¢œè‰² å¯¹äºæ­¤æ¬¡ç»˜åˆ¶ä¸‰è§’å½¢çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¿…é¡»è¦æä¾›çš„æ˜¯ vertexï¼Œprimitive å’Œ fragmentã€‚å…¶ä¸­ vertex å’Œ fragment éƒ½ç»§æ‰¿ GPUProgrammableStageï¼Œåè€…æè¿°ç”¨æˆ·æä¾›çš„ GPUShaderModule ä¸­çš„å…¥å£ç‚¹ï¼Œå³ç€è‰²å™¨çš„å…¥å£å‡½æ•°ã€‚\né¡¶ç‚¹ç€è‰²å™¨æ¥å—æ¥è‡ªé¡¶ç‚¹ç¼“å†²åŒºçš„è¾“å…¥æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®šä¹‰éœ€è¦ä¼ è¾“åˆ° GPU çš„é¡¶ç‚¹æ•°æ®ï¼Œç„¶åé€šè¿‡ GPUBuffer æè¿°å¦‚ä½•è§£æè¿™äº›æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸‰è§’å½¢çš„æ¯ä¸ªé¡¶ç‚¹ï¼Œå®šä¹‰å…¶ç”±ä½ç½®å’Œé¢œè‰²ä¸¤ä¸ªå±æ€§ç»„æˆï¼š\n1// data preparation 2const triangleData = new Float32Array([ 3// position color 40.0, 0.5, 0.0, 1.0, 0.0, 0.0, 1.0, 5-0.5, -0.5, 0.0, 0.0, 1.0, 0.0, 1.0, 60.5, -0.5, 0.0, 0.0, 0.0, 1.0, 1.0, 7]); ç„¶åå¯ä»¥é€šè¿‡ createBuffer æ–¹æ³•åˆ›å»ºä¸€ä¸ª GPUbufferï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª GPUBufferDescriptor ç±»å‹çš„å­—å…¸å¯¹è±¡ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸¤ä¸ªå‚æ•°ï¼š\nsizeï¼šç¼“å†²åŒºä»¥å­—èŠ‚ä¸ºå•ä½çš„å¤§å° usageï¼šç¼“å†²åŒºå…è®¸çš„ä½¿ç”¨æ–¹å¼ï¼ˆä¾‹å¦‚ Vertexï¼ŒUniformï¼ŒStorageï¼‰ å¯ä»¥é€šè¿‡ä¸Šè¿°å®šä¹‰çš„é¡¶ç‚¹æ•°ç»„çš„å­—èŠ‚é•¿åº¦è·å– sizeï¼›ä¸ºäº†èƒ½å¤Ÿæ‹·è´ç»™ GPUï¼Œå¹¶ä¼ é€’ç»™ VertexBufferï¼Œåœ¨ usage ä¸­éœ€è¦åŒæ—¶å¯ç”¨ VERTEX å’Œ COPY_DSTã€‚\n1// create and write gpu buffer 2const vertexBuffer = device.createBuffer({ 3size: triangleData.byteLength, 4usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST, 5}); 6 7device.queue.writeBuffer(vertexBuffer, 0, triangleData); å®šä¹‰å¥½äº†é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å…¥ï¼Œå°±å¯ä»¥å¼€å§‹ç¼–å†™ shader äº†ã€‚æ­£å¦‚ OpenGL æœ‰ GLSLï¼ŒD3D æœ‰ HLSLï¼ŒWebGPU çš„å¼€å‘ç»„ä¹Ÿä¸ºå…¶å¸¦æ¥äº†ä¸€å¥—æ–°çš„ç€è‰²å™¨è¯­è¨€â€”â€”WGSLã€‚ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢æ‰€éœ€çš„æœ€ç®€å•çš„ shader å¦‚ä¸‹ï¼š\n1// shader code 2const shaderCode = ` 3struct VertexOutput { 4 @builtin(position) position: vec4, 5 @location(0) color: vec4, 6}; 7 8@vertex 9fn vs_main( 10 @location(0) pos: vec3, 11 @location(1) color: vec4 12) -\u003e VertexOutput { 13 var output: VertexOutput; 14 output.position = vec4(pos, 1.0); 15 output.color = color; 16 return output; 17} 18 19@fragment 20fn fs_main(input: VertexOutput) -\u003e @location(0) vec4 { 21 return input.color; 22} 23`; 24 25// create shader module 26const shaderModule = device.createShaderModule({ 27code: shaderCode, 28}); shader ä¹Ÿå¯ä»¥å†™åœ¨ .wgsl æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ import å¯¼å…¥\nè‡³æ­¤ï¼Œå¯ä»¥è°ƒç”¨ createRenderPipeline æ–¹æ³•ï¼Œä¾æ¬¡å¡«å…¥ GPURenderPipelineDescriptor çš„å„ä¸ªå­—æ®µï¼š\nlayoutï¼šä½¿ç”¨ â€˜autoâ€™ï¼Œè®©ç®¡çº¿è‡ªåŠ¨æ¨æ–­èµ„æºç»‘å®šå¸ƒå±€ vertexï¼šshaderModule åŠé¡¶ç‚¹ç€è‰²å™¨å…¥å£å‡½æ•°ï¼Œé¡¶ç‚¹ç¼“å†²åŒºå¸ƒå±€å’Œæ ¼å¼ fragmentï¼šshaderModule åŠç‰‡å…ƒç€è‰²å™¨å…¥å£å‡½æ•°ï¼Œè¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸ context çš„ format åŒ¹é…ï¼‰ primitiveï¼šå…¶ä¸­çš„ topology è§„å®šå›¾å…ƒç±»å‹ï¼Œç”±äºæˆ‘ä»¬æ˜¯ç”»ä¸‰è§’å½¢æ‰€ä»¥ä½¿ç”¨ â€™triangle-listâ€™ 1 // create render pipeline 2 const pipeline = device.createRenderPipeline({ 3 layout: 'auto', 4 vertex: { 5 module: shaderModule, 6 entryPoint: 'vs_main', 7 buffers: [ 8 { 9 arrayStride: 7 * 4, // position: 3 + color: 4 10 attributes: [ 11 { // position 12 shaderLocation: 0, 13 offset: 0, 14 format: 'float32x3', 15 }, 16 { // color 17 shaderLocation: 1, 18 offset: 3 * 4, 19 format: 'float32x4', 20 }, 21 ], 22 }, 23 ], 24 }, 25 fragment: { 26 module: shaderModule, 27 entryPoint: 'fs_main', 28 targets: [ 29 { 30 format: presentationFormat, 31 }, 32 ], 33 }, 34 primitive: { 35 topology: 'triangle-list', 36 }, 37 }); è‡³æ­¤ï¼Œç®¡çº¿é…ç½®ç»“æŸã€‚\nå½•åˆ¶æ¸²æŸ“é˜Ÿåˆ— ç†Ÿæ‚‰ Unity çš„åŒå­¦å¯èƒ½ä¼šçŸ¥é“ï¼Œå½“è°ƒç”¨æ¸²æŸ“å‘½ä»¤æ—¶ï¼ŒGPU å¹¶éç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æŠŠä¸€ç³»åˆ—å‘½ä»¤å†™å…¥ä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒºï¼ˆCommandBufferï¼‰ï¼Œç„¶åå†å°†è¿™ä¸ª CommandBuffer æ³¨å…¥åˆ°ç®¡çº¿çš„ç‰¹å®šé˜¶æ®µï¼ˆä¾‹å¦‚ä¸é€æ˜ç‰©ä½“æ¸²æŸ“åæˆ–è€…é˜´å½±æ¸²æŸ“å‰ï¼‰ã€‚å½“æ¸²æŸ“å¾ªç¯æ‰§è¡Œåˆ°æ³¨å…¥ç‚¹æ—¶ï¼Œæ‰ä¼šä¾æ¬¡æ‰§è¡Œç¼“å†²åŒºä¸­çš„å‘½ä»¤ã€‚\nWebGPU ä¸­çš„ CommandEncoder æ­£æ˜¯å¯¹åº”äº†å†™å…¥æ¸²æŸ“ç¼“å†²åŒºçš„å½•åˆ¶æ“ä½œï¼Œç›´åˆ° submit å‰çš„å†…å®¹éƒ½æ˜¯åœ¨æ„å»ºå‘½ä»¤åˆ—è¡¨ï¼š\n1const commandEncoder = device.createCommandEncoder(); 2// record command here 3// ... 4const commandBuffer = commandEncoder.finish(); 5device.queue.submit([commandBuffer]); å¦‚æœè¯´ GPUCommandEncoder æ˜¯ä¸€æ•´ä¸ªå½•åˆ¶å™¨ï¼Œé‚£ä¹ˆ GPURenderPassEncoder å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªå­å½•åˆ¶å™¨ï¼Œå½•åˆ¶ä¸€ä¸ª Pass è¿‡ç¨‹ä¸­çš„å‘½ä»¤ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª Pass å°±æ˜¯ä» GPU è¾“å…¥æ•°æ®åˆ°è¾“å‡ºæ¸²æŸ“ç›®æ ‡çš„è¿‡ç¨‹ã€‚ä¸€ä¸ª CommandEncoder å¯ä»¥åˆ›å»ºå¤šä¸ª Passã€‚\nåœ¨ WebGPU ä¸­åˆ›å»ºä¸€ä¸ª Pass å¯ä»¥ä½¿ç”¨ beginRenderPass æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª GPURenderPassDescripter å­—å…¸å¯¹è±¡ï¼Œè‡³å°‘éœ€è¦åŒ…å« colorAttachments å­—æ®µã€‚colorAttachments å®šä¹‰äº†å½“å‰ Pass è¾“å‡ºçš„æ‰€æœ‰é¢œè‰²é™„ä»¶ï¼Œæ¯ä¸ª colorAttachment æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¿…é¡»æä¾›ä»¥ä¸‹ä¸‰ä¸ªå­—æ®µï¼š\nviewï¼ˆGPUTextureViewï¼‰ï¼šæè¿°è¾“å‡ºæ­¤ colorAttachment çš„çº¹ç†å­èµ„æº loadOpï¼ˆGPULoadOpï¼‰ï¼šæ‰§è¡Œ Pass å‰å¯¹ view çš„åŠ è½½æ“ä½œï¼ˆä¸€èˆ¬ä¸º clearï¼‰ storeOpï¼ˆGPUStoreOpï¼‰ï¼šæ‰§è¡Œ Pass åå¯¹ view çš„å­˜å‚¨æ“ä½œ åˆ›å»º GPUPassEncoder åï¼Œå°±å¯ä»¥å½•åˆ¶æ¸²æŸ“å‘½ä»¤äº†ï¼Œå…·ä½“åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š\nè®¾ç½®ç®¡çº¿ï¼šè®¾ç½®è¯¥ Pass ä½¿ç”¨çš„ç®¡çº¿ã€æ¸²æŸ“çŠ¶æ€ ç»‘å®šèµ„æºï¼šè®¾ç½®é¡¶ç‚¹ç¼“å†²ã€ç´¢å¼•ç¼“å†²å’Œ BindingGroup æ‰§è¡Œç»˜åˆ¶ï¼šè°ƒç”¨ draw æ–¹æ³•ç»˜åˆ¶é¡¶ç‚¹ ä¸Šè¿°æµç¨‹å®Œæˆåï¼Œä¾¿å¯ä»¥é€šè¿‡ end æ–¹æ³•ç»“æŸ Pass çš„å½•åˆ¶ã€‚å¯¹äºæœ¬æ¬¡çš„ä¸‰è§’å½¢ï¼Œå…¶æ¸²æŸ“é˜Ÿåˆ—çš„å½•åˆ¶è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1function frame() { 2 // cmdEncoder to record commands 3 const commandEncoder = device.createCommandEncoder(); 4 5 // get current texture view 6 const textureView = context.getCurrentTexture().createView(); 7 8 // begin render pass 9 const renderPassDescriptor: GPURenderPassDescriptor = { 10 colorAttachments: [ 11 { 12 view: textureView, 13 clearValue: { r: 0.0, g: 0.0, b: 0.0, a: 1.0 }, 14 loadOp: 'clear', 15 storeOp: 'store', 16 }, 17 ], 18 }; 19 20 const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor); 21 22 // set pipeline and vertex buffer 23 passEncoder.setPipeline(pipeline); 24 passEncoder.setVertexBuffer(0, vertexBuffer); 25 26 // draw triangle: 3 vertices 27 passEncoder.draw(3); 28 29 // end render pass 30 passEncoder.end(); 31 32 // finish encode and submit 33 device.queue.submit([commandEncoder.finish()]); 34 35 // request next frame 36 requestAnimationFrame(frame); 37 } 38 39 // start render loop 40 requestAnimationFrame(frame); åœ¨ç»ˆç«¯è¿è¡Œ npm run devï¼Œä¸å‡ºæ„å¤–å°±èƒ½çœ‹åˆ°ä¸€ä¸ªäº”å½©æ–‘æ–“çš„ä¸‰è§’å½¢ï¼š\nCSS è‡ªå·±å†™\nGUI ç›®å‰æˆ‘ä»¬å‚æ•°æ˜¯å†™æ­»åœ¨ TS ä¸­ï¼Œæ›´æ–¹ä¾¿çš„æ–¹å¼æ˜¯åŠ å…¥äº¤äº’çš„ GUIï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­å®æ—¶è°ƒæ•´å‚æ•°å¹¶æŸ¥çœ‹ç»“æœã€‚\nOpenGL çš„æ—¶å€™ç”¨çš„æ˜¯ imguiï¼Œä½†ä¸çŸ¥ä¸ºä½•ä¸‹è½½ä¸äº†å…¶å¯¹ js çš„å°è£…ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©çš„æ˜¯å¦ä¸€ä¸ªè½»é‡çº§çš„ lil-guiï¼Œåœ¨ç»ˆç«¯ä¸‹è½½å®ƒçš„åŒ…ï¼š\n1npm install lil-gui ç„¶ååœ¨ TypeScript æ–‡ä»¶ä¸­å¼•å…¥ï¼š\n1import {GUI} from 'lil-gui' åˆå§‹åŒ– GUI å¹¶æ·»åŠ ä¸‰ä¸ª color å‚æ•°æ§åˆ¶ä¸‰è§’å½¢æ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²ï¼š\n1const gui = new GUI(); 2 3const params = { 4colorA: [1, 0, 0, 1], 5colorB: [0, 1, 0, 1], 6colorC: [0, 0, 1, 1], 7}; 8 9gui.addColor(params, 'colorA'); 10gui.addColor(params, 'colorB'); 11gui.addColor(params, 'colorC'); åˆ›å»ºä¸€ä¸ª GPUBufferï¼Œå°†å…¶è®¾ç½®ä¸º UNIFORMï¼Œå¹¶ç»‘å®šåˆ° bindGroupï¼š\n1const colorBuffer = device.createBuffer({ 2 size: 4 * 3 * 4, // 3 colors, each with 4 floats 3 usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST, 4}) 5 6const bindGroup = device.createBindGroup({ 7 layout: pipeline.getBindGroupLayout(0), 8 entries: [{ 9 binding: 0, 10 resource: { 11\tbuffer: colorBuffer 12 } 13}], 14}); ç„¶åæ¯å¸§æ›´æ–°è¿™ä¸ª Buffer å¹¶è®¾ç½®ç»‘å®šç»„ï¼š\n1function updateColors(){ 2 device.queue.writeBuffer(colorBuffer, 0, new Float32Array([...params.colorA, ...params.colorB, ...params.colorC])); 3} 4 5function frame(){ 6\t// ... 7 updateColors(); 8 passEncoder.setBindGroup(0, bindGroup); 9} æœ€åå¯ä»¥åœ¨ VertexShader ä¸­è§£æè¿™ä¸ª uniformï¼š\n1struct ColorUniform { 2 colorA: vec4\u003cf32\u003e, 3 colorB: vec4\u003cf32\u003e, 4 colorC: vec4\u003cf32\u003e, 5}; 6 7@group(0) @binding(0) var\u003cuniform\u003e uColors: ColorUniform; 8 9fn getColorByIndex(index: u32) -\u003e vec4\u003cf32\u003e { 10 if (index == 0u) { 11\treturn uColors.colorA; 12 } else if (index == 1u) { 13\treturn uColors.colorB; 14 } else { 15\treturn uColors.colorC; 16 } 17} 18 19@vertex 20fn vs_main( 21 @builtin(vertex_index) vertexindex: u32, 22 @location(0) pos: vec3\u003cf32\u003e, 23 @location(1) color: vec4\u003cf32\u003e 24) -\u003e VertexOutput { 25 var output: VertexOutput; 26 output.position = vec4\u003cf32\u003e(pos, 1.0); 27 output.color = getColorByIndex(vertexindex); 28 return output; 29} å›åˆ°æµè§ˆå™¨ï¼Œè°ƒæ•´é¢œè‰²ï¼Œå°±å¯ä»¥çœ‹åˆ°å˜åŒ–äº†ï¼š\n0x0F After words å¥½äº†ï¼Œä½ å·²ç»å­¦ä¼šå¦‚ä½•ä½¿ç”¨ WebGPU ç»˜åˆ¶ä¸‰è§’å½¢äº†ï¼Œå¯ä»¥å°è¯•æŒ‘æˆ˜ä¸€ä¸‹åˆ¶ä½œä¸€ä¸ª 3DGS çš„å®æ—¶æ¸²æŸ“é¢„è§ˆå™¨äº†ï¼\nå¥½å§ä¸å¼€ç©ç¬‘äº†ï¼ŒWebGPU è¿˜æœ‰æå¤§éƒ¨åˆ†å†…å®¹æ˜¯æœ¬æ–‡æ²¡æœ‰æ¶µç›–çš„ï¼Œå¦‚æœè¯»è€…æœ‰æ›´è¿›ä¸€æ­¥çš„éœ€æ±‚ï¼Œæ–‡ç« å¼€å¤´ä¹Ÿåˆ—å‡ºäº†ä¸€äº›æ›´è¯¦ç»†çš„æ–‡æ¡£å’Œæ•™ç¨‹å¯ä¾›å‚è€ƒã€‚å¦‚æœæœ‰ä¸€äº› OpenGL æˆ–è€… WebGL åŸºç¡€ï¼Œå­¦ WebGPU ä¹Ÿä¼šæ›´è½»æ¾äº›å§â€¦â€¦\n","wordCount":"1355","inLanguage":"zh","datePublished":"2025-06-30T00:00:00Z","dateModified":"2025-06-30T00:00:00Z","author":{"@type":"Person","name":"The Only Problem"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://congyuxiaoyoudao.github.io/posts/interludes/webgpu-from-scratch/"},"publisher":{"@type":"Organization","name":"The Only Problem's Blog","logo":{"@type":"ImageObject","url":"https://congyuxiaoyoudao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://congyuxiaoyoudao.github.io/ accesskey=h title="The Only Problem's Blog (Alt + H)">The Only Problem's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://congyuxiaoyoudao.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://congyuxiaoyoudao.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://congyuxiaoyoudao.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/>Posts</a>&nbsp;Â»&nbsp;<a href=https://congyuxiaoyoudao.github.io/posts/interludes/>Interludes</a></div><h1 class="post-title entry-hint-parent">Interlude 3. WebGPU From Scratch</h1><div class=post-meta><span title='2025-06-30 00:00:00 +0000 UTC'>å…­æœˆ 30, 2025</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;The Only Problem</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#-0x00-to-begin-with aria-label="ğŸš© 0x00 To begin with">ğŸš© 0x00 To begin with</a></li><li><a href=#0x01-%e8%ae%a4%e8%af%86-webgpu aria-label="0x01 è®¤è¯† WebGPU">0x01 è®¤è¯† WebGPU</a></li><li><a href=#0x02-%e5%88%9b%e5%bb%ba-webgpu-%e9%a1%b9%e7%9b%ae aria-label="0x02 åˆ›å»º WebGPU é¡¹ç›®">0x02 åˆ›å»º WebGPU é¡¹ç›®</a><ul><li><a href=#%e5%88%9b%e5%bb%ba%e5%9f%ba%e6%9c%ac-vite-%e9%a1%b9%e7%9b%ae aria-label="åˆ›å»ºåŸºæœ¬ Vite é¡¹ç›®">åˆ›å»ºåŸºæœ¬ Vite é¡¹ç›®</a></li><li><a href=#%e9%85%8d%e7%bd%ae-webgpu-%e9%a1%b9%e7%9b%ae aria-label="é…ç½® WebGPU é¡¹ç›®">é…ç½® WebGPU é¡¹ç›®</a></li></ul></li><li><a href=#0x03-hellotriangle aria-label="0x03 HelloTriangle">0x03 HelloTriangle</a><ul><li><a href=#webgpu-%e6%b8%b2%e6%9f%93%e6%b5%81%e7%a8%8b aria-label="WebGPU æ¸²æŸ“æµç¨‹">WebGPU æ¸²æŸ“æµç¨‹</a></li><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96-webgpu aria-label="åˆå§‹åŒ– WebGPU">åˆå§‹åŒ– WebGPU</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%ba%bf aria-label=é…ç½®ç®¡çº¿>é…ç½®ç®¡çº¿</a></li><li><a href=#%e5%bd%95%e5%88%b6%e6%b8%b2%e6%9f%93%e9%98%9f%e5%88%97 aria-label=å½•åˆ¶æ¸²æŸ“é˜Ÿåˆ—>å½•åˆ¶æ¸²æŸ“é˜Ÿåˆ—</a></li><li><a href=#gui aria-label=GUI>GUI</a></li></ul></li><li><a href=#0x0f-after-words aria-label="0x0F After words">0x0F After words</a></li></ul></div></details></div><div class=post-content><blockquote><p>ä»å¯¼å¸ˆé‚£é‡Œå¬è¯´äº† WebGPUï¼Œåšäº†ç‚¹è°ƒæŸ¥å‘ç°è¿™ä¸ª API è¿˜æŒºæ–°çš„ï¼Œæ­£å¥½ä¹‹å‰åªé›¶é›¶ç¢ç¢å­¦äº†ä¸€ç‚¹ OpenGLï¼Œç›¸æ¯”äºä¸é€‚åˆäººç±»å­¦çš„ Vulkanï¼Œè¿˜æ˜¯ WebGPU æ˜¾å¾—å‹å¥½ä¸€ç‚¹ã€‚</p></blockquote><hr><h2 id=-0x00-to-begin-with>ğŸš© 0x00 To begin with<a hidden class=anchor aria-hidden=true href=#-0x00-to-begin-with>#</a></h2><p>è¿™ç¯‡æ–‡ç« å°†ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><input checked disabled type=checkbox> ä»€ä¹ˆæ˜¯ WebGPU</li><li><input checked disabled type=checkbox> é…ç½® WebGPU å¼€å‘ç¯å¢ƒ</li><li><input checked disabled type=checkbox> ç¬¬ä¸€ä¸ª WebGPU é¡¹ç›®ï¼šHelloTriangleï¼</li></ul><p><strong>For reference</strong>ğŸ‘‡ï¼š</p><ul><li>ğŸª
<a href=https://webgpu.github.io/webgpu-samples/>WebGPU Samples</a></li><li>ğŸ“–
<a href=https://gpuweb.github.io/gpuweb/>WebGPU API Spec</a></li><li>ğŸ“–
<a href=https://www.w3.org/TR/WGSL/>WebGPU Shading Language</a></li><li>ğŸ“º
<a href=https://www.bilibili.com/video/BV1uu411B7uq/>WebGPUå°ç™½å…¥é—¨ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é›¶åŸºç¡€åˆ›å»ºç¬¬ä¸€ä¸ªWebGPUé¡¹ç›®ï¼</a></li><li>ğŸ“–
<a href="https://codelabs.developers.google.com/your-first-webgpu-app?hl=zh-cn&amp;authuser=0#0">æ‚¨çš„ç¬¬ä¸€ä¸ª WebGPU åº”ç”¨</a></li><li>ğŸ“–
<a href=https://lil-gui.georgealways.com/>lil-gui 0.20.0</a></li></ul><hr><h2 id=0x01-è®¤è¯†-webgpu>0x01 è®¤è¯† WebGPU<a hidden class=anchor aria-hidden=true href=#0x01-è®¤è¯†-webgpu>#</a></h2><p>WebGPU æ˜¯ä¸€ä¸ªç”± W3C GPU å·¥ä½œç»„åˆ¶å®šçš„æ–°çš„ç°ä»£å›¾å½¢ APIï¼Œç”¨äºåœ¨ Web åº”ç”¨ä¸­è®¿é—® GPU åŠŸèƒ½ã€‚</p><p>åœ¨ WebGPU å‡ºç°ä¹‹å‰ï¼ŒWeb ç«¯çš„å›¾å½¢ç¼–ç¨‹åº”ç”¨ä¸»è¦é‡‡ç”¨ WebGL å’Œ WebGL 2ï¼Œè™½ç„¶å®ƒä»¬æœ‰ç€è·¨å¹³å°èƒ½åŠ›å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œä½†æ¶æ„è¿‡äºå¤è€ï¼Œæœ€æ–°çš„ WebGL 2 åªæ˜¯å°è£…äº† 2009 å¹´ OpenGL 3.2 çš„å®ç°ã€‚Khronos ä¹ŸæŒ‡å‡º WebGL åç»­æ›´æ–°ä¸­ä¸å†å¼•å…¥ç°ä»£ GPU çš„æ–°ç‰¹æ€§ã€‚</p><p><img alt="WebGL å‘å±•å†å²ï¼ŒOrillusion" loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202506301450554.png#center></p><p>è¿‘ 10 å¹´æ¥ï¼ŒGPU å–å¾—äº†é£é€Ÿå‘å±•ï¼Œä¹ŸåŒæ—¶å¸¦æ¥äº†ä¸å…¶äº¤äº’çš„ç°ä»£å›¾å½¢ API çš„å‘å±•ï¼Œä¾‹å¦‚ Metalã€D3D å’Œ Vulkanã€‚WebGPU ç»§æ‰¿äº†è¿™äº›å‘å±•ï¼Œå¹¶å°†å…¶å¸¦åˆ°äº† Web å¹³å°ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­é«˜æ•ˆè¿è¡Œ GPU çš„é€šç”¨è®¡ç®—èƒ½åŠ›ã€‚</p><p>ä½œä¸º WebGL çš„ç»§ä»»è€…ï¼ŒWebGPU ä¸åªæ˜¯ä¸€ä¸ªèƒ½ç”»å›¾ APIï¼Œè¿˜å…·å¤‡å¼ºå¤§çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œè¿™ä½¿å¾— WebGPU å¯ä»¥åˆ©ç”¨ ComputeShader æ‰¿æ‹…æ›´å¹¿æ³›çš„è®¡ç®—ä»»åŠ¡ï¼Œä¾‹å¦‚ç²’å­æ¨¡æ‹Ÿã€åŒè°ƒæ’åºç­‰ã€‚</p><hr><h2 id=0x02-åˆ›å»º-webgpu-é¡¹ç›®>0x02 åˆ›å»º WebGPU é¡¹ç›®<a hidden class=anchor aria-hidden=true href=#0x02-åˆ›å»º-webgpu-é¡¹ç›®>#</a></h2><h3 id=åˆ›å»ºåŸºæœ¬-vite-é¡¹ç›®>åˆ›å»ºåŸºæœ¬ Vite é¡¹ç›®<a hidden class=anchor aria-hidden=true href=#åˆ›å»ºåŸºæœ¬-vite-é¡¹ç›®>#</a></h3><p>é¦–å…ˆï¼Œç¡®ä¿ç”µè„‘ä¸Šæœ‰å¦‚ä¸‹é…ç½®ï¼š</p><ul><li>Node.js</li><li>æ”¯æŒ WebGPU çš„æµè§ˆå™¨ï¼Œå¦‚ Chrome å’Œ Edgeï¼ˆç‰ˆæœ¬ 113 ä»¥ä¸Šï¼‰</li><li>ä»£ç ç¼–è¾‘å™¨ï¼Œå¦‚ VSCode</li></ul><p>è¿›å…¥é¡¹ç›®æ ¹ç›®å½•æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>npm create vite@latest webgpu-render-lab -- --template vanilla-ts
</span></span></code></pre></div><blockquote><p>è¿™é‡Œçš„ <code>webgpu-render-lab</code> æ˜¯é¡¹ç›®åï¼Œå¯ä»»å–</p></blockquote><p>æŒ‰ç…§æŒ‡ç¤ºé€‰æ‹©å¼€å‘æ¨¡æ¿å’Œå˜ä½“ï¼Œè¿™é‡Œé€‰æ‹© Vanilla å’Œ TypeScriptï¼Œå³åŸç”Ÿ HTML + TypeScript çš„æ¨¡æ¿ã€‚</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202506301322006.png#center></p><p>ç„¶åæŒ‰ç…§ä¸‹æ–¹æç¤ºä¾æ¬¡è¿è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>cd</span> webgpu-render-lab
</span></span><span class=line><span class=ln>2</span><span class=cl>npm install
</span></span><span class=line><span class=ln>3</span><span class=cl>npm run dev
</span></span></code></pre></div><p>åœ¨æµè§ˆå™¨è®¿é—®å¯¹åº”çš„ç«¯å£å³å¯çœ‹åˆ°åˆå§‹çš„æ¨¡æ¿ç½‘é¡µã€‚</p><p>ç›®å‰çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>my-webgpu-app/
</span></span><span class=line><span class=ln>2</span><span class=cl>â”œâ”€â”€ node_modules        <span class=c1># dependencies</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>â”œâ”€â”€ public              <span class=c1># static assets</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>â”œâ”€â”€ index.html          <span class=c1># initial html</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>â”œâ”€â”€ src/
</span></span><span class=line><span class=ln>6</span><span class=cl>â”‚   â””â”€â”€ main.ts         <span class=c1># main TypeScript file</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>â”œâ”€â”€ tsconfig.json       <span class=c1># TypeScript configure</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>â”œâ”€â”€ package.json        <span class=c1># Node.js configure</span>
</span></span><span class=line><span class=ln>9</span><span class=cl>â””â”€â”€ ...others
</span></span></code></pre></div><h3 id=é…ç½®-webgpu-é¡¹ç›®>é…ç½® WebGPU é¡¹ç›®<a hidden class=anchor aria-hidden=true href=#é…ç½®-webgpu-é¡¹ç›®>#</a></h3><p>é¡¹ç›®ç›®å½•ä¸‹ï¼Œç»ˆç«¯è¿è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>npm install -D @webgpu/types
</span></span></code></pre></div><p>å®‰è£… WebGPU çš„ Ts ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œç„¶ååœ¨ tsconfig.json çš„ <code>compilerOptions</code> ä¸­å¢åŠ ä¸€æ¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=c1>// tsconfig.json
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=s2>&#34;compilerOptions&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>	Â <span class=err>...</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>	<span class=nt>&#34;types&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;vite/client&#34;</span><span class=p>,</span><span class=s2>&#34;@webgpu/types&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ä»¥å¯ç”¨ Vite å’Œ WebGPU ç±»å‹çš„æ™ºèƒ½æç¤ºå’Œç±»å‹æ£€æŸ¥ã€‚</p><p>tsconfig.json ä¸­è¿˜æœ‰ä¸€ä¸ªå­—æ®µ <code>include</code>ï¼Œç”¨äºå‘Šè¯‰ TypeScript ç¼–è¯‘å™¨åªå¤„ç†/ç±»å‹æ£€æŸ¥æ‰€åˆ—å‡ºè·¯å¾„ä¸‹çš„ Ts æ–‡ä»¶ï¼Œä»¥æå‡é€Ÿåº¦ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=c1>// tsconfig.json
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span>	<span class=s2>&#34;include&#34;</span><span class=err>:</span> <span class=p>[</span><span class=s2>&#34;src&#34;</span><span class=p>]</span>
</span></span></code></pre></div><p>æ‰€ä»¥å¦‚æœæœ‰ Ts æ–‡ä»¶è·¯å¾„ä¸åœ¨ src ä¸‹ï¼Œéœ€è¦åœ¨è¿™é‡ŒåŒ…å«å…¶æ‰€å±è·¯å¾„ã€‚</p><hr><h2 id=0x03-hellotriangle>0x03 HelloTriangle<a hidden class=anchor aria-hidden=true href=#0x03-hellotriangle>#</a></h2><blockquote><p>è¦ç”»ä¸–ç•Œï¼Œå…ˆç”»ä¸‰è§’å½¢ï¼</p></blockquote><h3 id=webgpu-æ¸²æŸ“æµç¨‹>WebGPU æ¸²æŸ“æµç¨‹<a hidden class=anchor aria-hidden=true href=#webgpu-æ¸²æŸ“æµç¨‹>#</a></h3><p>åœ¨æ­£å¼å†™ç¨‹åºä¹‹å‰ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ WebGPU çš„æ¶æ„å’Œæ¸²æŸ“æµç¨‹ã€‚</p><p><img alt="WebGPU çš„æ¶æ„ï¼ˆChromeï¼‰ï¼ŒOrillusion" loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202506301737646.png#center></p><p>å®é™…ä¸Šï¼ŒWebGPU å¹¶éç›´æ¥æ“çºµç¡¬ä»¶ï¼Œè€Œæ˜¯è¿è¡Œåœ¨æµè§ˆå™¨å†…éƒ¨çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚Web åº”ç”¨çš„ä¸€ä¸ªé¡µé¢å¤„äºä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œç”± JS çš„ API è´Ÿè´£ä¸æµè§ˆå™¨è¿›è¡Œæ²Ÿé€šï¼Œåè€…é€šè¿‡è¿›ç¨‹é—´é€šè®¯ï¼ˆIPCï¼‰å°†å‰è€…ä¼ é€’ç»™ Native Moduleï¼Œå†ç”± Native Module æ ¹æ®æ“ä½œç³»ç»Ÿæ˜ å°„åˆ°ä¸åŒçš„åŸç”Ÿå›¾å½¢ APIï¼ˆMetalã€D3Dã€Vulkanï¼‰ï¼Œå®Œæˆæœ€ç»ˆçš„æ¸²æŸ“å’Œè®¡ç®—ä»»åŠ¡ã€‚</p><blockquote><p>Native Moduleï¼ˆåŸç”Ÿæ¨¡ç»„ï¼‰ï¼šæŒ‡ç”±æœ¬åœ°ç³»ç»Ÿä»£ç ï¼ˆå¦‚ C/C++ã€Rustï¼‰ç¼–å†™ã€ç»è¿‡ç¼–è¯‘åä¾›é«˜çº§è¯­è¨€ï¼ˆå¦‚ JavaScriptã€Pythonï¼‰è°ƒç”¨çš„æ¨¡å—ï¼Œç›´æ¥ä¸æ“ä½œç³»ç»Ÿæˆ–åº•å±‚ç¡¬ä»¶äº¤äº’ã€‚Chrome ä¸­çš„ Dawn å°±æ˜¯ä¸€ä¸ª Native Module</p></blockquote><p>WebGPU çš„å·¥ä½œæµç¨‹å¤§è‡´å¯ä»¥åˆ†æˆï¼šåˆå§‹åŒ–ã€é…ç½®ç®¡çº¿å’Œå½•åˆ¶å‘½ä»¤é˜Ÿåˆ—ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>åˆå§‹åŒ–ï¼šè·å–å¯ä¾› JS æ“ä½œçš„ GPU é€»è¾‘å®ä¾‹ï¼Œé…ç½®ä¸Šä¸‹æ–‡</li><li>é…ç½®ç®¡çº¿ï¼šåˆ›å»ºç®¡çº¿ï¼Œåˆ›å»º Shader æ¨¡å—ï¼Œåˆ›å»º GPU å˜é‡ï¼ˆBuffersã€BindGroupsï¼‰</li><li>å½•åˆ¶å‘½ä»¤é˜Ÿåˆ—ï¼šå¼€å§‹ Passï¼Œç»˜åˆ¶é¡¶ç‚¹ï¼Œæäº¤é˜Ÿåˆ—</li></ul><p><img alt="WebGPU å·¥ä½œæµï¼ŒOrillusion" loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202506301717915.png#center></p><p>ä¸ªäººæ„Ÿè§‰ï¼Œå…¶å®ä¹Ÿå¯ä»¥æŠŠè¿™ä¸‰ä¸ªè¿‡ç¨‹åˆå¹¶èµ·æ¥å½“ä½œä¸€ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ¯•ç«Ÿåœ¨ TS é‡Œå†™çš„åªæ˜¯æ•´ä¸ªæ¸²æŸ“é€»è¾‘ï¼ŒçœŸæ­£æ‰§è¡Œç»˜åˆ¶è¡Œä¸ºæ˜¯ç”± Native è¿›ç¨‹å®Œæˆçš„ã€‚</p><h3 id=åˆå§‹åŒ–-webgpu>åˆå§‹åŒ– WebGPU<a hidden class=anchor aria-hidden=true href=#åˆå§‹åŒ–-webgpu>#</a></h3><p>å› ä¸º WebGPU å°†æ¸²æŸ“ç»“æœç»˜åˆ¶åˆ° <code>GPUCanvasContext</code> ä¸Šï¼Œè€Œè¿™ä¸ª context æ˜¯é€šè¿‡ HTML çš„ <code>&lt;canvas></code> è·å–çš„ï¼Œæ‰€ä»¥ç¡®ä¿ç½‘é¡µçš„ HTML æ–‡ä»¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ª canvas å…ƒç´ ï¼Œä½œä¸º GPU çš„æ¸²æŸ“ç›®æ ‡ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=ln>1</span><span class=cl><span class=p>&lt;</span><span class=nt>canvas</span><span class=p>&gt;&lt;/</span><span class=nt>canvas</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹ç›®å‰çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒ WebGPUï¼Œå¯ä»¥ç”¨ <code>navigator.gpu</code> åˆ¤æ–­ï¼Œå®ƒæ˜¯ WebGPU æä¾›ç»™ JS çš„å…¥å£å¯¹è±¡ï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ WebGPUï¼Œåˆ™å…¶ä¸º undefinedï¼Œéœ€è¦æ›´æ¢åˆé€‚çš„æµè§ˆå™¨æˆ–è€…å¼€å¯æŸä¸ª flagã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>navigator</span><span class=p>.</span><span class=nx>gpu</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;WebGPU is not supported in this browser.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Hello, WebGPU!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>è·å¾—äº† WebGPU æ”¯æŒåï¼Œåˆ™å¯ä»¥è°ƒç”¨ <code>navigator.gpu</code> çš„ <code>requestAdapter</code> è·å¾—ä¸€ä¸ª GPU çš„é€»è¾‘é€‚é…å™¨ï¼ˆadapterï¼‰ï¼Œå†ç”± <code>adapter</code> è°ƒç”¨ <code>requestDevice</code> è·å¾—ä¸€ä¸ªå®é™…ä½¿ç”¨ JS è¿›è¡Œäº¤äº’çš„ GPU è®¾å¤‡ï¼ˆdeviceï¼‰ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=kr>const</span> <span class=nx>adapter</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>navigator</span><span class=p>.</span><span class=nx>gpu</span><span class=p>.</span><span class=nx>requestAdapter</span><span class=p>();</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=kr>const</span> <span class=nx>device</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>gpuAdapter</span><span class=p>.</span><span class=nx>requestDevice</span><span class=p>();</span>
</span></span></code></pre></div><blockquote><p>adapter å’Œ deviceï¼šGPUAdapter å°è£…äº†ä¸€ä¸ªé€‚é…å™¨ï¼Œå¹¶æè¿°å…¶ç‰¹æ€§ï¼ˆfeaturesï¼‰ã€é™åˆ¶ï¼ˆlimitsï¼‰åŠé€‚é…å™¨ä¿¡æ¯ï¼ˆInfoï¼‰ï¼Œæ˜¯æµè§ˆå™¨å¯¹ GPU çš„æŠ½è±¡ï¼Œå¯ä»¥ç”¨å®ƒé€‰æ‹©å¤šä¸ª GPUï¼ˆé›†æ˜¾ï¼Œç‹¬æ˜¾ï¼‰ï¼›GPUDevice å°è£…äº†ä¸€ä¸ªè®¾å¤‡ï¼Œå¹¶æš´éœ²è¯¥è®¾å¤‡çš„åŠŸèƒ½ï¼ˆåªè¯»ï¼‰ï¼Œä»£è¡¨ä¸ GPU çš„é€»è¾‘è¿æ¥ï¼Œå¯ä»¥ç”¨ device è°ƒç”¨ WebGPU æ¥å£ã€‚</p></blockquote><p>æ­£å¦‚å¼€å¤´æ‰€è¯´ï¼Œ<code>GPUCanvasContext</code> æ˜¯é€šè¿‡ <code>HTMLCanvasElement</code> å®ä¾‹è°ƒç”¨ <code>getContext</code> æ–¹æ³•åˆ›å»ºçš„ï¼Œå¯¹äº WebGPU åˆ›å»ºä¸€ä¸ª WebGPU ä¸“ç”¨çš„ç”»å¸ƒä¸Šä¸‹æ–‡ï¼Œä¼ é€’ <code>webgpu</code> ä½œä¸ºå…¶ contextType å‚æ•°ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=kr>const</span> <span class=nx>canvas</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;canvas&#39;</span><span class=p>)</span> <span class=kr>as</span> <span class=nx>HTMLCanvasElement</span><span class=p>;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=kr>const</span> <span class=nx>context</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s1>&#39;webgpu&#39;</span><span class=p>);</span>
</span></span></code></pre></div><blockquote><p>canvas å’Œ contextï¼šç±»ä¼¼äº adapter å’Œ deviceï¼Œcanvas åªæ˜¯ä¸€ä¸ª HTML çš„ DOM å…ƒç´ ï¼Œéœ€è¦é€šè¿‡ <code>getContext</code> åˆ›å»ºä¸€ä¸ª WebGPU å¯ä»¥æ§åˆ¶çš„é€»è¾‘ç”»å¸ƒï¼Œåœ¨ context ä¸Šè¿›è¡Œç»˜åˆ¶ã€‚åˆ›å»º context ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <code>configure</code> æ–¹æ³•é…ç½®ç”»å¸ƒä¸Šä¸‹æ–‡ï¼Œè‡³å°‘åŒ…æ‹¬ device å’Œ formatï¼ˆ<code>GPUTextureFormat</code>ï¼‰ï¼Œåè€…ä¸€èˆ¬ä¸º bgra8unormã€‚</p></blockquote><p><code>requestAdapter</code> å’Œ <code>requestDevice</code> éƒ½æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª Promiseï¼Œéœ€è¦ä½¿ç”¨ await è·å–å®é™…è¿”å›å¯¹è±¡ï¼Œè€Œ await å¿…é¡»åœ¨ async å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤–é¢åŒ…è£¹ä¸€ä¸ª async functionï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln> 1</span><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>initWebGPU() {</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=c1>// check webgpu support ...
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>  <span class=c1>// request GPU adapter
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>adapter</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>navigator</span><span class=p>.</span><span class=nx>gpu</span><span class=p>.</span><span class=nx>requestAdapter</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>adapter</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Cannot get GPU adapter.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=c1>// request a logical device
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>device</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>adapter</span><span class=p>.</span><span class=nx>requestDevice</span><span class=p>();</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=c1>// get canvas and configure webgpu context
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>canvas</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;canvas&#39;</span><span class=p>)</span> <span class=kr>as</span> <span class=nx>HTMLCanvasElement</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=kr>const</span> <span class=nx>context</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s1>&#39;webgpu&#39;</span><span class=p>)</span><span class=o>!</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=kr>const</span> <span class=nx>presentationFormat</span> <span class=o>=</span> <span class=nx>navigator</span><span class=p>.</span><span class=nx>gpu</span><span class=p>.</span><span class=nx>getPreferredCanvasFormat</span><span class=p>();</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=nx>context</span><span class=p>.</span><span class=nx>configure</span><span class=p>({</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nx>device</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nx>format</span>: <span class=kt>presentationFormat</span><span class=p>,</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=nx>alphaMode</span><span class=o>:</span> <span class=s1>&#39;premultiplied&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=c1>// other code ...
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>è‡³æ­¤ï¼ŒWebGPU åˆå§‹åŒ–å®Œæ¯•ã€‚</p><h3 id=é…ç½®ç®¡çº¿>é…ç½®ç®¡çº¿<a hidden class=anchor aria-hidden=true href=#é…ç½®ç®¡çº¿>#</a></h3><p>WebGPU ä¸€å…±æœ‰ä¸¤ç§ç®¡çº¿ï¼šGPUComputePipelineï¼ˆè®¡ç®—ç®¡çº¿ï¼‰ å’Œ GPURenderPipelineï¼ˆæ¸²æŸ“ç®¡çº¿ï¼‰ï¼Œæ— è®ºå“ªç§ç®¡çº¿éƒ½è§„å®šäº† GPU çš„ä»»åŠ¡æµç¨‹ï¼ŒåŒ…æ‹¬ä» bindings æˆ–è€… buffers è·å–è¾“å…¥ï¼Œå¹¶äº§ç”Ÿè¾“å‡ºï¼ˆä¾‹å¦‚æ¸²æŸ“çº¹ç†ï¼‰çš„è¿‡ç¨‹ã€‚</p><p>ä»ç»“æ„ä¸Šçœ‹ï¼Œç®¡çº¿ç”±ä¸€ç³»åˆ—å¯ç¼–ç¨‹é˜¶æ®µï¼ˆshadersï¼‰å’Œå›ºå®šåŠŸèƒ½çŠ¶æ€ï¼ˆæ··åˆæ¨¡å¼ï¼‰ç»„æˆï¼Œä¸€ä¸ªæ¸²æŸ“ç®¡çº¿ä¸€èˆ¬åŒ…æ‹¬é¡¶ç‚¹ç€è‰²å™¨ï¼ˆvertex shaderï¼‰ã€ç‰‡å…ƒç€è‰²å™¨ï¼ˆfragment shaderï¼‰ç­‰ï¼Œè®¡ç®—ç®¡çº¿åˆ™åŒ…æ‹¬è®¡ç®—ç€è‰²å™¨ï¼ˆcompute shaderï¼‰ã€‚</p><p>å¯¹äºä¸€ä¸ªæ¸²æŸ“ç®¡çº¿ï¼Œå¯ä»¥é€šè¿‡ <code>createRenderPipeline</code> æ–¹æ³•ç«‹å³åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯é€šè¿‡ <code>createRenderPipelineAsync</code> æ–¹æ³•å¼‚æ­¥åˆ›å»ºã€‚<code>createRenderPipeline</code> æ–¹æ³•æ¥å—ä¸€ä¸ªå­—å…¸å¯¹è±¡ <code>GPURenderPipelineDescriptor</code>ï¼ŒåŒ…å«å¦‚ä¸‹æˆå‘˜ï¼š</p><ul><li>vertexï¼ˆGPUVertexStateï¼‰ï¼šæè¿°ç®¡çº¿é¡¶ç‚¹ç€è‰²å™¨å…¥å£åŠå…¶è¾“å…¥ç¼“å†²åŒºå¸ƒå±€</li><li>primitiveï¼ˆGPUPrimitiveStateï¼‰ï¼šæè¿°ç®¡çº¿ä¸­åŸå§‹å›¾å…ƒç›¸å…³å±æ€§</li><li>depthStencilï¼ˆGPUDepthStencilStateï¼‰ï¼šå¯é€‰çš„æ·±åº¦æ¨¡æ¿å±æ€§</li><li>multisampleï¼ˆGPUMultisampleStateï¼‰ï¼šå¤šé‡é‡‡æ ·å±æ€§</li><li>fragmentï¼ˆGPUFragmentStateï¼‰ï¼šæè¿°ç®¡çº¿ç‰‡å…ƒç€è‰²å™¨å…¥å£åŠå…¶è¾“å‡ºé¢œè‰²</li></ul><p>å¯¹äºæ­¤æ¬¡ç»˜åˆ¶ä¸‰è§’å½¢çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¿…é¡»è¦æä¾›çš„æ˜¯ vertexï¼Œprimitive å’Œ fragmentã€‚å…¶ä¸­ vertex å’Œ fragment éƒ½ç»§æ‰¿ <code>GPUProgrammableStage</code>ï¼Œåè€…æè¿°ç”¨æˆ·æä¾›çš„ <code>GPUShaderModule</code> ä¸­çš„å…¥å£ç‚¹ï¼Œå³ç€è‰²å™¨çš„å…¥å£å‡½æ•°ã€‚</p><p>é¡¶ç‚¹ç€è‰²å™¨æ¥å—æ¥è‡ªé¡¶ç‚¹ç¼“å†²åŒºçš„è¾“å…¥æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®šä¹‰éœ€è¦ä¼ è¾“åˆ° GPU çš„é¡¶ç‚¹æ•°æ®ï¼Œç„¶åé€šè¿‡ GPUBuffer æè¿°å¦‚ä½•è§£æè¿™äº›æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸‰è§’å½¢çš„æ¯ä¸ªé¡¶ç‚¹ï¼Œå®šä¹‰å…¶ç”±ä½ç½®å’Œé¢œè‰²ä¸¤ä¸ªå±æ€§ç»„æˆï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=c1>// data preparation
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>triangleData</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Float32Array</span><span class=p>([</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1>// position      color
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1></span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span>   <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span>  <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span>   <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>]);</span>
</span></span></code></pre></div><p>ç„¶åå¯ä»¥é€šè¿‡ <code>createBuffer</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ª GPUbufferï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <code>GPUBufferDescriptor</code> ç±»å‹çš„å­—å…¸å¯¹è±¡ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>sizeï¼šç¼“å†²åŒºä»¥å­—èŠ‚ä¸ºå•ä½çš„å¤§å°</li><li>usageï¼šç¼“å†²åŒºå…è®¸çš„ä½¿ç”¨æ–¹å¼ï¼ˆä¾‹å¦‚ Vertexï¼ŒUniformï¼ŒStorageï¼‰</li></ul><p>å¯ä»¥é€šè¿‡ä¸Šè¿°å®šä¹‰çš„é¡¶ç‚¹æ•°ç»„çš„å­—èŠ‚é•¿åº¦è·å– sizeï¼›ä¸ºäº†èƒ½å¤Ÿæ‹·è´ç»™ GPUï¼Œå¹¶ä¼ é€’ç»™ VertexBufferï¼Œåœ¨ usage ä¸­éœ€è¦åŒæ—¶å¯ç”¨ VERTEX å’Œ COPY_DSTã€‚</p><p><img alt="GPUBufferUsageï¼ŒWebGPU Spec" loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202507011717247.png#center></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=c1>// create and write gpu buffer
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>vertexBuffer</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createBuffer</span><span class=p>({</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=nx>size</span>: <span class=kt>triangleData.byteLength</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=nx>usage</span>: <span class=kt>GPUBufferUsage.VERTEX</span> <span class=o>|</span> <span class=nx>GPUBufferUsage</span><span class=p>.</span><span class=nx>COPY_DST</span><span class=p>,</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=nx>device</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>writeBuffer</span><span class=p>(</span><span class=nx>vertexBuffer</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>triangleData</span><span class=p>);</span>
</span></span></code></pre></div><p>å®šä¹‰å¥½äº†é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å…¥ï¼Œå°±å¯ä»¥å¼€å§‹ç¼–å†™ shader äº†ã€‚æ­£å¦‚ OpenGL æœ‰ GLSLï¼ŒD3D æœ‰ HLSLï¼ŒWebGPU çš„å¼€å‘ç»„ä¹Ÿä¸ºå…¶å¸¦æ¥äº†ä¸€å¥—æ–°çš„ç€è‰²å™¨è¯­è¨€â€”â€”WGSLã€‚ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢æ‰€éœ€çš„æœ€ç®€å•çš„ shader å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// shader code
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shaderCode</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sb>struct VertexOutput {
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sb>  @builtin(position) position: vec4&lt;f32&gt;,
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sb>  @location(0) color: vec4&lt;f32&gt;,
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sb>};
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sb>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sb>@vertex
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sb>fn vs_main(
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sb>  @location(0) pos: vec3&lt;f32&gt;,
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sb>  @location(1) color: vec4&lt;f32&gt;
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=sb>) -&gt; VertexOutput {
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=sb>  var output: VertexOutput;
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=sb>  output.position = vec4&lt;f32&gt;(pos, 1.0);
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=sb>  output.color = color;
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=sb>  return output;
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=sb>}
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=sb>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=sb>@fragment
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=sb>fn fs_main(input: VertexOutput) -&gt; @location(0) vec4&lt;f32&gt; {
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=sb>  return input.color;
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=sb>}
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1>// create shader module
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shaderModule</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createShaderModule</span><span class=p>({</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=nx>code</span>: <span class=kt>shaderCode</span><span class=p>,</span>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=p>});</span>
</span></span></code></pre></div><blockquote><p>shader ä¹Ÿå¯ä»¥å†™åœ¨ .wgsl æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ import å¯¼å…¥</p></blockquote><p>è‡³æ­¤ï¼Œå¯ä»¥è°ƒç”¨ <code>createRenderPipeline</code> æ–¹æ³•ï¼Œä¾æ¬¡å¡«å…¥ <code>GPURenderPipelineDescriptor</code> çš„å„ä¸ªå­—æ®µï¼š</p><ul><li>layoutï¼šä½¿ç”¨ &lsquo;auto&rsquo;ï¼Œè®©ç®¡çº¿è‡ªåŠ¨æ¨æ–­èµ„æºç»‘å®šå¸ƒå±€</li><li>vertexï¼šshaderModule åŠé¡¶ç‚¹ç€è‰²å™¨å…¥å£å‡½æ•°ï¼Œé¡¶ç‚¹ç¼“å†²åŒºå¸ƒå±€å’Œæ ¼å¼</li><li>fragmentï¼šshaderModule åŠç‰‡å…ƒç€è‰²å™¨å…¥å£å‡½æ•°ï¼Œè¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸ context çš„ format åŒ¹é…ï¼‰</li><li>primitiveï¼šå…¶ä¸­çš„ topology è§„å®šå›¾å…ƒç±»å‹ï¼Œç”±äºæˆ‘ä»¬æ˜¯ç”»ä¸‰è§’å½¢æ‰€ä»¥ä½¿ç”¨ &rsquo;triangle-list&rsquo;</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln> 1</span><span class=cl>  <span class=c1>// create render pipeline
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>pipeline</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createRenderPipeline</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nx>layout</span><span class=o>:</span> <span class=s1>&#39;auto&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=nx>vertex</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>      <span class=nx>module</span>: <span class=kt>shaderModule</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>      <span class=nx>entryPoint</span><span class=o>:</span> <span class=s1>&#39;vs_main&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>      <span class=nx>buffers</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>          <span class=nx>arrayStride</span>: <span class=kt>7</span> <span class=o>*</span> <span class=mi>4</span><span class=p>,</span> <span class=c1>// position: 3 + color: 4
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>          <span class=nx>attributes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>            <span class=p>{</span> <span class=c1>// position
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>              <span class=nx>shaderLocation</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>              <span class=nx>offset</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>              <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;float32x3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=p>{</span> <span class=c1>// color
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>              <span class=nx>shaderLocation</span>: <span class=kt>1</span><span class=p>,</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>              <span class=nx>offset</span>: <span class=kt>3</span> <span class=o>*</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>              <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;float32x4&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>          <span class=p>],</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nx>fragment</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>      <span class=nx>module</span>: <span class=kt>shaderModule</span><span class=p>,</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>      <span class=nx>entryPoint</span><span class=o>:</span> <span class=s1>&#39;fs_main&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>      <span class=nx>targets</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>          <span class=nx>format</span>: <span class=kt>presentationFormat</span><span class=p>,</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=nx>primitive</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>      <span class=nx>topology</span><span class=o>:</span> <span class=s1>&#39;triangle-list&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œç®¡çº¿é…ç½®ç»“æŸã€‚</p><h3 id=å½•åˆ¶æ¸²æŸ“é˜Ÿåˆ—>å½•åˆ¶æ¸²æŸ“é˜Ÿåˆ—<a hidden class=anchor aria-hidden=true href=#å½•åˆ¶æ¸²æŸ“é˜Ÿåˆ—>#</a></h3><p>ç†Ÿæ‚‰ Unity çš„åŒå­¦å¯èƒ½ä¼šçŸ¥é“ï¼Œå½“è°ƒç”¨æ¸²æŸ“å‘½ä»¤æ—¶ï¼ŒGPU å¹¶éç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æŠŠä¸€ç³»åˆ—å‘½ä»¤å†™å…¥ä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒºï¼ˆCommandBufferï¼‰ï¼Œç„¶åå†å°†è¿™ä¸ª CommandBuffer æ³¨å…¥åˆ°ç®¡çº¿çš„ç‰¹å®šé˜¶æ®µï¼ˆä¾‹å¦‚ä¸é€æ˜ç‰©ä½“æ¸²æŸ“åæˆ–è€…é˜´å½±æ¸²æŸ“å‰ï¼‰ã€‚å½“æ¸²æŸ“å¾ªç¯æ‰§è¡Œåˆ°æ³¨å…¥ç‚¹æ—¶ï¼Œæ‰ä¼šä¾æ¬¡æ‰§è¡Œç¼“å†²åŒºä¸­çš„å‘½ä»¤ã€‚</p><p>WebGPU ä¸­çš„ CommandEncoder æ­£æ˜¯å¯¹åº”äº†å†™å…¥æ¸²æŸ“ç¼“å†²åŒºçš„å½•åˆ¶æ“ä½œï¼Œç›´åˆ° submit å‰çš„å†…å®¹éƒ½æ˜¯åœ¨æ„å»ºå‘½ä»¤åˆ—è¡¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=kr>const</span> <span class=nx>commandEncoder</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createCommandEncoder</span><span class=p>();</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1>// record command here
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>commandBuffer</span> <span class=o>=</span> <span class=nx>commandEncoder</span><span class=p>.</span><span class=nx>finish</span><span class=p>();</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=nx>device</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>submit</span><span class=p>([</span><span class=nx>commandBuffer</span><span class=p>]);</span>
</span></span></code></pre></div><p>å¦‚æœè¯´ GPUCommandEncoder æ˜¯ä¸€æ•´ä¸ªå½•åˆ¶å™¨ï¼Œé‚£ä¹ˆ GPURenderPassEncoder å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªå­å½•åˆ¶å™¨ï¼Œå½•åˆ¶ä¸€ä¸ª Pass è¿‡ç¨‹ä¸­çš„å‘½ä»¤ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª Pass å°±æ˜¯ä» GPU è¾“å…¥æ•°æ®åˆ°è¾“å‡ºæ¸²æŸ“ç›®æ ‡çš„è¿‡ç¨‹ã€‚ä¸€ä¸ª CommandEncoder å¯ä»¥åˆ›å»ºå¤šä¸ª Passã€‚</p><p>åœ¨ WebGPU ä¸­åˆ›å»ºä¸€ä¸ª Pass å¯ä»¥ä½¿ç”¨ <code>beginRenderPass</code> æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª <code>GPURenderPassDescripter</code> å­—å…¸å¯¹è±¡ï¼Œè‡³å°‘éœ€è¦åŒ…å« <code>colorAttachments</code> å­—æ®µã€‚<code>colorAttachments</code> å®šä¹‰äº†å½“å‰ Pass è¾“å‡ºçš„æ‰€æœ‰é¢œè‰²é™„ä»¶ï¼Œæ¯ä¸ª <code>colorAttachment</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¿…é¡»æä¾›ä»¥ä¸‹ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li>viewï¼ˆGPUTextureViewï¼‰ï¼šæè¿°è¾“å‡ºæ­¤ <code>colorAttachment</code> çš„çº¹ç†å­èµ„æº</li><li>loadOpï¼ˆGPULoadOpï¼‰ï¼šæ‰§è¡Œ Pass å‰å¯¹ view çš„åŠ è½½æ“ä½œï¼ˆä¸€èˆ¬ä¸º clearï¼‰</li><li>storeOpï¼ˆGPUStoreOpï¼‰ï¼šæ‰§è¡Œ Pass åå¯¹ view çš„å­˜å‚¨æ“ä½œ</li></ul><p>åˆ›å»º GPUPassEncoder åï¼Œå°±å¯ä»¥å½•åˆ¶æ¸²æŸ“å‘½ä»¤äº†ï¼Œå…·ä½“åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>è®¾ç½®ç®¡çº¿ï¼šè®¾ç½®è¯¥ Pass ä½¿ç”¨çš„ç®¡çº¿ã€æ¸²æŸ“çŠ¶æ€</li><li>ç»‘å®šèµ„æºï¼šè®¾ç½®é¡¶ç‚¹ç¼“å†²ã€ç´¢å¼•ç¼“å†²å’Œ BindingGroup</li><li>æ‰§è¡Œç»˜åˆ¶ï¼šè°ƒç”¨ <code>draw</code> æ–¹æ³•ç»˜åˆ¶é¡¶ç‚¹</li></ol><p>ä¸Šè¿°æµç¨‹å®Œæˆåï¼Œä¾¿å¯ä»¥é€šè¿‡ <code>end</code> æ–¹æ³•ç»“æŸ Pass çš„å½•åˆ¶ã€‚å¯¹äºæœ¬æ¬¡çš„ä¸‰è§’å½¢ï¼Œå…¶æ¸²æŸ“é˜Ÿåˆ—çš„å½•åˆ¶è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>frame() {</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>// cmdEncoder to record commands
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>commandEncoder</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createCommandEncoder</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=c1>// get current texture view
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>textureView</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>getCurrentTexture</span><span class=p>().</span><span class=nx>createView</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=c1>// begin render pass
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>renderPassDescriptor</span>: <span class=kt>GPURenderPassDescriptor</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>      <span class=nx>colorAttachments</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>          <span class=nx>view</span>: <span class=kt>textureView</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>          <span class=nx>clearValue</span><span class=o>:</span> <span class=p>{</span> <span class=nx>r</span>: <span class=kt>0.0</span><span class=p>,</span> <span class=nx>g</span>: <span class=kt>0.0</span><span class=p>,</span> <span class=nx>b</span>: <span class=kt>0.0</span><span class=p>,</span> <span class=nx>a</span>: <span class=kt>1.0</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>          <span class=nx>loadOp</span><span class=o>:</span> <span class=s1>&#39;clear&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>          <span class=nx>storeOp</span><span class=o>:</span> <span class=s1>&#39;store&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=kr>const</span> <span class=nx>passEncoder</span> <span class=o>=</span> <span class=nx>commandEncoder</span><span class=p>.</span><span class=nx>beginRenderPass</span><span class=p>(</span><span class=nx>renderPassDescriptor</span><span class=p>);</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=c1>// set pipeline and vertex buffer
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>    <span class=nx>passEncoder</span><span class=p>.</span><span class=nx>setPipeline</span><span class=p>(</span><span class=nx>pipeline</span><span class=p>);</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=nx>passEncoder</span><span class=p>.</span><span class=nx>setVertexBuffer</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>vertexBuffer</span><span class=p>);</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=c1>// draw triangle: 3 vertices
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1></span>    <span class=nx>passEncoder</span><span class=p>.</span><span class=nx>draw</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span> 
</span></span><span class=line><span class=ln>28</span><span class=cl>    
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=c1>// end render pass
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=c1></span>    <span class=nx>passEncoder</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=c1>// finish encode and submit 
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=c1></span>    <span class=nx>device</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>submit</span><span class=p>([</span><span class=nx>commandEncoder</span><span class=p>.</span><span class=nx>finish</span><span class=p>()]);</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=c1>// request next frame
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=c1></span>    <span class=nx>requestAnimationFrame</span><span class=p>(</span><span class=nx>frame</span><span class=p>);</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=c1>// start render loop
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1></span>  <span class=nx>requestAnimationFrame</span><span class=p>(</span><span class=nx>frame</span><span class=p>);</span>
</span></span></code></pre></div><p>åœ¨ç»ˆç«¯è¿è¡Œ npm run devï¼Œä¸å‡ºæ„å¤–å°±èƒ½çœ‹åˆ°ä¸€ä¸ªäº”å½©æ–‘æ–“çš„ä¸‰è§’å½¢ï¼š</p><blockquote><p>CSS è‡ªå·±å†™</p></blockquote><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202507011833718.png#center></p><h3 id=gui>GUI<a hidden class=anchor aria-hidden=true href=#gui>#</a></h3><p>ç›®å‰æˆ‘ä»¬å‚æ•°æ˜¯å†™æ­»åœ¨ TS ä¸­ï¼Œæ›´æ–¹ä¾¿çš„æ–¹å¼æ˜¯åŠ å…¥äº¤äº’çš„ GUIï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­å®æ—¶è°ƒæ•´å‚æ•°å¹¶æŸ¥çœ‹ç»“æœã€‚</p><p>OpenGL çš„æ—¶å€™ç”¨çš„æ˜¯ imguiï¼Œä½†ä¸çŸ¥ä¸ºä½•ä¸‹è½½ä¸äº†å…¶å¯¹ js çš„å°è£…ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©çš„æ˜¯å¦ä¸€ä¸ªè½»é‡çº§çš„ lil-guiï¼Œåœ¨ç»ˆç«¯ä¸‹è½½å®ƒçš„åŒ…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>npm install lil-gui
</span></span></code></pre></div><p>ç„¶ååœ¨ TypeScript æ–‡ä»¶ä¸­å¼•å…¥ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>GUI</span><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;lil-gui&#39;</span>
</span></span></code></pre></div><p>åˆå§‹åŒ– GUI å¹¶æ·»åŠ ä¸‰ä¸ª color å‚æ•°æ§åˆ¶ä¸‰è§’å½¢æ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln> 1</span><span class=cl><span class=kr>const</span> <span class=nx>gui</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>GUI</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nx>colorA</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nx>colorB</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nx>colorC</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nx>gui</span><span class=p>.</span><span class=nx>addColor</span><span class=p>(</span><span class=nx>params</span><span class=p>,</span> <span class=s1>&#39;colorA&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nx>gui</span><span class=p>.</span><span class=nx>addColor</span><span class=p>(</span><span class=nx>params</span><span class=p>,</span> <span class=s1>&#39;colorB&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nx>gui</span><span class=p>.</span><span class=nx>addColor</span><span class=p>(</span><span class=nx>params</span><span class=p>,</span> <span class=s1>&#39;colorC&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>åˆ›å»ºä¸€ä¸ª GPUBufferï¼Œå°†å…¶è®¾ç½®ä¸º UNIFORMï¼Œå¹¶ç»‘å®šåˆ° bindGroupï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln> 1</span><span class=cl><span class=kr>const</span> <span class=nx>colorBuffer</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createBuffer</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=nx>size</span>: <span class=kt>4</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>*</span> <span class=mi>4</span><span class=p>,</span> <span class=c1>// 3 colors, each with 4 floats
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>  <span class=nx>usage</span>: <span class=kt>GPUBufferUsage.UNIFORM</span> <span class=o>|</span> <span class=nx>GPUBufferUsage</span><span class=p>.</span><span class=nx>COPY_DST</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=kr>const</span> <span class=nx>bindGroup</span> <span class=o>=</span> <span class=nx>device</span><span class=p>.</span><span class=nx>createBindGroup</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=nx>layout</span>: <span class=kt>pipeline.getBindGroupLayout</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=nx>entries</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=nx>binding</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=nx>resource</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>	  <span class=nx>buffer</span>: <span class=kt>colorBuffer</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=p>}],</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>ç„¶åæ¯å¸§æ›´æ–°è¿™ä¸ª Buffer å¹¶è®¾ç½®ç»‘å®šç»„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=ln>1</span><span class=cl><span class=kd>function</span> <span class=nx>updateColors</span><span class=p>(){</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=nx>device</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>writeBuffer</span><span class=p>(</span><span class=nx>colorBuffer</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Float32Array</span><span class=p>([...</span><span class=nx>params</span><span class=p>.</span><span class=nx>colorA</span><span class=p>,</span> <span class=p>...</span><span class=nx>params</span><span class=p>.</span><span class=nx>colorB</span><span class=p>,</span> <span class=p>...</span><span class=nx>params</span><span class=p>.</span><span class=nx>colorC</span><span class=p>]));</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=kd>function</span> <span class=nx>frame</span><span class=p>(){</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>	<span class=c1>// ...
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=c1></span>  <span class=nx>updateColors</span><span class=p>();</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>  <span class=nx>passEncoder</span><span class=p>.</span><span class=nx>setBindGroup</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>bindGroup</span><span class=p>);</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æœ€åå¯ä»¥åœ¨ VertexShader ä¸­è§£æè¿™ä¸ª uniformï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-wgsl data-lang=wgsl><span class=line><span class=ln> 1</span><span class=cl><span class=k>struct</span><span class=w> </span><span class=n>ColorUniform</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=n>colorA</span><span class=p>:</span><span class=w> </span><span class=nb>vec4</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>  </span><span class=n>colorB</span><span class=p>:</span><span class=w> </span><span class=nb>vec4</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=n>colorC</span><span class=p>:</span><span class=w> </span><span class=nb>vec4</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w></span><span class=nd>@group</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=nd>@binding</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=kd>var</span><span class=o>&lt;</span><span class=nb>uniform</span><span class=o>&gt;</span><span class=w> </span><span class=n>uColors</span><span class=p>:</span><span class=w> </span><span class=n>ColorUniform</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w></span><span class=k>fn</span><span class=w> </span><span class=n>getColorByIndex</span><span class=p>(</span><span class=n>index</span><span class=p>:</span><span class=w> </span><span class=nb>u32</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>vec4</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>index</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0u</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>uColors</span><span class=p>.</span><span class=n>colorA</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>index</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1u</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>uColors</span><span class=p>.</span><span class=n>colorB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>uColors</span><span class=p>.</span><span class=n>colorC</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w></span><span class=nd>@vertex</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w></span><span class=k>fn</span><span class=w> </span><span class=n>vs_main</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>  </span><span class=nd>@builtin</span><span class=p>(</span><span class=nb>vertex_index</span><span class=p>)</span><span class=w> </span><span class=n>vertexindex</span><span class=p>:</span><span class=w> </span><span class=nb>u32</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>  </span><span class=nd>@location</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=n>pos</span><span class=p>:</span><span class=w> </span><span class=nb>vec3</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>  </span><span class=nd>@location</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>color</span><span class=p>:</span><span class=w> </span><span class=nb>vec4</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=n>VertexOutput</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=n>output</span><span class=p>:</span><span class=w> </span><span class=n>VertexOutput</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>  </span><span class=n>output</span><span class=p>.</span><span class=nb>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>vec4</span><span class=o>&lt;</span><span class=nb>f32</span><span class=o>&gt;</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>  </span><span class=n>output</span><span class=p>.</span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getColorByIndex</span><span class=p>(</span><span class=n>vertexindex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>output</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>å›åˆ°æµè§ˆå™¨ï¼Œè°ƒæ•´é¢œè‰²ï¼Œå°±å¯ä»¥çœ‹åˆ°å˜åŒ–äº†ï¼š</p><p><img loading=lazy src=https://raw.gitmirror.com/congyuxiaoyoudao/Picgo-ImageBed/main/TA-interludes/Interlude%203.WebGPUFromScratch/202507012240629.png#center></p><hr><h2 id=0x0f-after-words>0x0F After words<a hidden class=anchor aria-hidden=true href=#0x0f-after-words>#</a></h2><p><del>å¥½äº†ï¼Œä½ å·²ç»å­¦ä¼šå¦‚ä½•ä½¿ç”¨ WebGPU ç»˜åˆ¶ä¸‰è§’å½¢äº†ï¼Œå¯ä»¥å°è¯•æŒ‘æˆ˜ä¸€ä¸‹åˆ¶ä½œä¸€ä¸ª 3DGS çš„å®æ—¶æ¸²æŸ“é¢„è§ˆå™¨äº†ï¼</del></p><p>å¥½å§ä¸å¼€ç©ç¬‘äº†ï¼ŒWebGPU è¿˜æœ‰æå¤§éƒ¨åˆ†å†…å®¹æ˜¯æœ¬æ–‡æ²¡æœ‰æ¶µç›–çš„ï¼Œå¦‚æœè¯»è€…æœ‰æ›´è¿›ä¸€æ­¥çš„éœ€æ±‚ï¼Œæ–‡ç« å¼€å¤´ä¹Ÿåˆ—å‡ºäº†ä¸€äº›æ›´è¯¦ç»†çš„æ–‡æ¡£å’Œæ•™ç¨‹å¯ä¾›å‚è€ƒã€‚å¦‚æœæœ‰ä¸€äº› OpenGL æˆ–è€… WebGL åŸºç¡€ï¼Œå­¦ WebGPU ä¹Ÿä¼šæ›´è½»æ¾äº›å§â€¦â€¦</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://congyuxiaoyoudao.github.io/tags/webgpu/>WebGPU</a></li></ul><nav class=paginav><a class=prev href=https://congyuxiaoyoudao.github.io/posts/interludes/estimatenormals/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Interlude 4. åœ¨ç‚¹äº‘æ•°æ®ä¸­ä¼°è®¡æ³•çº¿</span>
</a><a class=next href=https://congyuxiaoyoudao.github.io/posts/assignments/games202-homework-5/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Assignment 8. GAMES202 Homework 5</span></a></nav></footer><div id=tw-comment></div><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="light"?"light":"noborder_dark",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"congyuxiaoyoudao/congyuxiaoyoudao.github.io","data-repo-id":"","data-category":"Announcements","data-category-id":"","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"","data-emit-metadata":"","data-input-position":"","data-theme":getStoredTheme(),"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous"},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#tw-comment").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://congyuxiaoyoudao.github.io/>The Only Problem's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>